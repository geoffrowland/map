(window.webpackJsonp=window.webpackJsonp||[]).push([[1],{1592:function(t,e,i){"use strict";var a=i(10);e.a=Object(a.default)({ROUNDED:0,MITERED:1,BEVELED:2})},1593:function(t,e,i){"use strict";var a=i(0),r=i(6),n=(i(12),i(26)),o=i(311),l=i(173),s=i(67);function u(){this._eventHelper=new o.default,this._definitionChanged=new n.default,this._intervals=new l.default,this._intervals.changedEvent.addEventListener(u.prototype._intervalsChanged,this)}Object(r.default)(u.prototype,{isConstant:{get:function(){return this._intervals.isEmpty}},definitionChanged:{get:function(){return this._definitionChanged}},intervals:{get:function(){return this._intervals}}}),u.prototype.getValue=function(t,e){var i=this._intervals.findDataForIntervalContainingDate(t);if(Object(a.default)(i))return i.getValue(t,e)},u.prototype.equals=function(t){return this===t||t instanceof u&&this._intervals.equals(t._intervals,s.default.equals)},u.prototype._intervalsChanged=function(){!function(t,e,i,r){function n(){i.raiseEvent(t)}var o=[];e.removeAll();for(var l=r.length,s=0;s<l;s++){var u=r.get(s);Object(a.default)(u.data)&&-1===o.indexOf(u.data)&&e.add(u.data.definitionChanged,n)}}(this,this._eventHelper,this._definitionChanged,this._intervals),this._definitionChanged.raiseEvent(this)},e.a=u},1594:function(t,e,i){"use strict";var a=i(2),r=i(0),n=i(6),o=(i(12),i(26)),l=i(184),s=i(1593),u=i(67);function d(t){this._referenceFrame=Object(a.default)(t,l.a.FIXED),this._definitionChanged=new o.default,this._composite=new s.a,this._composite.definitionChanged.addEventListener(d.prototype._raiseDefinitionChanged,this)}Object(n.default)(d.prototype,{isConstant:{get:function(){return this._composite.isConstant}},definitionChanged:{get:function(){return this._definitionChanged}},intervals:{get:function(){return this._composite.intervals}},referenceFrame:{get:function(){return this._referenceFrame},set:function(t){this._referenceFrame=t}}}),d.prototype.getValue=function(t,e){return this.getValueInReferenceFrame(t,l.a.FIXED,e)},d.prototype.getValueInReferenceFrame=function(t,e,i){var a=this._composite._intervals.findDataForIntervalContainingDate(t);if(Object(r.default)(a))return a.getValueInReferenceFrame(t,e,i)},d.prototype.equals=function(t){return this===t||t instanceof d&&this._referenceFrame===t._referenceFrame&&this._composite.equals(t._composite,u.default.equals)},d.prototype._raiseDefinitionChanged=function(){this._definitionChanged.raiseEvent(this)},e.a=d},1595:function(t,e,i){"use strict";var a=i(0),r=i(6),n=(i(12),i(26)),o=i(22),l=i(67);function s(t){var e=t._targetProperty;if(t._resolveProperty){var i=function(t){var e=!0;if(t._resolveEntity){var i=t._targetCollection.getById(t._targetId);if(Object(a.default)(i)?(i.definitionChanged.addEventListener(u.prototype._onTargetEntityDefinitionChanged,t),t._targetEntity=i,t._resolveEntity=!1):(i=t._targetEntity,e=!1),!Object(a.default)(i))throw new o.default('target entity "'+t._targetId+'" could not be resolved.')}return e}(t),r=t._targetPropertyNames;e=t._targetEntity;for(var n=r.length,l=0;l<n&&Object(a.default)(e);l++)e=e[r[l]];if(Object(a.default)(e))t._targetProperty=e,t._resolveProperty=!i;else if(!Object(a.default)(t._targetProperty))throw new o.default('targetProperty "'+t._targetId+"."+r.join(".")+'" could not be resolved.')}return e}function u(t,e,i){this._targetCollection=t,this._targetId=e,this._targetPropertyNames=i,this._targetProperty=void 0,this._targetEntity=void 0,this._definitionChanged=new n.default,this._resolveEntity=!0,this._resolveProperty=!0,t.collectionChanged.addEventListener(u.prototype._onCollectionChanged,this)}Object(r.default)(u.prototype,{isConstant:{get:function(){return l.default.isConstant(s(this))}},definitionChanged:{get:function(){return this._definitionChanged}},referenceFrame:{get:function(){return s(this).referenceFrame}},targetId:{get:function(){return this._targetId}},targetCollection:{get:function(){return this._targetCollection}},targetPropertyNames:{get:function(){return this._targetPropertyNames}},resolvedProperty:{get:function(){return s(this)}}}),u.fromString=function(t,e){for(var i,a=[],r=!0,n=!1,o="",l=0;l<e.length;++l){var s=e.charAt(l);n?(o+=s,n=!1):"\\"===s?n=!0:r&&"#"===s?(i=o,r=!1,o=""):r||"."!==s?o+=s:(a.push(o),o="")}return a.push(o),new u(t,i,a)},u.prototype.getValue=function(t,e){return s(this).getValue(t,e)},u.prototype.getValueInReferenceFrame=function(t,e,i){return s(this).getValueInReferenceFrame(t,e,i)},u.prototype.getType=function(t){return s(this).getType(t)},u.prototype.equals=function(t){if(this===t)return!0;var e=this._targetPropertyNames,i=t._targetPropertyNames;if(this._targetCollection!==t._targetCollection||this._targetId!==t._targetId||e.length!==i.length)return!1;for(var a=this._targetPropertyNames.length,r=0;r<a;r++)if(e[r]!==i[r])return!1;return!0},u.prototype._onTargetEntityDefinitionChanged=function(t,e,i,a){this._targetPropertyNames[0]===e&&(this._resolveProperty=!0,this._definitionChanged.raiseEvent(this))},u.prototype._onCollectionChanged=function(t,e,i){var r=this._targetEntity;Object(a.default)(r)&&(-1!==i.indexOf(r)?(r.definitionChanged.removeEventListener(u.prototype._onTargetEntityDefinitionChanged,this),this._resolveEntity=!0,this._resolveProperty=!0):this._resolveEntity&&(s(this),this._resolveEntity||this._definitionChanged.raiseEvent(this)))},e.a=u},1596:function(t,e,i){"use strict";var a=i(0),r=i(6),n=(i(12),i(28)),o=i(26),l=i(184),s=i(67);function u(t){this._definitionChanged=new o.default,this._value=void 0,this._removeSubscription=void 0,this.setValue(t)}Object(r.default)(u.prototype,{isConstant:{get:function(){return s.default.isConstant(this._value)}},definitionChanged:{get:function(){return this._definitionChanged}},referenceFrame:{get:function(){return Object(a.default)(this._value)?this._value.referenceFrame:l.a.FIXED}}}),u.prototype.getValue=function(t,e){return this.getValueInReferenceFrame(t,l.a.FIXED,e)},u.prototype.setValue=function(t){this._value!==t&&(this._value=t,Object(a.default)(this._removeSubscription)&&(this._removeSubscription(),this._removeSubscription=void 0),Object(a.default)(t)&&(this._removeSubscription=t.definitionChanged.addEventListener(this._raiseDefinitionChanged,this)),this._definitionChanged.raiseEvent(this))},u.prototype.getValueInReferenceFrame=function(t,e,i){if(Object(a.default)(this._value))return i=this._value.getValueInReferenceFrame(t,e,i),Object(a.default)(i)?n.default.WGS84.scaleToGeodeticSurface(i,i):void 0},u.prototype.equals=function(t){return this===t||t instanceof u&&this._value===t._value},u.prototype._raiseDefinitionChanged=function(){this._definitionChanged.raiseEvent(this)},e.a=u},707:function(t,e,i){"use strict";i.r(e);var a=i(153),r=i(21),n=(i(34),i(88)),o=i(2),l=i(0),s=i(6),u=i(24),d=i(311),f=i(521),c=i(519),h=i(339);function p(){this._length=0,this._collections={},this._collectionsArray=[],this.show=!0}Object(s.default)(p.prototype,{length:{get:function(){return this._length}}}),p.prototype.add=function(t,e){e=Object(o.default)(e,0);var i=this._collections[e];if(!Object(l.default)(i)){(i=new h.a({destroyPrimitives:!1}))._zIndex=e,this._collections[e]=i;for(var a=this._collectionsArray,r=0;r<a.length&&a[r]._zIndex<e;)r++;a.splice(r,0,i)}return i.add(t),this._length++,t._zIndex=e,t},p.prototype.set=function(t,e){return e===t._zIndex?t:(this.remove(t,!0),this.add(t,e),t)},p.prototype.remove=function(t,e){if(this.contains(t)){var i,a=t._zIndex,r=this._collections[a];return(i=e?r.remove(t):r.removeAndDestroy(t))&&this._length--,0===r.length&&(this._collectionsArray.splice(this._collectionsArray.indexOf(r),1),this._collections[a]=void 0,r.destroy()),i}return!1},p.prototype.removeAll=function(){for(var t=this._collectionsArray,e=0;e<t.length;e++){var i=t[e];i.destroyPrimitives=!0,i.destroy()}this._collections={},this._collectionsArray=[],this._length=0},p.prototype.contains=function(t){if(!Object(l.default)(t))return!1;var e=this._collections[t._zIndex];return Object(l.default)(e)&&e.contains(t)},p.prototype.update=function(t){if(this.show)for(var e=this._collectionsArray,i=0;i<e.length;i++)e[i].update(t)},p.prototype.isDestroyed=function(){return!1},p.prototype.destroy=function(){return this.removeAll(),Object(u.default)(this)};var m=p,g=i(178),y=i(40),v=i(5),_=i(1),b=i(9),O=i(12),w=i(132),A=i(87),P=i(118),E=i(145),C=i(90),j=i(517),D=i(67),x=b.default.WHITE,T=_.default.ZERO,I=P.default.NONE,M=v.default.ZERO,V=_.default.ZERO,N=E.default.CENTER,S=C.default.CENTER,L=new _.default,F=new b.default,U=new _.default,R=new v.default,H=new A.a,B=new A.a,G=new A.a,k=new y.default,z=new w.a;function W(t){this.entity=t,this.billboard=void 0,this.textureValue=void 0}function Y(t,e){e.collectionChanged.addEventListener(Y.prototype._onCollectionChanged,this),this._cluster=t,this._entityCollection=e,this._items=new g.default,this._onCollectionChanged(e,e.values,[],[])}function q(t,e,i){Object(l.default)(t)&&(t.billboard=void 0,i.removeBillboard(e))}Y.prototype.update=function(t){for(var e=this._items.values,i=this._cluster,a=0,r=e.length;a<r;a++){var n,o,s=e[a],u=s.entity,d=u._billboard,f=s.billboard,c=u.isShowing&&u.isAvailable(t)&&D.default.getValueOrDefault(d._show,t,!0);if(c&&(o=D.default.getValueOrUndefined(u._position,t,L),n=D.default.getValueOrUndefined(d._image,t),c=Object(l.default)(o)&&Object(l.default)(n)),c){D.default.isConstant(u._position)||(i._clusterDirty=!0),Object(l.default)(f)||((f=i.getBillboard(u)).id=u,f.image=void 0,s.billboard=f),f.show=c,Object(l.default)(f.image)&&s.textureValue===n||(f.image=n,s.textureValue=n),f.position=o,f.color=D.default.getValueOrDefault(d._color,t,x,F),f.eyeOffset=D.default.getValueOrDefault(d._eyeOffset,t,T,U),f.heightReference=D.default.getValueOrDefault(d._heightReference,t,I),f.pixelOffset=D.default.getValueOrDefault(d._pixelOffset,t,M,R),f.scale=D.default.getValueOrDefault(d._scale,t,1),f.rotation=D.default.getValueOrDefault(d._rotation,t,0),f.alignedAxis=D.default.getValueOrDefault(d._alignedAxis,t,V),f.horizontalOrigin=D.default.getValueOrDefault(d._horizontalOrigin,t,N),f.verticalOrigin=D.default.getValueOrDefault(d._verticalOrigin,t,S),f.width=D.default.getValueOrUndefined(d._width,t),f.height=D.default.getValueOrUndefined(d._height,t),f.scaleByDistance=D.default.getValueOrUndefined(d._scaleByDistance,t,H),f.translucencyByDistance=D.default.getValueOrUndefined(d._translucencyByDistance,t,B),f.pixelOffsetScaleByDistance=D.default.getValueOrUndefined(d._pixelOffsetScaleByDistance,t,G),f.sizeInMeters=D.default.getValueOrDefault(d._sizeInMeters,t,!1),f.distanceDisplayCondition=D.default.getValueOrUndefined(d._distanceDisplayCondition,t,z),f.disableDepthTestDistance=D.default.getValueOrUndefined(d._disableDepthTestDistance,t);var h=D.default.getValueOrUndefined(d._imageSubRegion,t,k);Object(l.default)(h)&&f.setImageSubRegion(f._imageId,h)}else q(s,u,i)}return!0},Y.prototype.getBoundingSphere=function(t,e){var i=this._items.get(t.id);if(!Object(l.default)(i)||!Object(l.default)(i.billboard))return j.default.FAILED;var a=i.billboard;if(a.heightReference===P.default.NONE)e.center=_.default.clone(a.position,e.center);else{if(!Object(l.default)(a._clampedPosition))return j.default.PENDING;e.center=_.default.clone(a._clampedPosition,e.center)}return e.radius=0,j.default.DONE},Y.prototype.isDestroyed=function(){return!1},Y.prototype.destroy=function(){this._entityCollection.collectionChanged.removeEventListener(Y.prototype._onCollectionChanged,this);for(var t=this._entityCollection.values,e=0;e<t.length;e++)this._cluster.removeBillboard(t[e]);return Object(u.default)(this)},Y.prototype._onCollectionChanged=function(t,e,i,a){var r,n,o=this._items,s=this._cluster;for(r=e.length-1;r>-1;r--)n=e[r],Object(l.default)(n._billboard)&&Object(l.default)(n._position)&&o.set(n.id,new W(n));for(r=a.length-1;r>-1;r--)n=a[r],Object(l.default)(n._billboard)&&Object(l.default)(n._position)?o.contains(n.id)||o.set(n.id,new W(n)):(q(o.get(n.id),n,s),o.remove(n.id));for(r=i.length-1;r>-1;r--)n=i[r],q(o.get(n.id),n,s),o.remove(n.id)};var X=Y,Z=i(257),J=i(26),K=i(136),Q=i(10),$=i(75),tt=i(171),et=i(176);function it(t){t=Object(o.default)(t,o.default.EMPTY_OBJECT);var e=Object(o.default)(t.translucent,!0),i=Object(o.default)(t.closed,!1),a=Object(o.default)(t.materialSupport,it.MaterialSupport.TEXTURED);this.material=Object(l.default)(t.material)?t.material:et.a.fromType(et.a.ColorType),this.translucent=e,this._vertexShaderSource=Object(o.default)(t.vertexShaderSource,a.vertexShaderSource),this._fragmentShaderSource=Object(o.default)(t.fragmentShaderSource,a.fragmentShaderSource),this._renderState=tt.a.getDefaultRenderState(e,i,t.renderState),this._closed=i,this._materialSupport=a,this._vertexFormat=a.vertexFormat,this._flat=Object(o.default)(t.flat,!1),this._faceForward=Object(o.default)(t.faceForward,!i)}Object(s.default)(it.prototype,{vertexShaderSource:{get:function(){return this._vertexShaderSource}},fragmentShaderSource:{get:function(){return this._fragmentShaderSource}},renderState:{get:function(){return this._renderState}},closed:{get:function(){return this._closed}},materialSupport:{get:function(){return this._materialSupport}},vertexFormat:{get:function(){return this._vertexFormat}},flat:{get:function(){return this._flat}},faceForward:{get:function(){return this._faceForward}}}),it.prototype.getFragmentShaderSource=tt.a.prototype.getFragmentShaderSource,it.prototype.isTranslucent=tt.a.prototype.isTranslucent,it.prototype.getRenderState=tt.a.prototype.getRenderState,it.MaterialSupport={BASIC:Object(Q.default)({vertexFormat:$.default.POSITION_AND_NORMAL,vertexShaderSource:"attribute vec3 position3DHigh;\nattribute vec3 position3DLow;\nattribute vec3 normal;\nattribute float batchId;\n\nvarying vec3 v_positionEC;\nvarying vec3 v_normalEC;\n\nvoid main()\n{\n    vec4 p = czm_computePosition();\n\n    v_positionEC = (czm_modelViewRelativeToEye * p).xyz;      // position in eye coordinates\n    v_normalEC = czm_normal * normal;                         // normal in eye coordinates\n\n    gl_Position = czm_modelViewProjectionRelativeToEye * p;\n}\n",fragmentShaderSource:"varying vec3 v_positionEC;\nvarying vec3 v_normalEC;\n\nvoid main()\n{\n    vec3 positionToEyeEC = -v_positionEC;\n\n    vec3 normalEC = normalize(v_normalEC);\n#ifdef FACE_FORWARD\n    normalEC = faceforward(normalEC, vec3(0.0, 0.0, 1.0), -normalEC);\n#endif\n\n    czm_materialInput materialInput;\n    materialInput.normalEC = normalEC;\n    materialInput.positionToEyeEC = positionToEyeEC;\n    czm_material material = czm_getMaterial(materialInput);\n\n#ifdef FLAT\n    gl_FragColor = vec4(material.diffuse + material.emission, material.alpha);\n#else\n    gl_FragColor = czm_phong(normalize(positionToEyeEC), material);\n#endif\n}\n"}),TEXTURED:Object(Q.default)({vertexFormat:$.default.POSITION_NORMAL_AND_ST,vertexShaderSource:"attribute vec3 position3DHigh;\nattribute vec3 position3DLow;\nattribute vec3 normal;\nattribute vec2 st;\nattribute float batchId;\n\nvarying vec3 v_positionEC;\nvarying vec3 v_normalEC;\nvarying vec2 v_st;\n\nvoid main()\n{\n    vec4 p = czm_computePosition();\n\n    v_positionEC = (czm_modelViewRelativeToEye * p).xyz;      // position in eye coordinates\n    v_normalEC = czm_normal * normal;                         // normal in eye coordinates\n    v_st = st;\n\n    gl_Position = czm_modelViewProjectionRelativeToEye * p;\n}\n",fragmentShaderSource:"varying vec3 v_positionEC;\nvarying vec3 v_normalEC;\nvarying vec2 v_st;\n\nvoid main()\n{\n    vec3 positionToEyeEC = -v_positionEC;\n\n    vec3 normalEC = normalize(v_normalEC);\n#ifdef FACE_FORWARD\n    normalEC = faceforward(normalEC, vec3(0.0, 0.0, 1.0), -normalEC);\n#endif\n\n    czm_materialInput materialInput;\n    materialInput.normalEC = normalEC;\n    materialInput.positionToEyeEC = positionToEyeEC;\n    materialInput.st = v_st;\n    czm_material material = czm_getMaterial(materialInput);\n\n#ifdef FLAT\n    gl_FragColor = vec4(material.diffuse + material.emission, material.alpha);\n#else\n    gl_FragColor = czm_phong(normalize(positionToEyeEC), material);\n#endif\n}\n"}),ALL:Object(Q.default)({vertexFormat:$.default.ALL,vertexShaderSource:"attribute vec3 position3DHigh;\nattribute vec3 position3DLow;\nattribute vec3 normal;\nattribute vec3 tangent;\nattribute vec3 bitangent;\nattribute vec2 st;\nattribute float batchId;\n\nvarying vec3 v_positionEC;\nvarying vec3 v_normalEC;\nvarying vec3 v_tangentEC;\nvarying vec3 v_bitangentEC;\nvarying vec2 v_st;\n\nvoid main()\n{\n    vec4 p = czm_computePosition();\n\n    v_positionEC = (czm_modelViewRelativeToEye * p).xyz;      // position in eye coordinates\n    v_normalEC = czm_normal * normal;                         // normal in eye coordinates\n    v_tangentEC = czm_normal * tangent;                       // tangent in eye coordinates\n    v_bitangentEC = czm_normal * bitangent;                   // bitangent in eye coordinates\n    v_st = st;\n\n    gl_Position = czm_modelViewProjectionRelativeToEye * p;\n}\n",fragmentShaderSource:"varying vec3 v_positionEC;\nvarying vec3 v_normalEC;\nvarying vec3 v_tangentEC;\nvarying vec3 v_bitangentEC;\nvarying vec2 v_st;\n\nvoid main()\n{\n    vec3 positionToEyeEC = -v_positionEC;\n    mat3 tangentToEyeMatrix = czm_tangentToEyeSpaceMatrix(v_normalEC, v_tangentEC, v_bitangentEC);\n\n    vec3 normalEC = normalize(v_normalEC);\n#ifdef FACE_FORWARD\n    normalEC = faceforward(normalEC, vec3(0.0, 0.0, 1.0), -normalEC);\n#endif\n\n    czm_materialInput materialInput;\n    materialInput.normalEC = normalEC;\n    materialInput.tangentToEyeMatrix = tangentToEyeMatrix;\n    materialInput.positionToEyeEC = positionToEyeEC;\n    materialInput.st = v_st;\n    czm_material material = czm_getMaterial(materialInput);\n\n#ifdef FLAT\n    gl_FragColor = vec4(material.diffuse + material.emission, material.alpha);\n#else\n    gl_FragColor = czm_phong(normalize(positionToEyeEC), material);\n#endif\n}\n"})};var at=it,rt=i(119),nt=i(112),ot=i(229),lt=i(296),st=i(130),ut=i(14);function dt(t,e){t=Object(o.default)(t,0),e=Object(o.default)(e,Number.MAX_VALUE),this.value=new Float32Array([t,e])}Object(s.default)(dt.prototype,{componentDatatype:{get:function(){return ut.a.FLOAT}},componentsPerAttribute:{get:function(){return 2}},normalize:{get:function(){return!1}}}),dt.fromDistanceDisplayCondition=function(t){return new dt(t.near,t.far)},dt.toValue=function(t,e){return Object(l.default)(e)?(e[0]=t.near,e[1]=t.far,e):new Float32Array([t.near,t.far])};var ft=dt,ct=i(123),ht=i(166),pt=i(172),mt=i(518),gt=i(422),yt=i(233),vt=i(95);function _t(){O.default.throwInstantiationError()}Object(s.default)(_t.prototype,{isConstant:{get:O.default.throwInstantiationError},definitionChanged:{get:O.default.throwInstantiationError}}),_t.prototype.getType=O.default.throwInstantiationError,_t.prototype.getValue=O.default.throwInstantiationError,_t.prototype.equals=O.default.throwInstantiationError,_t.getValue=function(t,e,i){var a;return Object(l.default)(e)&&(a=e.getType(t),Object(l.default)(a))?(Object(l.default)(i)&&i.type===a||(i=et.a.fromType(a)),e.getValue(t,i.uniforms),i):(Object(l.default)(i)&&i.type===et.a.ColorType||(i=et.a.fromType(et.a.ColorType)),b.default.clone(b.default.WHITE,i.uniforms.color),i)};var bt=_t;function Ot(t,e,i){this._primitives=e,this._orderedGroundPrimitives=i,this._primitive=void 0,this._outlinePrimitive=void 0,this._geometryUpdater=t,this._options=t._options,this._entity=t._entity,this._material=void 0}Ot.prototype._isHidden=function(t,e,i){return!t.isShowing||!t.isAvailable(i)||!D.default.getValueOrDefault(e.show,i,!0)},Ot.prototype._setOptions=O.default.throwInstantiationError,Ot.prototype.update=function(t){var e=this._geometryUpdater,i=e._onTerrain,a=this._primitives,r=this._orderedGroundPrimitives;i?r.remove(this._primitive):(a.removeAndDestroy(this._primitive),a.removeAndDestroy(this._outlinePrimitive),this._outlinePrimitive=void 0),this._primitive=void 0;var n=this._entity,o=n[this._geometryUpdater._geometryPropertyName];if(this._setOptions(n,o,t),!this._isHidden(n,o,t)){var s=this._geometryUpdater.shadowsProperty.getValue(t),u=this._options;if(!Object(l.default)(o.fill)||o.fill.getValue(t)){var d,f=e.fillMaterialProperty,h=f instanceof yt.default,p=e._getIsClosed(u);if(h)d=new rt.a({closed:p,flat:i&&!e._supportsMaterialsforEntitiesOnTerrain});else{var m=bt.getValue(t,f,this._material);this._material=m,d=new at({material:m,translucent:m.isTranslucent(),closed:p})}if(i)u.vertexFormat=rt.a.VERTEX_FORMAT,this._primitive=r.add(new c.a({geometryInstances:this._geometryUpdater.createFillGeometryInstance(t),appearance:d,asynchronous:!1,shadows:s,classificationType:this._geometryUpdater.classificationTypeProperty.getValue(t)}),D.default.getValueOrUndefined(this._geometryUpdater.zIndex,t));else{u.vertexFormat=d.vertexFormat;var g=this._geometryUpdater.createFillGeometryInstance(t);h&&(d.translucent=255!==g.attributes.color.value[3]),this._primitive=a.add(new vt.a({geometryInstances:g,appearance:d,asynchronous:!1,shadows:s}))}}if(!i&&Object(l.default)(o.outline)&&o.outline.getValue(t)){var y=this._geometryUpdater.createOutlineGeometryInstance(t),v=D.default.getValueOrDefault(o.outlineWidth,t,1);this._outlinePrimitive=a.add(new vt.a({geometryInstances:y,appearance:new rt.a({flat:!0,translucent:255!==y.attributes.color.value[3],renderState:{lineWidth:e._scene.clampLineWidth(v)}}),asynchronous:!1,shadows:s}))}}},Ot.prototype.getBoundingSphere=function(t){var e,i=this._entity,a=this._primitive,n=this._outlinePrimitive;return Object(l.default)(a)&&a.show&&a.ready&&(e=a.getGeometryInstanceAttributes(i),Object(l.default)(e)&&Object(l.default)(e.boundingSphere))?(r.default.clone(e.boundingSphere,t),j.default.DONE):Object(l.default)(n)&&n.show&&n.ready&&(e=n.getGeometryInstanceAttributes(i),Object(l.default)(e)&&Object(l.default)(e.boundingSphere))?(r.default.clone(e.boundingSphere,t),j.default.DONE):Object(l.default)(a)&&!a.ready||Object(l.default)(n)&&!n.ready?j.default.PENDING:j.default.FAILED},Ot.prototype.isDestroyed=function(){return!1},Ot.prototype.destroy=function(){var t=this._primitives,e=this._orderedGroundPrimitives;this._geometryUpdater._onTerrain?e.remove(this._primitive):t.removeAndDestroy(this._primitive),t.removeAndDestroy(this._outlinePrimitive),Object(u.default)(this)};var wt=Ot,At=i(355),Pt=i(146),Et=i(167),Ct=new yt.default(b.default.WHITE),jt=new Pt.a(!0),Dt=new Pt.a(!0),xt=new Pt.a(!1),Tt=new Pt.a(b.default.BLACK),It=new Pt.a(nt.a.DISABLED),Mt=new Pt.a(new w.a),Vt=new Pt.a(K.a.BOTH);function Nt(t){var e=t.entity,i=t.geometryPropertyName;this._entity=e,this._scene=t.scene,this._fillEnabled=!1,this._isClosed=!1,this._onTerrain=!1,this._dynamic=!1,this._outlineEnabled=!1,this._geometryChanged=new J.default,this._showProperty=void 0,this._materialProperty=void 0,this._showOutlineProperty=void 0,this._outlineColorProperty=void 0,this._outlineWidth=1,this._shadowsProperty=void 0,this._distanceDisplayConditionProperty=void 0,this._classificationTypeProperty=void 0,this._options=t.geometryOptions,this._geometryPropertyName=i,this._id=i+"-"+e.id,this._observedPropertyNames=t.observedPropertyNames,this._supportsMaterialsforEntitiesOnTerrain=Et.default.supportsMaterialsforEntitiesOnTerrain(t.scene)}Object(s.default)(Nt.prototype,{id:{get:function(){return this._id}},entity:{get:function(){return this._entity}},fillEnabled:{get:function(){return this._fillEnabled}},hasConstantFill:{get:function(){return!this._fillEnabled||!Object(l.default)(this._entity.availability)&&D.default.isConstant(this._showProperty)&&D.default.isConstant(this._fillProperty)}},fillMaterialProperty:{get:function(){return this._materialProperty}},outlineEnabled:{get:function(){return this._outlineEnabled}},hasConstantOutline:{get:function(){return!this._outlineEnabled||!Object(l.default)(this._entity.availability)&&D.default.isConstant(this._showProperty)&&D.default.isConstant(this._showOutlineProperty)}},outlineColorProperty:{get:function(){return this._outlineColorProperty}},outlineWidth:{get:function(){return this._outlineWidth}},shadowsProperty:{get:function(){return this._shadowsProperty}},distanceDisplayConditionProperty:{get:function(){return this._distanceDisplayConditionProperty}},classificationTypeProperty:{get:function(){return this._classificationTypeProperty}},isDynamic:{get:function(){return this._dynamic}},isClosed:{get:function(){return this._isClosed}},onTerrain:{get:function(){return this._onTerrain}},geometryChanged:{get:function(){return this._geometryChanged}}}),Nt.prototype.isOutlineVisible=function(t){var e=this._entity,i=this._outlineEnabled&&e.isAvailable(t)&&this._showProperty.getValue(t)&&this._showOutlineProperty.getValue(t);return Object(o.default)(i,!1)},Nt.prototype.isFilled=function(t){var e=this._entity,i=this._fillEnabled&&e.isAvailable(t)&&this._showProperty.getValue(t)&&this._fillProperty.getValue(t);return Object(o.default)(i,!1)},Nt.prototype.createFillGeometryInstance=O.default.throwInstantiationError,Nt.prototype.createOutlineGeometryInstance=O.default.throwInstantiationError,Nt.prototype.isDestroyed=function(){return!1},Nt.prototype.destroy=function(){Object(u.default)(this)},Nt.prototype._isHidden=function(t,e){var i=e.show;return Object(l.default)(i)&&i.isConstant&&!i.getValue(pt.default.MINIMUM_VALUE)},Nt.prototype._isOnTerrain=function(t,e){return!1},Nt.prototype._getIsClosed=function(t){return!0},Nt.prototype._isDynamic=O.default.throwInstantiationError,Nt.prototype._setStaticOptions=O.default.throwInstantiationError,Nt.prototype._onEntityPropertyChanged=function(t,e,i,a){if(-1!==this._observedPropertyNames.indexOf(e)){var r=this._entity[this._geometryPropertyName];if(Object(l.default)(r)){var n=r.fill,s=!Object(l.default)(n)||!n.isConstant||n.getValue(pt.default.MINIMUM_VALUE),u=r.outline,d=Object(l.default)(u);if(d&&u.isConstant&&(d=u.getValue(pt.default.MINIMUM_VALUE)),s||d){var f=r.show;if(this._isHidden(t,r))(this._fillEnabled||this._outlineEnabled)&&(this._fillEnabled=!1,this._outlineEnabled=!1,this._geometryChanged.raiseEvent(this));else{this._materialProperty=Object(o.default)(r.material,Ct),this._fillProperty=Object(o.default)(n,Dt),this._showProperty=Object(o.default)(f,jt),this._showOutlineProperty=Object(o.default)(r.outline,xt),this._outlineColorProperty=d?Object(o.default)(r.outlineColor,Tt):void 0,this._shadowsProperty=Object(o.default)(r.shadows,It),this._distanceDisplayConditionProperty=Object(o.default)(r.distanceDisplayCondition,Mt),this._classificationTypeProperty=Object(o.default)(r.classificationType,Vt),this._fillEnabled=s;var c=this._isOnTerrain(t,r)&&(this._supportsMaterialsforEntitiesOnTerrain||this._materialProperty instanceof yt.default);if(d&&c&&(Object(At.a)(At.a.geometryOutlines),d=!1),this._onTerrain=c,this._outlineEnabled=d,this._isDynamic(t,r))this._dynamic||(this._dynamic=!0,this._geometryChanged.raiseEvent(this));else{this._setStaticOptions(t,r),this._isClosed=this._getIsClosed(this._options);var h=r.outlineWidth;this._outlineWidth=Object(l.default)(h)?h.getValue(pt.default.MINIMUM_VALUE):1,this._dynamic=!1,this._geometryChanged.raiseEvent(this)}}}else(this._fillEnabled||this._outlineEnabled)&&(this._fillEnabled=!1,this._outlineEnabled=!1,this._geometryChanged.raiseEvent(this))}else(this._fillEnabled||this._outlineEnabled)&&(this._fillEnabled=!1,this._outlineEnabled=!1,this._geometryChanged.raiseEvent(this))}},Nt.prototype.createDynamicUpdater=function(t,e){return new this.constructor.DynamicGeometryUpdater(this,t,e)};var St=Nt,Lt=i(281),Ft=i(20),Ut=i(3),Rt=i(13),Ht=new _.default,Bt=new Ft.default;function Gt(t,e,i,a){this._scene=t,this._heightReference=i,this._extrudedHeightReference=a,this._positionProperty=e,this._position=new _.default,this._cartographicPosition=new Ft.default,this._normal=new _.default,this._definitionChanged=new J.default,this._terrainHeight=0,this._removeCallbackFunc=void 0,this._removeEventListener=void 0,this._removeModeListener=void 0;var r=this;if(Object(l.default)(t.globe)&&(this._removeEventListener=t.terrainProviderChanged.addEventListener(function(){r._updateClamping()}),this._removeModeListener=t.morphComplete.addEventListener(function(){r._updateClamping()})),e.isConstant){var n=e.getValue(pt.default.MINIMUM_VALUE,Ht);if(!Object(l.default)(n)||_.default.equals(n,_.default.ZERO)||!Object(l.default)(t.globe))return;this._position=_.default.clone(n,this._position),this._updateClamping(),this._normal=t.globe.ellipsoid.geodeticSurfaceNormal(n,this._normal)}}Object(s.default)(Gt.prototype,{isConstant:{get:function(){return!1}},definitionChanged:{get:function(){return this._definitionChanged}}}),Gt.prototype._updateClamping=function(){Object(l.default)(this._removeCallbackFunc)&&this._removeCallbackFunc();var t=this._scene,e=t.globe,i=this._position;if(Object(l.default)(e)&&!_.default.equals(i,_.default.ZERO)){var a=e.ellipsoid,r=e._surface,n=this,o=a.cartesianToCartographic(i,this._cartographicPosition),s=e.getHeight(o);Object(l.default)(s)?this._terrainHeight=s:this._terrainHeight=0,this._removeCallbackFunc=r.updateHeight(o,function(e){if(t.mode===Rt.a.SCENE3D){var i=a.cartesianToCartographic(e,Bt);n._terrainHeight=i.height}else n._terrainHeight=e.x;n.definitionChanged.raiseEvent()})}else this._terrainHeight=0},Gt.prototype.getValue=function(t,e){var i=D.default.getValueOrDefault(this._heightReference,t,P.default.NONE),a=D.default.getValueOrDefault(this._extrudedHeightReference,t,P.default.NONE);if(i===P.default.NONE&&a!==P.default.RELATIVE_TO_GROUND)return this._position=_.default.clone(_.default.ZERO,this._position),_.default.clone(_.default.ZERO,e);if(this._positionProperty.isConstant)return _.default.multiplyByScalar(this._normal,this._terrainHeight,e);var r=this._scene,n=this._positionProperty.getValue(t,Ht);if(!Object(l.default)(n)||_.default.equals(n,_.default.ZERO)||!Object(l.default)(r.globe))return _.default.clone(_.default.ZERO,e);if(_.default.equalsEpsilon(this._position,n,Ut.default.EPSILON10))return _.default.multiplyByScalar(this._normal,this._terrainHeight,e);this._position=_.default.clone(n,this._position),this._updateClamping();var o=r.globe.ellipsoid.geodeticSurfaceNormal(n,this._normal);return _.default.multiplyByScalar(o,this._terrainHeight,e)},Gt.prototype.isDestroyed=function(){return!1},Gt.prototype.destroy=function(){return Object(l.default)(this._removeEventListener)&&this._removeEventListener(),Object(l.default)(this._removeModeListener)&&this._removeModeListener(),Object(l.default)(this._removeCallbackFunc)&&this._removeCallbackFunc(),Object(u.default)(this)};var kt=Gt;var zt=function(t,e,i,a){if(St.prototype._onEntityPropertyChanged.call(this,t,e,i,a),-1!==this._observedPropertyNames.indexOf(e)){var r=this._entity[this._geometryPropertyName];if(Object(l.default)(r)){Object(l.default)(this._terrainOffsetProperty)&&(this._terrainOffsetProperty.destroy(),this._terrainOffsetProperty=void 0);var n=r.heightReference;if(Object(l.default)(n)){var o=new Lt.default(this._computeCenter.bind(this),!this._dynamic);this._terrainOffsetProperty=new kt(this._scene,o,n)}}}},Wt=_.default.ZERO,Yt=new _.default,qt=new _.default,Xt=new b.default;function Zt(t){this.id=t,this.vertexFormat=void 0,this.dimensions=void 0,this.offsetAttribute=void 0}function Jt(t,e){St.call(this,{entity:t,scene:e,geometryOptions:new Zt(t),geometryPropertyName:"box",observedPropertyNames:["availability","position","orientation","box"]}),this._onEntityPropertyChanged(t,"box",t.box,void 0)}function Kt(t,e,i){wt.call(this,t,e,i)}Object(l.default)(Object.create)&&(Jt.prototype=Object.create(St.prototype),Jt.prototype.constructor=Jt),Object(s.default)(Jt.prototype,{terrainOffsetProperty:{get:function(){return this._terrainOffsetProperty}}}),Jt.prototype.createFillGeometryInstance=function(t){var e,i=this._entity,a=i.isAvailable(t),r=new gt.a(a&&i.isShowing&&this._showProperty.getValue(t)&&this._fillProperty.getValue(t)),n=this._distanceDisplayConditionProperty.getValue(t),o={show:r,distanceDisplayCondition:ft.fromDistanceDisplayCondition(n),color:void 0,offset:void 0};this._materialProperty instanceof yt.default&&(Object(l.default)(this._materialProperty.color)&&(this._materialProperty.color.isConstant||a)&&(e=this._materialProperty.color.getValue(t,Xt)),Object(l.default)(e)||(e=b.default.WHITE),o.color=st.a.fromColor(e));return Object(l.default)(this._options.offsetAttribute)&&(o.offset=mt.a.fromCartesian3(D.default.getValueOrDefault(this._terrainOffsetProperty,t,Wt,Yt))),new ct.a({id:i,geometry:ot.a.fromDimensions(this._options),modelMatrix:i.computeModelMatrixForHeightReference(t,i.box.heightReference,.5*this._options.dimensions.z,this._scene.mapProjection.ellipsoid),attributes:o})},Jt.prototype.createOutlineGeometryInstance=function(t){var e=this._entity,i=e.isAvailable(t),a=D.default.getValueOrDefault(this._outlineColorProperty,t,b.default.BLACK,Xt),r=this._distanceDisplayConditionProperty.getValue(t),n={show:new gt.a(i&&e.isShowing&&this._showProperty.getValue(t)&&this._showOutlineProperty.getValue(t)),color:st.a.fromColor(a),distanceDisplayCondition:ft.fromDistanceDisplayCondition(r),offset:void 0};return Object(l.default)(this._options.offsetAttribute)&&(n.offset=mt.a.fromCartesian3(D.default.getValueOrDefault(this._terrainOffsetProperty,t,Wt,Yt))),new ct.a({id:e,geometry:lt.a.fromDimensions(this._options),modelMatrix:e.computeModelMatrixForHeightReference(t,e.box.heightReference,.5*this._options.dimensions.z,this._scene.mapProjection.ellipsoid),attributes:n})},Jt.prototype._computeCenter=function(t,e){return D.default.getValueOrUndefined(this._entity.position,t,e)},Jt.prototype._isHidden=function(t,e){return!Object(l.default)(e.dimensions)||!Object(l.default)(t.position)||St.prototype._isHidden.call(this,t,e)},Jt.prototype._isDynamic=function(t,e){return!(t.position.isConstant&&D.default.isConstant(t.orientation)&&e.dimensions.isConstant&&D.default.isConstant(e.outlineWidth))},Jt.prototype._setStaticOptions=function(t,e){var i=D.default.getValueOrDefault(e.heightReference,pt.default.MINIMUM_VALUE,P.default.NONE),a=this._options;a.vertexFormat=this._materialProperty instanceof yt.default?rt.a.VERTEX_FORMAT:at.MaterialSupport.TEXTURED.vertexFormat,a.dimensions=e.dimensions.getValue(pt.default.MINIMUM_VALUE,a.dimensions),a.offsetAttribute=i!==P.default.NONE?ht.a.ALL:void 0},Jt.prototype._onEntityPropertyChanged=zt,Jt.DynamicGeometryUpdater=Kt,Object(l.default)(Object.create)&&(Kt.prototype=Object.create(wt.prototype),Kt.prototype.constructor=Kt),Kt.prototype._isHidden=function(t,e,i){var a=D.default.getValueOrUndefined(t.position,i,qt),r=this._options.dimensions;return!Object(l.default)(a)||!Object(l.default)(r)||wt.prototype._isHidden.call(this,t,e,i)},Kt.prototype._setOptions=function(t,e,i){var a=D.default.getValueOrDefault(e.heightReference,i,P.default.NONE),r=this._options;r.dimensions=D.default.getValueOrUndefined(e.dimensions,i,r.dimensions),r.offsetAttribute=a!==P.default.NONE?ht.a.ALL:void 0};var Qt=Jt,$t=i(124),te=i(211),ee=i(1592),ie=i(15),ae=i(424),re=i(16),ne=i(423),oe=i(4),le=i(38),se=i(54),ue=[new _.default,new _.default],de=new _.default,fe=new _.default,ce=new _.default,he=new _.default,pe=new _.default,me=new _.default,ge=new _.default,ye=new _.default,ve=new _.default,_e=new _.default,be=new _.default,Oe={},we=new Ft.default;function Ae(t,e,i,a){var r,n=t[0],o=t[1],l=_.default.angleBetween(n,o),s=Math.ceil(l/a),u=new Array(s);if(e===i){for(r=0;r<s;r++)u[r]=e;return u.push(i),u}var d=(i-e)/s;for(r=1;r<s;r++){var f=e+r*d;u[r]=f}return u[0]=e,u.push(i),u}var Pe=new _.default,Ee=new _.default;var Ce=new _.default(-1,0,0),je=new oe.default,De=new oe.default,xe=new ie.default,Te=ie.default.IDENTITY.clone(),Ie=new _.default,Me=new re.a,Ve=new _.default;function Ne(t,e,i,a,r,n,o,l){var s=Ie,u=Me;je=se.default.eastNorthUpToFixedFrame(t,r,je),s=oe.default.multiplyByPointAsVector(je,Ce,s);var d=function(t,e,i,a){var r=new ne.default(i,a),n=r.projectPointOntoPlane(_.default.add(i,t,Pe),Pe),o=r.projectPointOntoPlane(_.default.add(i,e,Ee),Ee),l=v.default.angleBetween(n,o);return o.x*n.y-o.y*n.x>=0?-l:l}(s=_.default.normalize(s,s),e,t,r);xe=ie.default.fromRotationZ(d,xe),Ve.z=n,je=oe.default.multiplyTransformation(je,oe.default.fromRotationTranslation(xe,Ve,De),je);var f=Te;f[0]=o;for(var c=0;c<l;c++)for(var h=0;h<i.length;h+=3)u=_.default.fromArray(i,h,u),u=ie.default.multiplyByVector(f,u,u),u=oe.default.multiplyByPoint(je,u,u),a.push(u.x,u.y,u.z);return a}var Se=new _.default;function Le(t,e,i,a,r,n,o){for(var l=0;l<t.length;l+=3){a=Ne(_.default.fromArray(t,l,Se),e,i,a,r,n[l/3],o,1)}return a}function Fe(t,e){for(var i=t.length,a=new Array(3*i),r=0,n=e.x+e.width/2,o=e.y+e.height/2,l=0;l<i;l++)a[r++]=t[l].x-n,a[r++]=0,a[r++]=t[l].y-o;return a}var Ue=new le.default,Re=new _.default,He=new ie.default;function Be(t,e,i,a,r,n,o,l,s,u){var d,f,c=_.default.angleBetween(_.default.subtract(e,t,_e),_.default.subtract(i,t,be)),h=a===ee.a.BEVELED?0:Math.ceil(c/Ut.default.toRadians(5));if(d=r?ie.default.fromQuaternion(le.default.fromAxisAngle(_.default.negate(t,_e),c/(h+1),Ue),He):ie.default.fromQuaternion(le.default.fromAxisAngle(t,c/(h+1),Ue),He),e=_.default.clone(e,Re),h>0)for(var p=u?2:1,m=0;m<h;m++)e=ie.default.multiplyByVector(d,e,e),f=_.default.subtract(e,t,_e),f=_.default.normalize(f,f),r||(f=_.default.negate(f,f)),o=Ne(n.scaleToGeodeticSurface(e,be),f,l,o,n,s,1,p);else f=_.default.subtract(e,t,_e),f=_.default.normalize(f,f),r||(f=_.default.negate(f,f)),o=Ne(n.scaleToGeodeticSurface(e,be),f,l,o,n,s,1,1),i=_.default.clone(i,Re),f=_.default.subtract(i,t,_e),f=_.default.normalize(f,f),r||(f=_.default.negate(f,f)),o=Ne(n.scaleToGeodeticSurface(i,be),f,l,o,n,s,1,1);return o}Oe.removeDuplicatesFromShape=function(t){for(var e=t.length,i=[],a=e-1,r=0;r<e;a=r++){var n=t[a],o=t[r];v.default.equals(n,o)||i.push(o)}return i},Oe.angleIsGreaterThanPi=function(t,e,i,a){var r=new ne.default(i,a),n=r.projectPointOntoPlane(_.default.add(i,t,Pe),Pe),o=r.projectPointOntoPlane(_.default.add(i,e,Ee),Ee);return o.x*n.y-o.y*n.x>=0};var Ge=new _.default,ke=new _.default;Oe.computePositions=function(t,e,i,a,r){var n=a._ellipsoid,o=function(t,e){for(var i=new Array(t.length),a=0;a<t.length;a++){var r=t[a];we=e.cartesianToCartographic(r,we),i[a]=we.height,t[a]=e.scaleToGeodeticSurface(r,r)}return i}(t,n),l=a._granularity,s=a._cornerType,u=r?function(t,e){var i=t.length,a=new Array(6*i),r=0,n=e.x+e.width/2,o=e.y+e.height/2,l=t[0];a[r++]=l.x-n,a[r++]=0,a[r++]=l.y-o;for(var s=1;s<i;s++){var u=(l=t[s]).x-n,d=l.y-o;a[r++]=u,a[r++]=0,a[r++]=d,a[r++]=u,a[r++]=0,a[r++]=d}return l=t[0],a[r++]=l.x-n,a[r++]=0,a[r++]=l.y-o,a}(e,i):Fe(e,i),d=r?Fe(e,i):void 0,f=i.height/2,c=i.width/2,h=t.length,p=[],m=r?[]:void 0,g=de,y=fe,v=ce,b=he,O=pe,w=me,A=ge,P=ye,E=ve,C=t[0],j=t[1];b=n.geodeticSurfaceNormal(C,b),g=_.default.subtract(j,C,g),g=_.default.normalize(g,g),P=_.default.cross(b,g,P),P=_.default.normalize(P,P);var D,x=o[0],T=o[1];r&&(m=Ne(C,P,d,m,n,x+f,1,1)),E=_.default.clone(C,E),C=j,y=_.default.negate(g,y);for(var I=1;I<h-1;I++){var M=r?2:1;j=t[I+1],g=_.default.subtract(j,C,g),g=_.default.normalize(g,g),v=_.default.add(g,y,v),v=_.default.normalize(v,v),b=n.geodeticSurfaceNormal(C,b);var V=_.default.multiplyByScalar(b,_.default.dot(g,b),Ge);_.default.subtract(g,V,V),_.default.normalize(V,V);var N=_.default.multiplyByScalar(b,_.default.dot(y,b),ke);if(_.default.subtract(y,N,N),_.default.normalize(N,N),!Ut.default.equalsEpsilon(Math.abs(_.default.dot(V,N)),1,Ut.default.EPSILON7)){v=_.default.cross(v,b,v),v=_.default.cross(b,v,v),v=_.default.normalize(v,v);var S=1/Math.max(.25,_.default.magnitude(_.default.cross(v,y,_e))),L=Oe.angleIsGreaterThanPi(g,y,C,n);L?(O=_.default.add(C,_.default.multiplyByScalar(v,S*c,v),O),w=_.default.add(O,_.default.multiplyByScalar(P,c,w),w),ue[0]=_.default.clone(E,ue[0]),ue[1]=_.default.clone(w,ue[1]),D=Ae(ue,x+f,T+f,l),p=Le(ae.a.generateArc({positions:ue,granularity:l,ellipsoid:n}),P,u,p,n,D,1),P=_.default.cross(b,g,P),P=_.default.normalize(P,P),A=_.default.add(O,_.default.multiplyByScalar(P,c,A),A),s===ee.a.ROUNDED||s===ee.a.BEVELED?Be(O,w,A,s,L,n,p,u,T+f,r):p=Ne(C,v=_.default.negate(v,v),u,p,n,T+f,S,M),E=_.default.clone(A,E)):(O=_.default.add(C,_.default.multiplyByScalar(v,S*c,v),O),w=_.default.add(O,_.default.multiplyByScalar(P,-c,w),w),ue[0]=_.default.clone(E,ue[0]),ue[1]=_.default.clone(w,ue[1]),D=Ae(ue,x+f,T+f,l),p=Le(ae.a.generateArc({positions:ue,granularity:l,ellipsoid:n}),P,u,p,n,D,1),P=_.default.cross(b,g,P),P=_.default.normalize(P,P),A=_.default.add(O,_.default.multiplyByScalar(P,-c,A),A),s===ee.a.ROUNDED||s===ee.a.BEVELED?Be(O,w,A,s,L,n,p,u,T+f,r):p=Ne(C,v,u,p,n,T+f,S,M),E=_.default.clone(A,E)),y=_.default.negate(g,y)}else p=Ne(E,P,u,p,n,x+f,1,1),E=C;x=T,T=o[I+1],C=j}ue[0]=_.default.clone(E,ue[0]),ue[1]=_.default.clone(C,ue[1]),D=Ae(ue,x+f,T+f,l),p=Le(ae.a.generateArc({positions:ue,granularity:l,ellipsoid:n}),P,u,p,n,D,1),r&&(m=Ne(C,P,d,m,n,T+f,1,1)),h=p.length;var F=r?h+m.length:h,U=new Float64Array(F);return U.set(p),r&&U.set(m,h),U};var ze=Oe,We={},Ye=new _.default,qe=new _.default,Xe=new _.default,Ze=new _.default,Je=[new _.default,new _.default],Ke=new _.default,Qe=new _.default,$e=new _.default,ti=new _.default,ei=new _.default,ii=new _.default,ai=new _.default,ri=new _.default,ni=new _.default,oi=new _.default,li=new le.default,si=new ie.default;function ui(t,e,i,a,r){var n,o=_.default.angleBetween(_.default.subtract(e,t,Ye),_.default.subtract(i,t,qe)),l=a===ee.a.BEVELED?1:Math.ceil(o/Ut.default.toRadians(5))+1,s=3*l,u=new Array(s);u[s-3]=i.x,u[s-2]=i.y,u[s-1]=i.z,n=r?ie.default.fromQuaternion(le.default.fromAxisAngle(_.default.negate(t,Ye),o/l,li),si):ie.default.fromQuaternion(le.default.fromAxisAngle(t,o/l,li),si);var d=0;e=_.default.clone(e,Ye);for(var f=0;f<l;f++)e=ie.default.multiplyByVector(n,e,e),u[d++]=e.x,u[d++]=e.y,u[d++]=e.z;return u}function di(t,e,i,a){var r=Ye;return a?r=_.default.add(t,e,r):(e=_.default.negate(e,e),r=_.default.add(t,e,r)),[r.x,r.y,r.z,i.x,i.y,i.z]}function fi(t,e,i,a){for(var r=new Array(t.length),n=new Array(t.length),o=_.default.multiplyByScalar(e,i,Ye),l=_.default.negate(o,qe),s=0,u=t.length-1,d=0;d<t.length;d+=3){var f=_.default.fromArray(t,d,Xe),c=_.default.add(f,l,Ze);r[s++]=c.x,r[s++]=c.y,r[s++]=c.z;var h=_.default.add(f,o,Ze);n[u--]=h.z,n[u--]=h.y,n[u--]=h.x}return a.push(r,n),a}We.addAttribute=function(t,e,i,a){var r=e.x,n=e.y,o=e.z;Object(l.default)(i)&&(t[i]=r,t[i+1]=n,t[i+2]=o),Object(l.default)(a)&&(t[a]=o,t[a-1]=n,t[a-2]=r)};var ci=new _.default,hi=new _.default;We.computePositions=function(t){var e=t.granularity,i=t.positions,a=t.ellipsoid,r=t.width/2,n=t.cornerType,o=t.saveAttributes,l=Ke,s=Qe,u=$e,d=ti,f=ei,c=ii,h=ai,p=ri,m=ni,g=oi,y=[],v=o?[]:void 0,b=o?[]:void 0,O=i[0],w=i[1];s=_.default.normalize(_.default.subtract(w,O,s),s),l=a.geodeticSurfaceNormal(O,l),d=_.default.normalize(_.default.cross(l,s,d),d),o&&(v.push(d.x,d.y,d.z),b.push(l.x,l.y,l.z)),h=_.default.clone(O,h),O=w,u=_.default.negate(s,u);var A,P,E=[],C=i.length;for(A=1;A<C-1;A++){l=a.geodeticSurfaceNormal(O,l),w=i[A+1],s=_.default.normalize(_.default.subtract(w,O,s),s),f=_.default.normalize(_.default.add(s,u,f),f);var j=_.default.multiplyByScalar(l,_.default.dot(s,l),ci);_.default.subtract(s,j,j),_.default.normalize(j,j);var D=_.default.multiplyByScalar(l,_.default.dot(u,l),hi);if(_.default.subtract(u,D,D),_.default.normalize(D,D),!Ut.default.equalsEpsilon(Math.abs(_.default.dot(j,D)),1,Ut.default.EPSILON7)){f=_.default.cross(f,l,f),f=_.default.cross(l,f,f),f=_.default.normalize(f,f);var x=r/Math.max(.25,_.default.magnitude(_.default.cross(f,u,Ye))),T=ze.angleIsGreaterThanPi(s,u,O,a);f=_.default.multiplyByScalar(f,x,f),T?(p=_.default.add(O,f,p),g=_.default.add(p,_.default.multiplyByScalar(d,r,g),g),m=_.default.add(p,_.default.multiplyByScalar(d,2*r,m),m),Je[0]=_.default.clone(h,Je[0]),Je[1]=_.default.clone(g,Je[1]),y=fi(ae.a.generateArc({positions:Je,granularity:e,ellipsoid:a}),d,r,y),o&&(v.push(d.x,d.y,d.z),b.push(l.x,l.y,l.z)),c=_.default.clone(m,c),d=_.default.normalize(_.default.cross(l,s,d),d),m=_.default.add(p,_.default.multiplyByScalar(d,2*r,m),m),h=_.default.add(p,_.default.multiplyByScalar(d,r,h),h),n===ee.a.ROUNDED||n===ee.a.BEVELED?E.push({leftPositions:ui(p,c,m,n,T)}):E.push({leftPositions:di(O,_.default.negate(f,f),m,T)})):(m=_.default.add(O,f,m),g=_.default.add(m,_.default.negate(_.default.multiplyByScalar(d,r,g),g),g),p=_.default.add(m,_.default.negate(_.default.multiplyByScalar(d,2*r,p),p),p),Je[0]=_.default.clone(h,Je[0]),Je[1]=_.default.clone(g,Je[1]),y=fi(ae.a.generateArc({positions:Je,granularity:e,ellipsoid:a}),d,r,y),o&&(v.push(d.x,d.y,d.z),b.push(l.x,l.y,l.z)),c=_.default.clone(p,c),d=_.default.normalize(_.default.cross(l,s,d),d),p=_.default.add(m,_.default.negate(_.default.multiplyByScalar(d,2*r,p),p),p),h=_.default.add(m,_.default.negate(_.default.multiplyByScalar(d,r,h),h),h),n===ee.a.ROUNDED||n===ee.a.BEVELED?E.push({rightPositions:ui(m,c,p,n,T)}):E.push({rightPositions:di(O,f,p,T)})),u=_.default.negate(s,u)}O=w}return l=a.geodeticSurfaceNormal(O,l),Je[0]=_.default.clone(h,Je[0]),Je[1]=_.default.clone(O,Je[1]),y=fi(ae.a.generateArc({positions:Je,granularity:e,ellipsoid:a}),d,r,y),o&&(v.push(d.x,d.y,d.z),b.push(l.x,l.y,l.z)),n===ee.a.ROUNDED&&(P=function(t){var e=Ke,i=Qe,a=$e,r=t[1];i=_.default.fromArray(t[1],r.length-3,i),a=_.default.fromArray(t[0],0,a);var n=ui(e=_.default.midpoint(i,a,e),i,a,ee.a.ROUNDED,!1),o=t.length-1,l=t[o-1];return r=t[o],i=_.default.fromArray(l,l.length-3,i),a=_.default.fromArray(r,0,a),[n,ui(e=_.default.midpoint(i,a,e),i,a,ee.a.ROUNDED,!1)]}(y)),{positions:y,corners:E,lefts:v,normals:b,endPositions:P}};var pi=We,mi=i(28),gi=i(68),yi=i(57),vi=i(141),_i=i(53),bi=i(210),Oi=i(42),wi=i(23),Ai=new _.default,Pi=new _.default,Ei=new _.default,Ci=new _.default,ji=new _.default,Di=new _.default,xi=new _.default,Ti=new _.default;function Ii(t,e){for(var i=0;i<t.length;i++)t[i]=e.scaleToGeodeticSurface(t[i],t[i]);return t}function Mi(t,e,i,a,r,n){var o=t.normals,l=t.tangents,s=t.bitangents,u=_.default.normalize(_.default.cross(i,e,xi),xi);n.normal&&pi.addAttribute(o,e,a,r),n.tangent&&pi.addAttribute(l,u,a,r),n.bitangent&&pi.addAttribute(s,i,a,r)}function Vi(t,e,i){var a,r,n,o=t.positions,s=t.corners,u=t.endPositions,d=t.lefts,f=t.normals,c=new vi.a,h=0,p=0,m=0;for(r=0;r<o.length;r+=2)h+=n=o[r].length-3,m+=2*n,p+=o[r+1].length-3;for(h+=3,p+=3,r=0;r<s.length;r++){a=s[r];var g=s[r].leftPositions;Object(l.default)(g)?(h+=n=g.length,m+=n):(p+=n=s[r].rightPositions.length,m+=n)}var y,v=Object(l.default)(u);v&&(h+=y=u[0].length-3,p+=y,m+=6*(y/=3));var b,O,w,A,P,E,C=h+p,j=new Float64Array(C),D={normals:e.normal?new Float32Array(C):void 0,tangents:e.tangent?new Float32Array(C):void 0,bitangents:e.bitangent?new Float32Array(C):void 0},x=0,T=C-1,I=Ai,M=Pi,V=y/2,N=_i.a.createTypedArray(C/3,m),S=0;if(v){E=Ei,P=Ci;var L=u[0];for(I=_.default.fromArray(f,0,I),M=_.default.fromArray(d,0,M),r=0;r<V;r++)E=_.default.fromArray(L,3*(V-1-r),E),P=_.default.fromArray(L,3*(V+r),P),pi.addAttribute(j,P,x),pi.addAttribute(j,E,void 0,T),Mi(D,I,M,x,T,e),A=(O=x/3)+1,w=(b=(T-2)/3)-1,N[S++]=b,N[S++]=O,N[S++]=w,N[S++]=w,N[S++]=O,N[S++]=A,x+=3,T-=3}var F,U,R=0,H=0,B=o[R++],G=o[R++];for(j.set(B,x),j.set(G,T-G.length+1),M=_.default.fromArray(d,H,M),n=G.length-3,r=0;r<n;r+=3)F=i.geodeticSurfaceNormal(_.default.fromArray(B,r,xi),xi),U=i.geodeticSurfaceNormal(_.default.fromArray(G,n-r,Ti),Ti),Mi(D,I=_.default.normalize(_.default.add(F,U,I),I),M,x,T,e),A=(O=x/3)+1,w=(b=(T-2)/3)-1,N[S++]=b,N[S++]=O,N[S++]=w,N[S++]=w,N[S++]=O,N[S++]=A,x+=3,T-=3;for(F=i.geodeticSurfaceNormal(_.default.fromArray(B,n,xi),xi),U=i.geodeticSurfaceNormal(_.default.fromArray(G,n,Ti),Ti),I=_.default.normalize(_.default.add(F,U,I),I),H+=3,r=0;r<s.length;r++){var k,z,W,Y=(a=s[r]).leftPositions,q=a.rightPositions,X=Di,Z=Ei,J=Ci;if(I=_.default.fromArray(f,H,I),Object(l.default)(Y)){for(Mi(D,I,M,void 0,T,e),T-=3,z=A,W=w,k=0;k<Y.length/3;k++)X=_.default.fromArray(Y,3*k,X),N[S++]=z,N[S++]=W-k-1,N[S++]=W-k,pi.addAttribute(j,X,void 0,T),Z=_.default.fromArray(j,3*(W-k-1),Z),J=_.default.fromArray(j,3*z,J),Mi(D,I,M=_.default.normalize(_.default.subtract(Z,J,M),M),void 0,T,e),T-=3;X=_.default.fromArray(j,3*z,X),Z=_.default.subtract(_.default.fromArray(j,3*W,Z),X,Z),J=_.default.subtract(_.default.fromArray(j,3*(W-k),J),X,J),Mi(D,I,M=_.default.normalize(_.default.add(Z,J,M),M),x,void 0,e),x+=3}else{for(Mi(D,I,M,x,void 0,e),x+=3,z=w,W=A,k=0;k<q.length/3;k++)X=_.default.fromArray(q,3*k,X),N[S++]=z,N[S++]=W+k,N[S++]=W+k+1,pi.addAttribute(j,X,x),Z=_.default.fromArray(j,3*z,Z),J=_.default.fromArray(j,3*(W+k),J),Mi(D,I,M=_.default.normalize(_.default.subtract(Z,J,M),M),x,void 0,e),x+=3;X=_.default.fromArray(j,3*z,X),Z=_.default.subtract(_.default.fromArray(j,3*(W+k),Z),X,Z),J=_.default.subtract(_.default.fromArray(j,3*W,J),X,J),Mi(D,I,M=_.default.normalize(_.default.negate(_.default.add(J,Z,M),M),M),void 0,T,e),T-=3}for(B=o[R++],G=o[R++],B.splice(0,3),G.splice(G.length-3,3),j.set(B,x),j.set(G,T-G.length+1),n=G.length-3,H+=3,M=_.default.fromArray(d,H,M),k=0;k<G.length;k+=3)F=i.geodeticSurfaceNormal(_.default.fromArray(B,k,xi),xi),U=i.geodeticSurfaceNormal(_.default.fromArray(G,n-k,Ti),Ti),Mi(D,I=_.default.normalize(_.default.add(F,U,I),I),M,x,T,e),O=(A=x/3)-1,b=(w=(T-2)/3)+1,N[S++]=b,N[S++]=O,N[S++]=w,N[S++]=w,N[S++]=O,N[S++]=A,x+=3,T-=3;x-=3,T+=3}if(Mi(D,I=_.default.fromArray(f,f.length-3,I),M,x,T,e),v){x+=3,T-=3,E=Ei,P=Ci;var K=u[1];for(r=0;r<V;r++)E=_.default.fromArray(K,3*(y-r-1),E),P=_.default.fromArray(K,3*r,P),pi.addAttribute(j,E,void 0,T),pi.addAttribute(j,P,x),Mi(D,I,M,x,T,e),O=(A=x/3)-1,b=(w=(T-2)/3)+1,N[S++]=b,N[S++]=O,N[S++]=w,N[S++]=w,N[S++]=O,N[S++]=A,x+=3,T-=3}if(c.position=new yi.a({componentDatatype:ut.a.DOUBLE,componentsPerAttribute:3,values:j}),e.st){var Q,$,tt=new Float32Array(C/3*2),et=0;if(v){h/=3,p/=3;var it,at=Math.PI/(y+1);$=1/(h-y+1),Q=1/(p-y+1);var rt=y/2;for(r=rt+1;r<y+1;r++)it=Ut.default.PI_OVER_TWO+at*r,tt[et++]=Q*(1+Math.cos(it)),tt[et++]=.5*(1+Math.sin(it));for(r=1;r<p-y+1;r++)tt[et++]=r*Q,tt[et++]=0;for(r=y;r>rt;r--)it=Ut.default.PI_OVER_TWO-r*at,tt[et++]=1-Q*(1+Math.cos(it)),tt[et++]=.5*(1+Math.sin(it));for(r=rt;r>0;r--)it=Ut.default.PI_OVER_TWO-at*r,tt[et++]=1-$*(1+Math.cos(it)),tt[et++]=.5*(1+Math.sin(it));for(r=h-y;r>0;r--)tt[et++]=r*$,tt[et++]=1;for(r=1;r<rt+1;r++)it=Ut.default.PI_OVER_TWO+at*r,tt[et++]=$*(1+Math.cos(it)),tt[et++]=.5*(1+Math.sin(it))}else{for($=1/((h/=3)-1),Q=1/((p/=3)-1),r=0;r<p;r++)tt[et++]=r*Q,tt[et++]=0;for(r=h;r>0;r--)tt[et++]=(r-1)*$,tt[et++]=1}c.st=new yi.a({componentDatatype:ut.a.FLOAT,componentsPerAttribute:2,values:tt})}return e.normal&&(c.normal=new yi.a({componentDatatype:ut.a.FLOAT,componentsPerAttribute:3,values:D.normals})),e.tangent&&(c.tangent=new yi.a({componentDatatype:ut.a.FLOAT,componentsPerAttribute:3,values:D.tangents})),e.bitangent&&(c.bitangent=new yi.a({componentDatatype:ut.a.FLOAT,componentsPerAttribute:3,values:D.bitangents})),{attributes:c,indices:N}}function Ni(t,e,i){i[e++]=t[0],i[e++]=t[1],i[e++]=t[2];for(var a=3;a<t.length;a+=3){var r=t[a],n=t[a+1],o=t[a+2];i[e++]=r,i[e++]=n,i[e++]=o,i[e++]=r,i[e++]=n,i[e++]=o}return i[e++]=t[0],i[e++]=t[1],i[e++]=t[2],i}function Si(t,e){var i=new $.default({position:e.position,normal:e.normal||e.bitangent||t.shadowVolume,tangent:e.tangent,bitangent:e.normal||e.bitangent,st:e.st}),a=t.ellipsoid,r=Vi(pi.computePositions(t),i,a),n=t.height,o=t.extrudedHeight,s=r.attributes,u=r.indices,d=s.position.values,f=d.length,c=new Float64Array(6*f),h=new Float64Array(f);h.set(d);var p,m=new Float64Array(4*f);m=Ni(d=bi.a.scaleToGeodeticHeight(d,n,a),0,m),m=Ni(h=bi.a.scaleToGeodeticHeight(h,o,a),2*f,m),c.set(d),c.set(h,f),c.set(m,2*f),s.position.values=c,s=function(t,e){if(!(e.normal||e.tangent||e.bitangent||e.st))return t;var i,a,r=t.position.values;(e.normal||e.bitangent)&&(i=t.normal.values,a=t.bitangent.values);var n,o=t.position.values.length/18,l=3*o,s=2*o,u=2*l;if(e.normal||e.bitangent||e.tangent){var d=e.normal?new Float32Array(6*l):void 0,f=e.tangent?new Float32Array(6*l):void 0,c=e.bitangent?new Float32Array(6*l):void 0,h=Ai,p=Pi,m=Ei,g=Ci,y=ji,v=Di,b=u;for(n=0;n<l;n+=3){var O=b+u;h=_.default.fromArray(r,n,h),p=_.default.fromArray(r,n+l,p),m=_.default.fromArray(r,(n+3)%l,m),p=_.default.subtract(p,h,p),m=_.default.subtract(m,h,m),g=_.default.normalize(_.default.cross(p,m,g),g),e.normal&&(pi.addAttribute(d,g,O),pi.addAttribute(d,g,O+3),pi.addAttribute(d,g,b),pi.addAttribute(d,g,b+3)),(e.tangent||e.bitangent)&&(v=_.default.fromArray(i,n,v),e.bitangent&&(pi.addAttribute(c,v,O),pi.addAttribute(c,v,O+3),pi.addAttribute(c,v,b),pi.addAttribute(c,v,b+3)),e.tangent&&(y=_.default.normalize(_.default.cross(v,g,y),y),pi.addAttribute(f,y,O),pi.addAttribute(f,y,O+3),pi.addAttribute(f,y,b),pi.addAttribute(f,y,b+3))),b+=6}if(e.normal){for(d.set(i),n=0;n<l;n+=3)d[n+l]=-i[n],d[n+l+1]=-i[n+1],d[n+l+2]=-i[n+2];t.normal.values=d}else t.normal=void 0;if(e.bitangent?(c.set(a),c.set(a,l),t.bitangent.values=c):t.bitangent=void 0,e.tangent){var w=t.tangent.values;f.set(w),f.set(w,l),t.tangent.values=f}}if(e.st){var A=t.st.values,P=new Float32Array(6*s);P.set(A),P.set(A,s);for(var E=2*s,C=0;C<2;C++){for(P[E++]=A[0],P[E++]=A[1],n=2;n<s;n+=2){var j=A[n],D=A[n+1];P[E++]=j,P[E++]=D,P[E++]=j,P[E++]=D}P[E++]=A[0],P[E++]=A[1]}t.st.values=P}return t}(s,e);var g=f/3;if(t.shadowVolume){var y=s.normal.values;f=y.length;var v=new Float32Array(6*f);for(p=0;p<f;p++)y[p]=-y[p];v.set(y,f),v=Ni(y,4*f,v),s.extrudeDirection=new yi.a({componentDatatype:ut.a.FLOAT,componentsPerAttribute:3,values:v}),e.normal||(s.normal=void 0)}if(Object(l.default)(t.offsetAttribute)){var b=new Uint8Array(6*g);if(t.offsetAttribute===ht.a.TOP)b=Object($t.a)(b,1,0,g),b=Object($t.a)(b,1,2*g,4*g);else{var O=t.offsetAttribute===ht.a.NONE?0:1;b=Object($t.a)(b,O)}s.applyOffset=new yi.a({componentDatatype:ut.a.UNSIGNED_BYTE,componentsPerAttribute:1,values:b})}var w=u.length,A=g+g,P=_i.a.createTypedArray(c.length/3,2*w+3*A);P.set(u);var E,C,j,D,x=w;for(p=0;p<w;p+=3){var T=u[p],I=u[p+1],M=u[p+2];P[x++]=M+g,P[x++]=I+g,P[x++]=T+g}for(p=0;p<A;p+=2)j=(E=p+A)+1,D=(C=E+A)+1,P[x++]=E,P[x++]=C,P[x++]=j,P[x++]=j,P[x++]=C,P[x++]=D;return{attributes:s,indices:P}}var Li=new _.default,Fi=new _.default,Ui=new Ft.default;function Ri(t,e,i,a,r,n){var o=_.default.subtract(e,t,Li);_.default.normalize(o,o);var l=i.geodeticSurfaceNormal(t,Fi),s=_.default.cross(o,l,Li);_.default.multiplyByScalar(s,a,s);var u=r.latitude,d=r.longitude,f=n.latitude,c=n.longitude;_.default.add(t,s,Fi),i.cartesianToCartographic(Fi,Ui);var h=Ui.latitude,p=Ui.longitude;u=Math.min(u,h),d=Math.min(d,p),f=Math.max(f,h),c=Math.max(c,p),_.default.subtract(t,s,Fi),i.cartesianToCartographic(Fi,Ui),h=Ui.latitude,p=Ui.longitude,u=Math.min(u,h),d=Math.min(d,p),f=Math.max(f,h),c=Math.max(c,p),r.latitude=u,r.longitude=d,n.latitude=f,n.longitude=c}var Hi=new _.default,Bi=new _.default,Gi=new Ft.default,ki=new Ft.default;function zi(t,e,i,a,r){t=Ii(t,e);var n=Object(te.a)(t,_.default.equalsEpsilon),o=n.length;if(o<2||i<=0)return new wi.default;var s,u,d=.5*i;if(Gi.latitude=Number.POSITIVE_INFINITY,Gi.longitude=Number.POSITIVE_INFINITY,ki.latitude=Number.NEGATIVE_INFINITY,ki.longitude=Number.NEGATIVE_INFINITY,a===ee.a.ROUNDED){var f=n[0];_.default.subtract(f,n[1],Hi),_.default.normalize(Hi,Hi),_.default.multiplyByScalar(Hi,d,Hi),_.default.add(f,Hi,Bi),e.cartesianToCartographic(Bi,Ui),s=Ui.latitude,u=Ui.longitude,Gi.latitude=Math.min(Gi.latitude,s),Gi.longitude=Math.min(Gi.longitude,u),ki.latitude=Math.max(ki.latitude,s),ki.longitude=Math.max(ki.longitude,u)}for(var c=0;c<o-1;++c)Ri(n[c],n[c+1],e,d,Gi,ki);var h=n[o-1];_.default.subtract(h,n[o-2],Hi),_.default.normalize(Hi,Hi),_.default.multiplyByScalar(Hi,d,Hi),_.default.add(h,Hi,Bi),Ri(h,Bi,e,d,Gi,ki),a===ee.a.ROUNDED&&(e.cartesianToCartographic(Bi,Ui),s=Ui.latitude,u=Ui.longitude,Gi.latitude=Math.min(Gi.latitude,s),Gi.longitude=Math.min(Gi.longitude,u),ki.latitude=Math.max(ki.latitude,s),ki.longitude=Math.max(ki.longitude,u));var p=Object(l.default)(r)?r:new wi.default;return p.north=ki.latitude,p.south=Gi.latitude,p.east=ki.longitude,p.west=Gi.longitude,p}function Wi(t){var e=(t=Object(o.default)(t,o.default.EMPTY_OBJECT)).positions,i=t.width,a=Object(o.default)(t.height,0),r=Object(o.default)(t.extrudedHeight,a);this._positions=e,this._ellipsoid=mi.default.clone(Object(o.default)(t.ellipsoid,mi.default.WGS84)),this._vertexFormat=$.default.clone(Object(o.default)(t.vertexFormat,$.default.DEFAULT)),this._width=i,this._height=Math.max(a,r),this._extrudedHeight=Math.min(a,r),this._cornerType=Object(o.default)(t.cornerType,ee.a.ROUNDED),this._granularity=Object(o.default)(t.granularity,Ut.default.RADIANS_PER_DEGREE),this._shadowVolume=Object(o.default)(t.shadowVolume,!1),this._workerName="createCorridorGeometry",this._offsetAttribute=t.offsetAttribute,this._rectangle=void 0,this.packedLength=1+e.length*_.default.packedLength+mi.default.packedLength+$.default.packedLength+7}Wi.pack=function(t,e,i){i=Object(o.default)(i,0);var a=t._positions,r=a.length;e[i++]=r;for(var n=0;n<r;++n,i+=_.default.packedLength)_.default.pack(a[n],e,i);return mi.default.pack(t._ellipsoid,e,i),i+=mi.default.packedLength,$.default.pack(t._vertexFormat,e,i),i+=$.default.packedLength,e[i++]=t._width,e[i++]=t._height,e[i++]=t._extrudedHeight,e[i++]=t._cornerType,e[i++]=t._granularity,e[i++]=t._shadowVolume?1:0,e[i]=Object(o.default)(t._offsetAttribute,-1),e};var Yi=mi.default.clone(mi.default.UNIT_SPHERE),qi=new $.default,Xi={positions:void 0,ellipsoid:Yi,vertexFormat:qi,width:void 0,height:void 0,extrudedHeight:void 0,cornerType:void 0,granularity:void 0,shadowVolume:void 0,offsetAttribute:void 0};Wi.unpack=function(t,e,i){e=Object(o.default)(e,0);for(var a=t[e++],r=new Array(a),n=0;n<a;++n,e+=_.default.packedLength)r[n]=_.default.unpack(t,e);var s=mi.default.unpack(t,e,Yi);e+=mi.default.packedLength;var u=$.default.unpack(t,e,qi);e+=$.default.packedLength;var d=t[e++],f=t[e++],c=t[e++],h=t[e++],p=t[e++],m=1===t[e++],g=t[e];return Object(l.default)(i)?(i._positions=r,i._ellipsoid=mi.default.clone(s,i._ellipsoid),i._vertexFormat=$.default.clone(u,i._vertexFormat),i._width=d,i._height=f,i._extrudedHeight=c,i._cornerType=h,i._granularity=p,i._shadowVolume=m,i._offsetAttribute=-1===g?void 0:g,i):(Xi.positions=r,Xi.width=d,Xi.height=f,Xi.extrudedHeight=c,Xi.cornerType=h,Xi.granularity=p,Xi.shadowVolume=m,Xi.offsetAttribute=-1===g?void 0:g,new Wi(Xi))},Wi.computeRectangle=function(t,e){var i=(t=Object(o.default)(t,o.default.EMPTY_OBJECT)).positions,a=t.width;return zi(i,Object(o.default)(t.ellipsoid,mi.default.WGS84),a,Object(o.default)(t.cornerType,ee.a.ROUNDED),e)},Wi.createGeometry=function(t){var e=t._positions,i=t._width,a=t._ellipsoid;e=Ii(e,a);var n=Object(te.a)(e,_.default.equalsEpsilon);if(!(n.length<2||i<=0)){var o,s=t._height,u=t._extrudedHeight,d=!Ut.default.equalsEpsilon(s,u,0,Ut.default.EPSILON2),f=t._vertexFormat,c={ellipsoid:a,positions:n,width:i,cornerType:t._cornerType,granularity:t._granularity,saveAttributes:!0};if(d)c.height=s,c.extrudedHeight=u,c.shadowVolume=t._shadowVolume,c.offsetAttribute=t._offsetAttribute,o=Si(c,f);else if((o=Vi(pi.computePositions(c),f,a)).attributes.position.values=bi.a.scaleToGeodeticHeight(o.attributes.position.values,s,a),Object(l.default)(t._offsetAttribute)){var h=t._offsetAttribute===ht.a.NONE?0:1,p=o.attributes.position.values.length,m=new Uint8Array(p/3);Object($t.a)(m,h),o.attributes.applyOffset=new yi.a({componentDatatype:ut.a.UNSIGNED_BYTE,componentsPerAttribute:1,values:m})}var g=o.attributes,y=r.default.fromVertices(g.position.values,void 0,3);return f.position||(o.attributes.position.values=void 0),new gi.a({attributes:g,indices:o.indices,primitiveType:Oi.a.TRIANGLES,boundingSphere:y,offsetAttribute:t._offsetAttribute})}},Wi.createShadowVolume=function(t,e,i){var a=t._granularity,r=t._ellipsoid,n=e(a,r),o=i(a,r);return new Wi({positions:t._positions,width:t._width,cornerType:t._cornerType,ellipsoid:r,granularity:a,extrudedHeight:n,height:o,vertexFormat:$.default.POSITION_ONLY,shadowVolume:!0})},Object(s.default)(Wi.prototype,{rectangle:{get:function(){return Object(l.default)(this._rectangle)||(this._rectangle=zi(this._positions,this._ellipsoid,this._width,this._cornerType)),this._rectangle}},textureCoordinateRotationPoints:{get:function(){return[0,0,0,1,1,0]}}});var Zi=Wi,Ji=new _.default,Ki=new _.default,Qi=new _.default;function $i(t,e){var i,a,r,n=[],o=t.positions,s=t.corners,u=t.endPositions,d=new vi.a,f=0,c=0,h=0;for(a=0;a<o.length;a+=2)f+=r=o[a].length-3,h+=r/3*4,c+=o[a+1].length-3;for(f+=3,c+=3,a=0;a<s.length;a++){i=s[a];var p=s[a].leftPositions;Object(l.default)(p)?(f+=r=p.length,h+=r/3*2):(c+=r=s[a].rightPositions.length,h+=r/3*2)}var m,g=Object(l.default)(u);g&&(f+=m=u[0].length-3,c+=m,h+=4*(m/=3));var y,v,b,O,w,A,P=f+c,E=new Float64Array(P),C=0,j=P-1,D=m/2,x=_i.a.createTypedArray(P/3,h+4),T=0;if(x[T++]=C/3,x[T++]=(j-2)/3,g){n.push(C/3),A=Ji,w=Ki;var I=u[0];for(a=0;a<D;a++)A=_.default.fromArray(I,3*(D-1-a),A),w=_.default.fromArray(I,3*(D+a),w),pi.addAttribute(E,w,C),pi.addAttribute(E,A,void 0,j),O=(v=C/3)+1,b=(y=(j-2)/3)-1,x[T++]=y,x[T++]=b,x[T++]=v,x[T++]=O,C+=3,j-=3}var M=0,V=o[M++],N=o[M++];for(E.set(V,C),E.set(N,j-N.length+1),r=N.length-3,n.push(C/3,(j-2)/3),a=0;a<r;a+=3)O=(v=C/3)+1,b=(y=(j-2)/3)-1,x[T++]=y,x[T++]=b,x[T++]=v,x[T++]=O,C+=3,j-=3;for(a=0;a<s.length;a++){var S,L,F=(i=s[a]).leftPositions,U=i.rightPositions,R=Qi;if(Object(l.default)(F)){for(j-=3,L=b,n.push(O),S=0;S<F.length/3;S++)R=_.default.fromArray(F,3*S,R),x[T++]=L-S-1,x[T++]=L-S,pi.addAttribute(E,R,void 0,j),j-=3;n.push(L-Math.floor(F.length/6)),e===ee.a.BEVELED&&n.push((j-2)/3+1),C+=3}else{for(C+=3,L=O,n.push(b),S=0;S<U.length/3;S++)R=_.default.fromArray(U,3*S,R),x[T++]=L+S,x[T++]=L+S+1,pi.addAttribute(E,R,C),C+=3;n.push(L+Math.floor(U.length/6)),e===ee.a.BEVELED&&n.push(C/3-1),j-=3}for(V=o[M++],N=o[M++],V.splice(0,3),N.splice(N.length-3,3),E.set(V,C),E.set(N,j-N.length+1),r=N.length-3,S=0;S<N.length;S+=3)v=(O=C/3)-1,y=(b=(j-2)/3)+1,x[T++]=y,x[T++]=b,x[T++]=v,x[T++]=O,C+=3,j-=3;C-=3,j+=3,n.push(C/3,(j-2)/3)}if(g){C+=3,j-=3,A=Ji,w=Ki;var H=u[1];for(a=0;a<D;a++)A=_.default.fromArray(H,3*(m-a-1),A),w=_.default.fromArray(H,3*a,w),pi.addAttribute(E,A,void 0,j),pi.addAttribute(E,w,C),v=(O=C/3)-1,y=(b=(j-2)/3)+1,x[T++]=y,x[T++]=b,x[T++]=v,x[T++]=O,C+=3,j-=3;n.push(C/3)}else n.push(C/3,(j-2)/3);return x[T++]=C/3,x[T++]=(j-2)/3,d.position=new yi.a({componentDatatype:ut.a.DOUBLE,componentsPerAttribute:3,values:E}),{attributes:d,indices:x,wallIndices:n}}function ta(t){var e=(t=Object(o.default)(t,o.default.EMPTY_OBJECT)).positions,i=t.width,a=Object(o.default)(t.height,0),r=Object(o.default)(t.extrudedHeight,a);this._positions=e,this._ellipsoid=mi.default.clone(Object(o.default)(t.ellipsoid,mi.default.WGS84)),this._width=i,this._height=Math.max(a,r),this._extrudedHeight=Math.min(a,r),this._cornerType=Object(o.default)(t.cornerType,ee.a.ROUNDED),this._granularity=Object(o.default)(t.granularity,Ut.default.RADIANS_PER_DEGREE),this._offsetAttribute=t.offsetAttribute,this._workerName="createCorridorOutlineGeometry",this.packedLength=1+e.length*_.default.packedLength+mi.default.packedLength+6}ta.pack=function(t,e,i){i=Object(o.default)(i,0);var a=t._positions,r=a.length;e[i++]=r;for(var n=0;n<r;++n,i+=_.default.packedLength)_.default.pack(a[n],e,i);return mi.default.pack(t._ellipsoid,e,i),i+=mi.default.packedLength,e[i++]=t._width,e[i++]=t._height,e[i++]=t._extrudedHeight,e[i++]=t._cornerType,e[i++]=t._granularity,e[i]=Object(o.default)(t._offsetAttribute,-1),e};var ea=mi.default.clone(mi.default.UNIT_SPHERE),ia={positions:void 0,ellipsoid:ea,width:void 0,height:void 0,extrudedHeight:void 0,cornerType:void 0,granularity:void 0,offsetAttribute:void 0};ta.unpack=function(t,e,i){e=Object(o.default)(e,0);for(var a=t[e++],r=new Array(a),n=0;n<a;++n,e+=_.default.packedLength)r[n]=_.default.unpack(t,e);var s=mi.default.unpack(t,e,ea);e+=mi.default.packedLength;var u=t[e++],d=t[e++],f=t[e++],c=t[e++],h=t[e++],p=t[e];return Object(l.default)(i)?(i._positions=r,i._ellipsoid=mi.default.clone(s,i._ellipsoid),i._width=u,i._height=d,i._extrudedHeight=f,i._cornerType=c,i._granularity=h,i._offsetAttribute=-1===p?void 0:p,i):(ia.positions=r,ia.width=u,ia.height=d,ia.extrudedHeight=f,ia.cornerType=c,ia.granularity=h,ia.offsetAttribute=-1===p?void 0:p,new ta(ia))},ta.createGeometry=function(t){var e=t._positions,i=t._width,a=t._ellipsoid;e=function(t,e){for(var i=0;i<t.length;i++)t[i]=e.scaleToGeodeticSurface(t[i],t[i]);return t}(e,a);var n=Object(te.a)(e,_.default.equalsEpsilon);if(!(n.length<2||i<=0)){var o,s=t._height,u=t._extrudedHeight,d=!Ut.default.equalsEpsilon(s,u,0,Ut.default.EPSILON2),f={ellipsoid:a,positions:n,width:i,cornerType:t._cornerType,granularity:t._granularity,saveAttributes:!1};if(d)f.height=s,f.extrudedHeight=u,f.offsetAttribute=t._offsetAttribute,o=function(t){var e=t.ellipsoid,i=$i(pi.computePositions(t),t.cornerType),a=i.wallIndices,r=t.height,n=t.extrudedHeight,o=i.attributes,s=i.indices,u=o.position.values,d=u.length,f=new Float64Array(d);f.set(u);var c,h=new Float64Array(2*d);if(u=bi.a.scaleToGeodeticHeight(u,r,e),f=bi.a.scaleToGeodeticHeight(f,n,e),h.set(u),h.set(f,d),o.position.values=h,d/=3,Object(l.default)(t.offsetAttribute)){var p=new Uint8Array(2*d);if(t.offsetAttribute===ht.a.TOP)p=Object($t.a)(p,1,0,d);else{var m=t.offsetAttribute===ht.a.NONE?0:1;p=Object($t.a)(p,m)}o.applyOffset=new yi.a({componentDatatype:ut.a.UNSIGNED_BYTE,componentsPerAttribute:1,values:p})}var g=s.length,y=_i.a.createTypedArray(h.length/3,2*(g+a.length));y.set(s);var v,_,b=g;for(c=0;c<g;c+=2){var O=s[c],w=s[c+1];y[b++]=O+d,y[b++]=w+d}for(c=0;c<a.length;c++)_=(v=a[c])+d,y[b++]=v,y[b++]=_;return{attributes:o,indices:y}}(f);else if((o=$i(pi.computePositions(f),f.cornerType)).attributes.position.values=bi.a.scaleToGeodeticHeight(o.attributes.position.values,s,a),Object(l.default)(t._offsetAttribute)){var c=o.attributes.position.values.length,h=new Uint8Array(c/3),p=t._offsetAttribute===ht.a.NONE?0:1;Object($t.a)(h,p),o.attributes.applyOffset=new yi.a({componentDatatype:ut.a.UNSIGNED_BYTE,componentsPerAttribute:1,values:h})}var m=o.attributes,g=r.default.fromVertices(m.position.values,void 0,3);return new gi.a({attributes:m,indices:o.indices,primitiveType:Oi.a.LINES,boundingSphere:g,offsetAttribute:t._offsetAttribute})}};var aa=ta,ra=new Pt.a(0);function na(t){St.call(this,t),this._zIndex=0,this._terrainOffsetProperty=void 0}Object(l.default)(Object.create)&&(na.prototype=Object.create(St.prototype),na.prototype.constructor=na),Object(s.default)(na.prototype,{zIndex:{get:function(){return this._zIndex}},terrainOffsetProperty:{get:function(){return this._terrainOffsetProperty}}}),na.prototype._isOnTerrain=function(t,e){return this._fillEnabled&&!Object(l.default)(e.height)&&!Object(l.default)(e.extrudedHeight)&&c.a.isSupported(this._scene)},na.prototype._getIsClosed=function(t){var e=t.height,i=t.extrudedHeight;return 0===e||Object(l.default)(i)&&i!==e},na.prototype._computeCenter=O.default.throwInstantiationError,na.prototype._onEntityPropertyChanged=function(t,e,i,a){if(St.prototype._onEntityPropertyChanged.call(this,t,e,i,a),-1!==this._observedPropertyNames.indexOf(e)){var r=this._entity[this._geometryPropertyName];if(Object(l.default)(r)){Object(l.default)(r.zIndex)&&(Object(l.default)(r.height)||Object(l.default)(r.extrudedHeight))&&Object(At.a)(At.a.geometryZIndex),this._zIndex=Object(o.default)(r.zIndex,ra),Object(l.default)(this._terrainOffsetProperty)&&(this._terrainOffsetProperty.destroy(),this._terrainOffsetProperty=void 0);var n=r.heightReference,s=r.extrudedHeightReference;if(Object(l.default)(n)||Object(l.default)(s)){var u=new Lt.default(this._computeCenter.bind(this),!this._dynamic);this._terrainOffsetProperty=new kt(this._scene,u,n,s)}}}},na.prototype.destroy=function(){Object(l.default)(this._terrainOffsetProperty)&&(this._terrainOffsetProperty.destroy(),this._terrainOffsetProperty=void 0),St.prototype.destroy.call(this)},na.getGeometryHeight=function(t,e){if(Object(l.default)(t))return e!==P.default.CLAMP_TO_GROUND?t:0;e!==P.default.NONE&&Object(At.a)(At.a.geometryHeightReference)},na.getGeometryExtrudedHeight=function(t,e){if(Object(l.default)(t))return e!==P.default.CLAMP_TO_GROUND?t:na.CLAMP_TO_GROUND;e!==P.default.NONE&&Object(At.a)(At.a.geometryExtrudedHeightReference)},na.CLAMP_TO_GROUND="clamp",na.computeGeometryOffsetAttribute=function(t,e,i,a){Object(l.default)(t)&&Object(l.default)(e)||(e=P.default.NONE),Object(l.default)(i)&&Object(l.default)(a)||(a=P.default.NONE);var r=0;return e!==P.default.NONE&&r++,a===P.default.RELATIVE_TO_GROUND&&r++,2===r?ht.a.ALL:1===r?ht.a.TOP:void 0};var oa=na,la=new b.default,sa=_.default.ZERO,ua=new _.default,da=new wi.default;function fa(t){this.id=t,this.vertexFormat=void 0,this.positions=void 0,this.width=void 0,this.cornerType=void 0,this.height=void 0,this.extrudedHeight=void 0,this.granularity=void 0,this.offsetAttribute=void 0}function ca(t,e){oa.call(this,{entity:t,scene:e,geometryOptions:new fa(t),geometryPropertyName:"corridor",observedPropertyNames:["availability","corridor"]}),this._onEntityPropertyChanged(t,"corridor",t.corridor,void 0)}function ha(t,e,i){wt.call(this,t,e,i)}Object(l.default)(Object.create)&&(ca.prototype=Object.create(oa.prototype),ca.prototype.constructor=ca),ca.prototype.createFillGeometryInstance=function(t){var e,i=this._entity,a=i.isAvailable(t),r={show:new gt.a(a&&i.isShowing&&this._showProperty.getValue(t)&&this._fillProperty.getValue(t)),distanceDisplayCondition:ft.fromDistanceDisplayCondition(this._distanceDisplayConditionProperty.getValue(t)),offset:void 0,color:void 0};this._materialProperty instanceof yt.default&&(Object(l.default)(this._materialProperty.color)&&(this._materialProperty.color.isConstant||a)&&(e=this._materialProperty.color.getValue(t,la)),Object(l.default)(e)||(e=b.default.WHITE),r.color=st.a.fromColor(e));return Object(l.default)(this._options.offsetAttribute)&&(r.offset=mt.a.fromCartesian3(D.default.getValueOrDefault(this._terrainOffsetProperty,t,sa,ua))),new ct.a({id:i,geometry:new Zi(this._options),attributes:r})},ca.prototype.createOutlineGeometryInstance=function(t){var e=this._entity,i=e.isAvailable(t),a=D.default.getValueOrDefault(this._outlineColorProperty,t,b.default.BLACK,la),r={show:new gt.a(i&&e.isShowing&&this._showProperty.getValue(t)&&this._showOutlineProperty.getValue(t)),color:st.a.fromColor(a),distanceDisplayCondition:ft.fromDistanceDisplayCondition(this._distanceDisplayConditionProperty.getValue(t)),offset:void 0};return Object(l.default)(this._options.offsetAttribute)&&(r.offset=mt.a.fromCartesian3(D.default.getValueOrDefault(this._terrainOffsetProperty,t,sa,ua))),new ct.a({id:e,geometry:new aa(this._options),attributes:r})},ca.prototype._computeCenter=function(t,e){var i=D.default.getValueOrUndefined(this._entity.corridor.positions,t);if(Object(l.default)(i)&&0!==i.length)return _.default.clone(i[Math.floor(i.length/2)],e)},ca.prototype._isHidden=function(t,e){return!Object(l.default)(e.positions)||!Object(l.default)(e.width)||St.prototype._isHidden.call(this,t,e)},ca.prototype._isDynamic=function(t,e){return!e.positions.isConstant||!D.default.isConstant(e.height)||!D.default.isConstant(e.extrudedHeight)||!D.default.isConstant(e.granularity)||!D.default.isConstant(e.width)||!D.default.isConstant(e.outlineWidth)||!D.default.isConstant(e.cornerType)||!D.default.isConstant(e.zIndex)||this._onTerrain&&!D.default.isConstant(this._materialProperty)},ca.prototype._setStaticOptions=function(t,e){var i=D.default.getValueOrUndefined(e.height,pt.default.MINIMUM_VALUE),r=D.default.getValueOrDefault(e.heightReference,pt.default.MINIMUM_VALUE,P.default.NONE),n=D.default.getValueOrUndefined(e.extrudedHeight,pt.default.MINIMUM_VALUE),o=D.default.getValueOrDefault(e.extrudedHeightReference,pt.default.MINIMUM_VALUE,P.default.NONE);Object(l.default)(n)&&!Object(l.default)(i)&&(i=0);var s=this._options;s.vertexFormat=this._materialProperty instanceof yt.default?rt.a.VERTEX_FORMAT:at.MaterialSupport.TEXTURED.vertexFormat,s.positions=e.positions.getValue(pt.default.MINIMUM_VALUE,s.positions),s.width=e.width.getValue(pt.default.MINIMUM_VALUE),s.granularity=D.default.getValueOrUndefined(e.granularity,pt.default.MINIMUM_VALUE),s.cornerType=D.default.getValueOrUndefined(e.cornerType,pt.default.MINIMUM_VALUE),s.offsetAttribute=oa.computeGeometryOffsetAttribute(i,r,n,o),s.height=oa.getGeometryHeight(i,r),(n=oa.getGeometryExtrudedHeight(n,o))===oa.CLAMP_TO_GROUND&&(n=a.a.getMinimumMaximumHeights(Zi.computeRectangle(s,da)).minimumTerrainHeight),s.extrudedHeight=n},ca.DynamicGeometryUpdater=ha,Object(l.default)(Object.create)&&(ha.prototype=Object.create(wt.prototype),ha.prototype.constructor=ha),ha.prototype._isHidden=function(t,e,i){var a=this._options;return!Object(l.default)(a.positions)||!Object(l.default)(a.width)||wt.prototype._isHidden.call(this,t,e,i)},ha.prototype._setOptions=function(t,e,i){var r=this._options,n=D.default.getValueOrUndefined(e.height,i),o=D.default.getValueOrDefault(e.heightReference,i,P.default.NONE),s=D.default.getValueOrUndefined(e.extrudedHeight,i),u=D.default.getValueOrDefault(e.extrudedHeightReference,i,P.default.NONE);Object(l.default)(s)&&!Object(l.default)(n)&&(n=0),r.positions=D.default.getValueOrUndefined(e.positions,i),r.width=D.default.getValueOrUndefined(e.width,i),r.granularity=D.default.getValueOrUndefined(e.granularity,i),r.cornerType=D.default.getValueOrUndefined(e.cornerType,i),r.offsetAttribute=oa.computeGeometryOffsetAttribute(n,o,s,u),r.height=oa.getGeometryHeight(n,o),(s=oa.getGeometryExtrudedHeight(s,u))===oa.CLAMP_TO_GROUND&&(s=a.a.getMinimumMaximumHeights(Zi.computeRectangle(r,da)).minimumTerrainHeight),r.extrudedHeight=s};var pa=ca,ma={computePositions:function(t,e,i,a,r){var n,o=.5*t,l=-o,s=a+a,u=new Float64Array(3*(r?2*s:s)),d=0,f=0,c=r?3*s:0,h=r?3*(s+a):3*a;for(n=0;n<a;n++){var p=n/a*Ut.default.TWO_PI,m=Math.cos(p),g=Math.sin(p),y=m*i,v=g*i,_=m*e,b=g*e;u[f+c]=y,u[f+c+1]=v,u[f+c+2]=l,u[f+h]=_,u[f+h+1]=b,u[f+h+2]=o,f+=3,r&&(u[d++]=y,u[d++]=v,u[d++]=l,u[d++]=_,u[d++]=b,u[d++]=o)}return u}},ga=ma,ya=new v.default,va=new _.default,_a=new _.default,ba=new _.default,Oa=new _.default;function wa(t){var e=(t=Object(o.default)(t,o.default.EMPTY_OBJECT)).length,i=t.topRadius,a=t.bottomRadius,r=Object(o.default)(t.vertexFormat,$.default.DEFAULT),n=Object(o.default)(t.slices,128);this._length=e,this._topRadius=i,this._bottomRadius=a,this._vertexFormat=$.default.clone(r),this._slices=n,this._offsetAttribute=t.offsetAttribute,this._workerName="createCylinderGeometry"}wa.packedLength=$.default.packedLength+5,wa.pack=function(t,e,i){return i=Object(o.default)(i,0),$.default.pack(t._vertexFormat,e,i),i+=$.default.packedLength,e[i++]=t._length,e[i++]=t._topRadius,e[i++]=t._bottomRadius,e[i++]=t._slices,e[i]=Object(o.default)(t._offsetAttribute,-1),e};var Aa,Pa=new $.default,Ea={vertexFormat:Pa,length:void 0,topRadius:void 0,bottomRadius:void 0,slices:void 0,offsetAttribute:void 0};wa.unpack=function(t,e,i){e=Object(o.default)(e,0);var a=$.default.unpack(t,e,Pa);e+=$.default.packedLength;var r=t[e++],n=t[e++],s=t[e++],u=t[e++],d=t[e];return Object(l.default)(i)?(i._vertexFormat=$.default.clone(a,i._vertexFormat),i._length=r,i._topRadius=n,i._bottomRadius=s,i._slices=u,i._offsetAttribute=-1===d?void 0:d,i):(Ea.length=r,Ea.topRadius=n,Ea.bottomRadius=s,Ea.slices=u,Ea.offsetAttribute=-1===d?void 0:d,new wa(Ea))},wa.createGeometry=function(t){var e=t._length,i=t._topRadius,a=t._bottomRadius,n=t._vertexFormat,o=t._slices;if(!(e<=0||i<0||a<0||0===i&&0===a)){var s,u=o+o,d=o+u,f=u+u,c=ga.computePositions(e,i,a,o,!0),h=n.st?new Float32Array(2*f):void 0,p=n.normal?new Float32Array(3*f):void 0,m=n.tangent?new Float32Array(3*f):void 0,g=n.bitangent?new Float32Array(3*f):void 0,y=n.normal||n.tangent||n.bitangent;if(y){var b=n.tangent||n.bitangent,O=0,w=0,A=0,P=Math.atan2(a-i,e),E=va;E.z=Math.sin(P);var C=Math.cos(P),j=ba,D=_a;for(s=0;s<o;s++){var x=s/o*Ut.default.TWO_PI,T=C*Math.cos(x),I=C*Math.sin(x);y&&(E.x=T,E.y=I,b&&(j=_.default.normalize(_.default.cross(_.default.UNIT_Z,E,j),j)),n.normal&&(p[O++]=E.x,p[O++]=E.y,p[O++]=E.z,p[O++]=E.x,p[O++]=E.y,p[O++]=E.z),n.tangent&&(m[w++]=j.x,m[w++]=j.y,m[w++]=j.z,m[w++]=j.x,m[w++]=j.y,m[w++]=j.z),n.bitangent&&(D=_.default.normalize(_.default.cross(E,j,D),D),g[A++]=D.x,g[A++]=D.y,g[A++]=D.z,g[A++]=D.x,g[A++]=D.y,g[A++]=D.z))}for(s=0;s<o;s++)n.normal&&(p[O++]=0,p[O++]=0,p[O++]=-1),n.tangent&&(m[w++]=1,m[w++]=0,m[w++]=0),n.bitangent&&(g[A++]=0,g[A++]=-1,g[A++]=0);for(s=0;s<o;s++)n.normal&&(p[O++]=0,p[O++]=0,p[O++]=1),n.tangent&&(m[w++]=1,m[w++]=0,m[w++]=0),n.bitangent&&(g[A++]=0,g[A++]=1,g[A++]=0)}var M=12*o-12,V=_i.a.createTypedArray(f,M),N=0,S=0;for(s=0;s<o-1;s++)V[N++]=S,V[N++]=S+2,V[N++]=S+3,V[N++]=S,V[N++]=S+3,V[N++]=S+1,S+=2;for(V[N++]=u-2,V[N++]=0,V[N++]=1,V[N++]=u-2,V[N++]=1,V[N++]=u-1,s=1;s<o-1;s++)V[N++]=u+s+1,V[N++]=u+s,V[N++]=u;for(s=1;s<o-1;s++)V[N++]=d,V[N++]=d+s,V[N++]=d+s+1;var L=0;if(n.st){var F=Math.max(i,a);for(s=0;s<f;s++){var U=_.default.fromArray(c,3*s,Oa);h[L++]=(U.x+F)/(2*F),h[L++]=(U.y+F)/(2*F)}}var R=new vi.a;n.position&&(R.position=new yi.a({componentDatatype:ut.a.DOUBLE,componentsPerAttribute:3,values:c})),n.normal&&(R.normal=new yi.a({componentDatatype:ut.a.FLOAT,componentsPerAttribute:3,values:p})),n.tangent&&(R.tangent=new yi.a({componentDatatype:ut.a.FLOAT,componentsPerAttribute:3,values:m})),n.bitangent&&(R.bitangent=new yi.a({componentDatatype:ut.a.FLOAT,componentsPerAttribute:3,values:g})),n.st&&(R.st=new yi.a({componentDatatype:ut.a.FLOAT,componentsPerAttribute:2,values:h})),ya.x=.5*e,ya.y=Math.max(a,i);var H=new r.default(_.default.ZERO,v.default.magnitude(ya));if(Object(l.default)(t._offsetAttribute)){e=c.length;var B=new Uint8Array(e/3),G=t._offsetAttribute===ht.a.NONE?0:1;Object($t.a)(B,G),R.applyOffset=new yi.a({componentDatatype:ut.a.UNSIGNED_BYTE,componentsPerAttribute:1,values:B})}return new gi.a({attributes:R,indices:V,primitiveType:Oi.a.TRIANGLES,boundingSphere:H,offsetAttribute:t._offsetAttribute})}},wa.getUnitCylinder=function(){return Object(l.default)(Aa)||(Aa=wa.createGeometry(new wa({topRadius:1,bottomRadius:1,length:1,vertexFormat:$.default.POSITION_ONLY}))),Aa};var Ca=wa,ja=new v.default;function Da(t){var e=(t=Object(o.default)(t,o.default.EMPTY_OBJECT)).length,i=t.topRadius,a=t.bottomRadius,r=Object(o.default)(t.slices,128),n=Math.max(Object(o.default)(t.numberOfVerticalLines,16),0);this._length=e,this._topRadius=i,this._bottomRadius=a,this._slices=r,this._numberOfVerticalLines=n,this._offsetAttribute=t.offsetAttribute,this._workerName="createCylinderOutlineGeometry"}Da.packedLength=6,Da.pack=function(t,e,i){return i=Object(o.default)(i,0),e[i++]=t._length,e[i++]=t._topRadius,e[i++]=t._bottomRadius,e[i++]=t._slices,e[i++]=t._numberOfVerticalLines,e[i]=Object(o.default)(t._offsetAttribute,-1),e};var xa={length:void 0,topRadius:void 0,bottomRadius:void 0,slices:void 0,numberOfVerticalLines:void 0,offsetAttribute:void 0};Da.unpack=function(t,e,i){e=Object(o.default)(e,0);var a=t[e++],r=t[e++],n=t[e++],s=t[e++],u=t[e++],d=t[e];return Object(l.default)(i)?(i._length=a,i._topRadius=r,i._bottomRadius=n,i._slices=s,i._numberOfVerticalLines=u,i._offsetAttribute=-1===d?void 0:d,i):(xa.length=a,xa.topRadius=r,xa.bottomRadius=n,xa.slices=s,xa.numberOfVerticalLines=u,xa.offsetAttribute=-1===d?void 0:d,new Da(xa))},Da.createGeometry=function(t){var e=t._length,i=t._topRadius,a=t._bottomRadius,n=t._slices,o=t._numberOfVerticalLines;if(!(e<=0||i<0||a<0||0===i&&0===a)){var s,u=2*n,d=ga.computePositions(e,i,a,n,!1),f=2*n;if(o>0){var c=Math.min(o,n);s=Math.round(n/c),f+=c}var h,p=_i.a.createTypedArray(u,2*f),m=0;for(h=0;h<n-1;h++)p[m++]=h,p[m++]=h+1,p[m++]=h+n,p[m++]=h+1+n;if(p[m++]=n-1,p[m++]=0,p[m++]=n+n-1,p[m++]=n,o>0)for(h=0;h<n;h+=s)p[m++]=h,p[m++]=h+n;var g=new vi.a;g.position=new yi.a({componentDatatype:ut.a.DOUBLE,componentsPerAttribute:3,values:d}),ja.x=.5*e,ja.y=Math.max(a,i);var y=new r.default(_.default.ZERO,v.default.magnitude(ja));if(Object(l.default)(t._offsetAttribute)){e=d.length;var b=new Uint8Array(e/3),O=t._offsetAttribute===ht.a.NONE?0:1;Object($t.a)(b,O),g.applyOffset=new yi.a({componentDatatype:ut.a.UNSIGNED_BYTE,componentsPerAttribute:1,values:b})}return new gi.a({attributes:g,indices:p,primitiveType:Oi.a.LINES,boundingSphere:y,offsetAttribute:t._offsetAttribute})}};var Ta=Da,Ia=_.default.ZERO,Ma=new _.default,Va=new _.default,Na=new b.default;function Sa(t){this.id=t,this.vertexFormat=void 0,this.length=void 0,this.topRadius=void 0,this.bottomRadius=void 0,this.slices=void 0,this.numberOfVerticalLines=void 0,this.offsetAttribute=void 0}function La(t,e){St.call(this,{entity:t,scene:e,geometryOptions:new Sa(t),geometryPropertyName:"cylinder",observedPropertyNames:["availability","position","orientation","cylinder"]}),this._onEntityPropertyChanged(t,"cylinder",t.cylinder,void 0)}function Fa(t,e,i){wt.call(this,t,e,i)}Object(l.default)(Object.create)&&(La.prototype=Object.create(St.prototype),La.prototype.constructor=La),Object(s.default)(La.prototype,{terrainOffsetProperty:{get:function(){return this._terrainOffsetProperty}}}),La.prototype.createFillGeometryInstance=function(t){var e,i=this._entity,a=i.isAvailable(t),r=new gt.a(a&&i.isShowing&&this._showProperty.getValue(t)&&this._fillProperty.getValue(t)),n=this._distanceDisplayConditionProperty.getValue(t),o={show:r,distanceDisplayCondition:ft.fromDistanceDisplayCondition(n),color:void 0,offset:void 0};this._materialProperty instanceof yt.default&&(Object(l.default)(this._materialProperty.color)&&(this._materialProperty.color.isConstant||a)&&(e=this._materialProperty.color.getValue(t,Na)),Object(l.default)(e)||(e=b.default.WHITE),o.color=st.a.fromColor(e));return Object(l.default)(this._options.offsetAttribute)&&(o.offset=mt.a.fromCartesian3(D.default.getValueOrDefault(this._terrainOffsetProperty,t,Ia,Ma))),new ct.a({id:i,geometry:new Ca(this._options),modelMatrix:i.computeModelMatrixForHeightReference(t,i.cylinder.heightReference,.5*this._options.length,this._scene.mapProjection.ellipsoid),attributes:o})},La.prototype.createOutlineGeometryInstance=function(t){var e=this._entity,i=e.isAvailable(t),a=D.default.getValueOrDefault(this._outlineColorProperty,t,b.default.BLACK,Na),r=this._distanceDisplayConditionProperty.getValue(t),n={show:new gt.a(i&&e.isShowing&&this._showProperty.getValue(t)&&this._showOutlineProperty.getValue(t)),color:st.a.fromColor(a),distanceDisplayCondition:ft.fromDistanceDisplayCondition(r),offset:void 0};return Object(l.default)(this._options.offsetAttribute)&&(n.offset=mt.a.fromCartesian3(D.default.getValueOrDefault(this._terrainOffsetProperty,t,Ia,Ma))),new ct.a({id:e,geometry:new Ta(this._options),modelMatrix:e.computeModelMatrixForHeightReference(t,e.cylinder.heightReference,.5*this._options.length,this._scene.mapProjection.ellipsoid),attributes:n})},La.prototype._computeCenter=function(t,e){return D.default.getValueOrUndefined(this._entity.position,t,e)},La.prototype._isHidden=function(t,e){return!Object(l.default)(t.position)||!Object(l.default)(e.length)||!Object(l.default)(e.topRadius)||!Object(l.default)(e.bottomRadius)||St.prototype._isHidden.call(this,t,e)},La.prototype._isDynamic=function(t,e){return!(t.position.isConstant&&D.default.isConstant(t.orientation)&&e.length.isConstant&&e.topRadius.isConstant&&e.bottomRadius.isConstant&&D.default.isConstant(e.slices)&&D.default.isConstant(e.outlineWidth)&&D.default.isConstant(e.numberOfVerticalLines))},La.prototype._setStaticOptions=function(t,e){var i=D.default.getValueOrDefault(e.heightReference,pt.default.MINIMUM_VALUE,P.default.NONE),a=this._options;a.vertexFormat=this._materialProperty instanceof yt.default?rt.a.VERTEX_FORMAT:at.MaterialSupport.TEXTURED.vertexFormat,a.length=e.length.getValue(pt.default.MINIMUM_VALUE),a.topRadius=e.topRadius.getValue(pt.default.MINIMUM_VALUE),a.bottomRadius=e.bottomRadius.getValue(pt.default.MINIMUM_VALUE),a.slices=D.default.getValueOrUndefined(e.slices,pt.default.MINIMUM_VALUE),a.numberOfVerticalLines=D.default.getValueOrUndefined(e.numberOfVerticalLines,pt.default.MINIMUM_VALUE),a.offsetAttribute=i!==P.default.NONE?ht.a.ALL:void 0},La.prototype._onEntityPropertyChanged=zt,La.DynamicGeometryUpdater=Fa,Object(l.default)(Object.create)&&(Fa.prototype=Object.create(wt.prototype),Fa.prototype.constructor=Fa),Fa.prototype._isHidden=function(t,e,i){var a=this._options,r=D.default.getValueOrUndefined(t.position,i,Va);return!Object(l.default)(r)||!Object(l.default)(a.length)||!Object(l.default)(a.topRadius)||!Object(l.default)(a.bottomRadius)||wt.prototype._isHidden.call(this,t,e,i)},Fa.prototype._setOptions=function(t,e,i){var a=D.default.getValueOrDefault(e.heightReference,i,P.default.NONE),r=this._options;r.length=D.default.getValueOrUndefined(e.length,i),r.topRadius=D.default.getValueOrUndefined(e.topRadius,i),r.bottomRadius=D.default.getValueOrUndefined(e.bottomRadius,i),r.slices=D.default.getValueOrUndefined(e.slices,i),r.numberOfVerticalLines=D.default.getValueOrUndefined(e.numberOfVerticalLines,i),r.offsetAttribute=a!==P.default.NONE?ht.a.ALL:void 0};var Ua=La;function Ra(t,e){this._primitives=t,this._orderedGroundPrimitives=e,this._dynamicUpdaters=new g.default}Ra.prototype.add=function(t,e){this._dynamicUpdaters.set(e.id,e.createDynamicUpdater(this._primitives,this._orderedGroundPrimitives))},Ra.prototype.remove=function(t){var e=t.id,i=this._dynamicUpdaters.get(e);Object(l.default)(i)&&(this._dynamicUpdaters.remove(e),i.destroy())},Ra.prototype.update=function(t){for(var e=this._dynamicUpdaters.values,i=0,a=e.length;i<a;i++)e[i].update(t);return!0},Ra.prototype.removeAllPrimitives=function(){for(var t=this._dynamicUpdaters.values,e=0,i=t.length;e<i;e++)t[e].destroy();this._dynamicUpdaters.removeAll()},Ra.prototype.getBoundingSphere=function(t,e){return t=this._dynamicUpdaters.get(t.id),Object(l.default)(t)&&Object(l.default)(t.getBoundingSphere)?t.getBoundingSphere(e):j.default.FAILED};var Ha=Ra,Ba={},Ga=new _.default,ka=new _.default,za=new le.default,Wa=new ie.default;function Ya(t,e,i,a,r,n,o,l,s,u){var d=t+e;_.default.multiplyByScalar(a,Math.cos(d),Ga),_.default.multiplyByScalar(i,Math.sin(d),ka),_.default.add(Ga,ka,Ga);var f=Math.cos(t);f*=f;var c=Math.sin(t);c*=c;var h=n/Math.sqrt(o*f+r*c)/l;return le.default.fromAxisAngle(Ga,h,za),ie.default.fromQuaternion(za,Wa),ie.default.multiplyByVector(Wa,s,u),_.default.normalize(u,u),_.default.multiplyByScalar(u,l,u),u}var qa=new _.default,Xa=new _.default,Za=new _.default,Ja=new _.default;Ba.raisePositionsToHeight=function(t,e,i){for(var a=e.ellipsoid,r=e.height,n=e.extrudedHeight,o=i?t.length/3*2:t.length/3,l=new Float64Array(3*o),s=t.length,u=i?s:0,d=0;d<s;d+=3){var f=d+1,c=d+2,h=_.default.fromArray(t,d,qa);a.scaleToGeodeticSurface(h,h);var p=_.default.clone(h,Xa),m=a.geodeticSurfaceNormal(h,Ja),g=_.default.multiplyByScalar(m,r,Za);_.default.add(h,g,h),i&&(_.default.multiplyByScalar(m,n,g),_.default.add(p,g,p),l[d+u]=p.x,l[f+u]=p.y,l[c+u]=p.z),l[d]=h.x,l[f]=h.y,l[c]=h.z}return l};var Ka=new _.default,Qa=new _.default,$a=new _.default;Ba.computeEllipsePositions=function(t,e,i){var a=t.semiMinorAxis,r=t.semiMajorAxis,n=t.rotation,o=t.center,l=8*t.granularity,s=a*a,u=r*r,d=r*a,f=_.default.magnitude(o),c=_.default.normalize(o,Ka),h=_.default.cross(_.default.UNIT_Z,o,Qa);h=_.default.normalize(h,h);var p=_.default.cross(c,h,$a),m=1+Math.ceil(Ut.default.PI_OVER_TWO/l),g=Ut.default.PI_OVER_TWO/(m-1),y=Ut.default.PI_OVER_TWO-m*g;y<0&&(m-=Math.ceil(Math.abs(y)/g));var v,b,O,w,A,P=e?new Array(3*(m*(m+2)*2)):void 0,E=0,C=qa,j=Xa,D=4*m*3,x=D-1,T=0,I=i?new Array(D):void 0;for(C=Ya(y=Ut.default.PI_OVER_TWO,n,p,h,s,d,u,f,c,C),e&&(P[E++]=C.x,P[E++]=C.y,P[E++]=C.z),i&&(I[x--]=C.z,I[x--]=C.y,I[x--]=C.x),y=Ut.default.PI_OVER_TWO-g,v=1;v<m+1;++v){if(C=Ya(y,n,p,h,s,d,u,f,c,C),j=Ya(Math.PI-y,n,p,h,s,d,u,f,c,j),e){for(P[E++]=C.x,P[E++]=C.y,P[E++]=C.z,O=2*v+2,b=1;b<O-1;++b)w=b/(O-1),A=_.default.lerp(C,j,w,Za),P[E++]=A.x,P[E++]=A.y,P[E++]=A.z;P[E++]=j.x,P[E++]=j.y,P[E++]=j.z}i&&(I[x--]=C.z,I[x--]=C.y,I[x--]=C.x,I[T++]=j.x,I[T++]=j.y,I[T++]=j.z),y=Ut.default.PI_OVER_TWO-(v+1)*g}for(v=m;v>1;--v){if(C=Ya(-(y=Ut.default.PI_OVER_TWO-(v-1)*g),n,p,h,s,d,u,f,c,C),j=Ya(y+Math.PI,n,p,h,s,d,u,f,c,j),e){for(P[E++]=C.x,P[E++]=C.y,P[E++]=C.z,O=2*(v-1)+2,b=1;b<O-1;++b)w=b/(O-1),A=_.default.lerp(C,j,w,Za),P[E++]=A.x,P[E++]=A.y,P[E++]=A.z;P[E++]=j.x,P[E++]=j.y,P[E++]=j.z}i&&(I[x--]=C.z,I[x--]=C.y,I[x--]=C.x,I[T++]=j.x,I[T++]=j.y,I[T++]=j.z)}C=Ya(-(y=Ut.default.PI_OVER_TWO),n,p,h,s,d,u,f,c,C);var M={};return e&&(P[E++]=C.x,P[E++]=C.y,P[E++]=C.z,M.positions=P,M.numPts=m),i&&(I[x--]=C.z,I[x--]=C.y,I[x--]=C.x,M.outerPositions=I),M};var tr=Ba,er=i(104),ir=i(114),ar=new _.default,rr=new _.default,nr=new _.default,or=new _.default,lr=new v.default,sr=new ie.default,ur=new ie.default,dr=new le.default,fr=new _.default,cr=new _.default,hr=new _.default,pr=new Ft.default,mr=new _.default,gr=new v.default,yr=new v.default;function vr(t,e,i){var a=e.vertexFormat,r=e.center,n=e.semiMajorAxis,o=e.semiMinorAxis,s=e.ellipsoid,u=e.stRotation,d=i?t.length/3*2:t.length/3,f=e.shadowVolume,c=a.st?new Float32Array(2*d):void 0,h=a.normal?new Float32Array(3*d):void 0,p=a.tangent?new Float32Array(3*d):void 0,m=a.bitangent?new Float32Array(3*d):void 0,g=f?new Float32Array(3*d):void 0,y=0,b=fr,O=cr,w=hr,A=new er.a(s),P=A.project(s.cartesianToCartographic(r,pr),mr),E=s.scaleToGeodeticSurface(r,ar);s.geodeticSurfaceNormal(E,E);var C=sr,j=ur;if(0!==u){var D=le.default.fromAxisAngle(E,u,dr);C=ie.default.fromQuaternion(D,C),D=le.default.fromAxisAngle(E,-u,dr),j=ie.default.fromQuaternion(D,j)}else C=ie.default.clone(ie.default.IDENTITY,C),j=ie.default.clone(ie.default.IDENTITY,j);for(var x=v.default.fromElements(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,gr),T=v.default.fromElements(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,yr),I=t.length,M=i?I:0,V=M/3*2,N=0;N<I;N+=3){var S=N+1,L=N+2,F=_.default.fromArray(t,N,ar);if(a.st){var U=ie.default.multiplyByVector(C,F,rr),R=A.project(s.cartesianToCartographic(U,pr),nr);_.default.subtract(R,P,R),lr.x=(R.x+n)/(2*n),lr.y=(R.y+o)/(2*o),x.x=Math.min(lr.x,x.x),x.y=Math.min(lr.y,x.y),T.x=Math.max(lr.x,T.x),T.y=Math.max(lr.y,T.y),i&&(c[y+V]=lr.x,c[y+1+V]=lr.y),c[y++]=lr.x,c[y++]=lr.y}(a.normal||a.tangent||a.bitangent||f)&&(b=s.geodeticSurfaceNormal(F,b),f&&(g[N+M]=-b.x,g[S+M]=-b.y,g[L+M]=-b.z),(a.normal||a.tangent||a.bitangent)&&((a.tangent||a.bitangent)&&(O=_.default.normalize(_.default.cross(_.default.UNIT_Z,b,O),O),ie.default.multiplyByVector(j,O,O)),a.normal&&(h[N]=b.x,h[S]=b.y,h[L]=b.z,i&&(h[N+M]=-b.x,h[S+M]=-b.y,h[L+M]=-b.z)),a.tangent&&(p[N]=O.x,p[S]=O.y,p[L]=O.z,i&&(p[N+M]=-O.x,p[S+M]=-O.y,p[L+M]=-O.z)),a.bitangent&&(w=_.default.normalize(_.default.cross(b,O,w),w),m[N]=w.x,m[S]=w.y,m[L]=w.z,i&&(m[N+M]=w.x,m[S+M]=w.y,m[L+M]=w.z))))}if(a.st){I=c.length;for(var H=0;H<I;H+=2)c[H]=(c[H]-x.x)/(T.x-x.x),c[H+1]=(c[H+1]-x.y)/(T.y-x.y)}var B=new vi.a;if(a.position){var G=tr.raisePositionsToHeight(t,e,i);B.position=new yi.a({componentDatatype:ut.a.DOUBLE,componentsPerAttribute:3,values:G})}if(a.st&&(B.st=new yi.a({componentDatatype:ut.a.FLOAT,componentsPerAttribute:2,values:c})),a.normal&&(B.normal=new yi.a({componentDatatype:ut.a.FLOAT,componentsPerAttribute:3,values:h})),a.tangent&&(B.tangent=new yi.a({componentDatatype:ut.a.FLOAT,componentsPerAttribute:3,values:p})),a.bitangent&&(B.bitangent=new yi.a({componentDatatype:ut.a.FLOAT,componentsPerAttribute:3,values:m})),f&&(B.extrudeDirection=new yi.a({componentDatatype:ut.a.FLOAT,componentsPerAttribute:3,values:g})),i&&Object(l.default)(e.offsetAttribute)){var k=new Uint8Array(d);if(e.offsetAttribute===ht.a.TOP)k=Object($t.a)(k,1,0,d/2);else{var z=e.offsetAttribute===ht.a.NONE?0:1;k=Object($t.a)(k,z)}B.applyOffset=new yi.a({componentDatatype:ut.a.UNSIGNED_BYTE,componentsPerAttribute:1,values:k})}return B}function _r(t){var e,i,a,r,n,o=new Array(t*(t+1)*12-6),l=0;for(e=0,a=1,r=0;r<3;r++)o[l++]=a++,o[l++]=e,o[l++]=a;for(r=2;r<t+1;++r){for(a=r*(r+1)-1,e=(r-1)*r-1,o[l++]=a++,o[l++]=e,o[l++]=a,i=2*r,n=0;n<i-1;++n)o[l++]=a,o[l++]=e++,o[l++]=e,o[l++]=a++,o[l++]=e,o[l++]=a;o[l++]=a++,o[l++]=e,o[l++]=a}for(i=2*t,++a,++e,r=0;r<i-1;++r)o[l++]=a,o[l++]=e++,o[l++]=e,o[l++]=a++,o[l++]=e,o[l++]=a;for(o[l++]=a,o[l++]=e++,o[l++]=e,o[l++]=a++,o[l++]=e++,o[l++]=e,++e,r=t-1;r>1;--r){for(o[l++]=e++,o[l++]=e,o[l++]=a,i=2*r,n=0;n<i-1;++n)o[l++]=a,o[l++]=e++,o[l++]=e,o[l++]=a++,o[l++]=e,o[l++]=a;o[l++]=e++,o[l++]=e++,o[l++]=a++}for(r=0;r<3;r++)o[l++]=e++,o[l++]=e,o[l++]=a;return o}var br=new _.default;var Or=new r.default,wr=new r.default;function Ar(t){var e=t.center,i=t.ellipsoid,a=t.semiMajorAxis,n=_.default.multiplyByScalar(i.geodeticSurfaceNormal(e,ar),t.height,ar);Or.center=_.default.add(e,n,Or.center),Or.radius=a,n=_.default.multiplyByScalar(i.geodeticSurfaceNormal(e,n),t.extrudedHeight,n),wr.center=_.default.add(e,n,wr.center),wr.radius=a;var o=tr.computeEllipsePositions(t,!0,!0),s=o.positions,u=o.numPts,d=o.outerPositions,f=r.default.union(Or,wr),c=vr(s,t,!0),h=_r(u),p=h.length;h.length=2*p;for(var m=s.length/3,g=0;g<p;g+=3)h[g+p]=h[g+2]+m,h[g+1+p]=h[g+1]+m,h[g+2+p]=h[g]+m;var y=_i.a.createTypedArray(2*m/3,h),b=new gi.a({attributes:c,indices:y,primitiveType:Oi.a.TRIANGLES}),O=function(t,e){var i=e.vertexFormat,a=e.center,r=e.semiMajorAxis,n=e.semiMinorAxis,o=e.ellipsoid,s=e.height,u=e.extrudedHeight,d=e.stRotation,f=t.length/3*2,c=new Float64Array(3*f),h=i.st?new Float32Array(2*f):void 0,p=i.normal?new Float32Array(3*f):void 0,m=i.tangent?new Float32Array(3*f):void 0,g=i.bitangent?new Float32Array(3*f):void 0,y=e.shadowVolume,b=y?new Float32Array(3*f):void 0,O=0,w=fr,A=cr,P=hr,E=new er.a(o),C=E.project(o.cartesianToCartographic(a,pr),mr),j=o.scaleToGeodeticSurface(a,ar);o.geodeticSurfaceNormal(j,j);for(var D=le.default.fromAxisAngle(j,d,dr),x=ie.default.fromQuaternion(D,sr),T=v.default.fromElements(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,gr),I=v.default.fromElements(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,yr),M=t.length,V=M/3*2,N=0;N<M;N+=3){var S,L=N+1,F=N+2,U=_.default.fromArray(t,N,ar);if(i.st){var R=ie.default.multiplyByVector(x,U,rr),H=E.project(o.cartesianToCartographic(R,pr),nr);_.default.subtract(H,C,H),lr.x=(H.x+r)/(2*r),lr.y=(H.y+n)/(2*n),T.x=Math.min(lr.x,T.x),T.y=Math.min(lr.y,T.y),I.x=Math.max(lr.x,I.x),I.y=Math.max(lr.y,I.y),h[O+V]=lr.x,h[O+1+V]=lr.y,h[O++]=lr.x,h[O++]=lr.y}U=o.scaleToGeodeticSurface(U,U),S=_.default.clone(U,rr),w=o.geodeticSurfaceNormal(U,w),y&&(b[N+M]=-w.x,b[L+M]=-w.y,b[F+M]=-w.z);var B=_.default.multiplyByScalar(w,s,or);if(U=_.default.add(U,B,U),B=_.default.multiplyByScalar(w,u,B),S=_.default.add(S,B,S),i.position&&(c[N+M]=S.x,c[L+M]=S.y,c[F+M]=S.z,c[N]=U.x,c[L]=U.y,c[F]=U.z),i.normal||i.tangent||i.bitangent){P=_.default.clone(w,P);var G=_.default.fromArray(t,(N+3)%M,or);_.default.subtract(G,U,G);var k=_.default.subtract(S,U,nr);w=_.default.normalize(_.default.cross(k,G,w),w),i.normal&&(p[N]=w.x,p[L]=w.y,p[F]=w.z,p[N+M]=w.x,p[L+M]=w.y,p[F+M]=w.z),i.tangent&&(A=_.default.normalize(_.default.cross(P,w,A),A),m[N]=A.x,m[L]=A.y,m[F]=A.z,m[N+M]=A.x,m[N+1+M]=A.y,m[N+2+M]=A.z),i.bitangent&&(g[N]=P.x,g[L]=P.y,g[F]=P.z,g[N+M]=P.x,g[L+M]=P.y,g[F+M]=P.z)}}if(i.st){M=h.length;for(var z=0;z<M;z+=2)h[z]=(h[z]-T.x)/(I.x-T.x),h[z+1]=(h[z+1]-T.y)/(I.y-T.y)}var W=new vi.a;if(i.position&&(W.position=new yi.a({componentDatatype:ut.a.DOUBLE,componentsPerAttribute:3,values:c})),i.st&&(W.st=new yi.a({componentDatatype:ut.a.FLOAT,componentsPerAttribute:2,values:h})),i.normal&&(W.normal=new yi.a({componentDatatype:ut.a.FLOAT,componentsPerAttribute:3,values:p})),i.tangent&&(W.tangent=new yi.a({componentDatatype:ut.a.FLOAT,componentsPerAttribute:3,values:m})),i.bitangent&&(W.bitangent=new yi.a({componentDatatype:ut.a.FLOAT,componentsPerAttribute:3,values:g})),y&&(W.extrudeDirection=new yi.a({componentDatatype:ut.a.FLOAT,componentsPerAttribute:3,values:b})),Object(l.default)(e.offsetAttribute)){var Y=new Uint8Array(f);if(e.offsetAttribute===ht.a.TOP)Y=Object($t.a)(Y,1,0,f/2);else{var q=e.offsetAttribute===ht.a.NONE?0:1;Y=Object($t.a)(Y,q)}W.applyOffset=new yi.a({componentDatatype:ut.a.UNSIGNED_BYTE,componentsPerAttribute:1,values:Y})}return W}(d,t);h=function(t){for(var e=t.length/3,i=_i.a.createTypedArray(e,6*e),a=0,r=0;r<e;r++){var n=r,o=r+e,l=(n+1)%e,s=l+e;i[a++]=n,i[a++]=o,i[a++]=l,i[a++]=l,i[a++]=o,i[a++]=s}return i}(d);var w=_i.a.createTypedArray(2*d.length/3,h),A=new gi.a({attributes:O,indices:w,primitiveType:Oi.a.TRIANGLES}),P=ir.a.combineInstances([new ct.a({geometry:b}),new ct.a({geometry:A})]);return{boundingSphere:f,attributes:P[0].attributes,indices:P[0].indices}}function Pr(t,e,i,a,r,n,o){for(var l=tr.computeEllipsePositions({center:t,semiMajorAxis:e,semiMinorAxis:i,rotation:a,granularity:r},!1,!0).outerPositions,s=l.length/3,u=new Array(s),d=0;d<s;++d)u[d]=_.default.fromArray(l,3*d);var f=wi.default.fromCartesianArray(u,n,o);return f.width>Ut.default.PI&&(f.north=f.north>0?Ut.default.PI_OVER_TWO-Ut.default.EPSILON7:f.north,f.south=f.south<0?Ut.default.EPSILON7-Ut.default.PI_OVER_TWO:f.south,f.east=Ut.default.PI,f.west=-Ut.default.PI),f}function Er(t){var e=(t=Object(o.default)(t,o.default.EMPTY_OBJECT)).center,i=Object(o.default)(t.ellipsoid,mi.default.WGS84),a=t.semiMajorAxis,r=t.semiMinorAxis,n=Object(o.default)(t.granularity,Ut.default.RADIANS_PER_DEGREE),l=Object(o.default)(t.vertexFormat,$.default.DEFAULT),s=Object(o.default)(t.height,0),u=Object(o.default)(t.extrudedHeight,s);this._center=_.default.clone(e),this._semiMajorAxis=a,this._semiMinorAxis=r,this._ellipsoid=mi.default.clone(i),this._rotation=Object(o.default)(t.rotation,0),this._stRotation=Object(o.default)(t.stRotation,0),this._height=Math.max(u,s),this._granularity=n,this._vertexFormat=$.default.clone(l),this._extrudedHeight=Math.min(u,s),this._shadowVolume=Object(o.default)(t.shadowVolume,!1),this._workerName="createEllipseGeometry",this._offsetAttribute=t.offsetAttribute,this._rectangle=void 0,this._textureCoordinateRotationPoints=void 0}Er.packedLength=_.default.packedLength+mi.default.packedLength+$.default.packedLength+9,Er.pack=function(t,e,i){return i=Object(o.default)(i,0),_.default.pack(t._center,e,i),i+=_.default.packedLength,mi.default.pack(t._ellipsoid,e,i),i+=mi.default.packedLength,$.default.pack(t._vertexFormat,e,i),i+=$.default.packedLength,e[i++]=t._semiMajorAxis,e[i++]=t._semiMinorAxis,e[i++]=t._rotation,e[i++]=t._stRotation,e[i++]=t._height,e[i++]=t._granularity,e[i++]=t._extrudedHeight,e[i++]=t._shadowVolume?1:0,e[i]=Object(o.default)(t._offsetAttribute,-1),e};var Cr=new _.default,jr=new mi.default,Dr=new $.default,xr={center:Cr,ellipsoid:jr,vertexFormat:Dr,semiMajorAxis:void 0,semiMinorAxis:void 0,rotation:void 0,stRotation:void 0,height:void 0,granularity:void 0,extrudedHeight:void 0,shadowVolume:void 0,offsetAttribute:void 0};Er.unpack=function(t,e,i){e=Object(o.default)(e,0);var a=_.default.unpack(t,e,Cr);e+=_.default.packedLength;var r=mi.default.unpack(t,e,jr);e+=mi.default.packedLength;var n=$.default.unpack(t,e,Dr);e+=$.default.packedLength;var s=t[e++],u=t[e++],d=t[e++],f=t[e++],c=t[e++],h=t[e++],p=t[e++],m=1===t[e++],g=t[e];return Object(l.default)(i)?(i._center=_.default.clone(a,i._center),i._ellipsoid=mi.default.clone(r,i._ellipsoid),i._vertexFormat=$.default.clone(n,i._vertexFormat),i._semiMajorAxis=s,i._semiMinorAxis=u,i._rotation=d,i._stRotation=f,i._height=c,i._granularity=h,i._extrudedHeight=p,i._shadowVolume=m,i._offsetAttribute=-1===g?void 0:g,i):(xr.height=c,xr.extrudedHeight=p,xr.granularity=h,xr.stRotation=f,xr.rotation=d,xr.semiMajorAxis=s,xr.semiMinorAxis=u,xr.shadowVolume=m,xr.offsetAttribute=-1===g?void 0:g,new Er(xr))},Er.computeRectangle=function(t,e){var i=(t=Object(o.default)(t,o.default.EMPTY_OBJECT)).center,a=Object(o.default)(t.ellipsoid,mi.default.WGS84),r=t.semiMajorAxis,n=t.semiMinorAxis,l=Object(o.default)(t.granularity,Ut.default.RADIANS_PER_DEGREE);return Pr(i,r,n,Object(o.default)(t.rotation,0),l,a,e)},Er.createGeometry=function(t){if(!(t._semiMajorAxis<=0||t._semiMinorAxis<=0)){var e=t._height,i=t._extrudedHeight,a=!Ut.default.equalsEpsilon(e,i,0,Ut.default.EPSILON2);t._center=t._ellipsoid.scaleToGeodeticSurface(t._center,t._center);var n,o={center:t._center,semiMajorAxis:t._semiMajorAxis,semiMinorAxis:t._semiMinorAxis,ellipsoid:t._ellipsoid,rotation:t._rotation,height:e,granularity:t._granularity,vertexFormat:t._vertexFormat,stRotation:t._stRotation};if(a)o.extrudedHeight=i,o.shadowVolume=t._shadowVolume,o.offsetAttribute=t._offsetAttribute,n=Ar(o);else if(n=function(t){var e=t.center;br=_.default.multiplyByScalar(t.ellipsoid.geodeticSurfaceNormal(e,br),t.height,br),br=_.default.add(e,br,br);var i=new r.default(br,t.semiMajorAxis),a=tr.computeEllipsePositions(t,!0,!1),n=a.positions,o=a.numPts,l=vr(n,t,!1),s=_r(o);return{boundingSphere:i,attributes:l,indices:s=_i.a.createTypedArray(n.length/3,s)}}(o),Object(l.default)(t._offsetAttribute)){var s=n.attributes.position.values.length,u=new Uint8Array(s/3),d=t._offsetAttribute===ht.a.NONE?0:1;Object($t.a)(u,d),n.attributes.applyOffset=new yi.a({componentDatatype:ut.a.UNSIGNED_BYTE,componentsPerAttribute:1,values:u})}return new gi.a({attributes:n.attributes,indices:n.indices,primitiveType:Oi.a.TRIANGLES,boundingSphere:n.boundingSphere,offsetAttribute:t._offsetAttribute})}},Er.createShadowVolume=function(t,e,i){var a=t._granularity,r=t._ellipsoid,n=e(a,r),o=i(a,r);return new Er({center:t._center,semiMajorAxis:t._semiMajorAxis,semiMinorAxis:t._semiMinorAxis,ellipsoid:r,rotation:t._rotation,stRotation:t._stRotation,granularity:a,extrudedHeight:n,height:o,vertexFormat:$.default.POSITION_ONLY,shadowVolume:!0})},Object(s.default)(Er.prototype,{rectangle:{get:function(){return Object(l.default)(this._rectangle)||(this._rectangle=Pr(this._center,this._semiMajorAxis,this._semiMinorAxis,this._rotation,this._granularity,this._ellipsoid)),this._rectangle}},textureCoordinateRotationPoints:{get:function(){return Object(l.default)(this._textureCoordinateRotationPoints)||(this._textureCoordinateRotationPoints=function(t){var e=-t._stRotation;if(0===e)return[0,0,0,1,1,0];for(var i=tr.computeEllipsePositions({center:t._center,semiMajorAxis:t._semiMajorAxis,semiMinorAxis:t._semiMinorAxis,rotation:t._rotation,granularity:t._granularity},!1,!0).outerPositions,a=i.length/3,r=new Array(a),n=0;n<a;++n)r[n]=_.default.fromArray(i,3*n);var o=t._ellipsoid,l=t.rectangle;return gi.a._textureCoordinateRotationPoints(r,e,o,l)}(this)),this._textureCoordinateRotationPoints}}});var Tr=Er,Ir=new _.default,Mr=new _.default;var Vr=new r.default,Nr=new r.default;function Sr(t){var e=(t=Object(o.default)(t,o.default.EMPTY_OBJECT)).center,i=Object(o.default)(t.ellipsoid,mi.default.WGS84),a=t.semiMajorAxis,r=t.semiMinorAxis,n=Object(o.default)(t.granularity,Ut.default.RADIANS_PER_DEGREE),l=Object(o.default)(t.height,0),s=Object(o.default)(t.extrudedHeight,l);this._center=_.default.clone(e),this._semiMajorAxis=a,this._semiMinorAxis=r,this._ellipsoid=mi.default.clone(i),this._rotation=Object(o.default)(t.rotation,0),this._height=Math.max(s,l),this._granularity=n,this._extrudedHeight=Math.min(s,l),this._numberOfVerticalLines=Math.max(Object(o.default)(t.numberOfVerticalLines,16),0),this._offsetAttribute=t.offsetAttribute,this._workerName="createEllipseOutlineGeometry"}Sr.packedLength=_.default.packedLength+mi.default.packedLength+8,Sr.pack=function(t,e,i){return i=Object(o.default)(i,0),_.default.pack(t._center,e,i),i+=_.default.packedLength,mi.default.pack(t._ellipsoid,e,i),i+=mi.default.packedLength,e[i++]=t._semiMajorAxis,e[i++]=t._semiMinorAxis,e[i++]=t._rotation,e[i++]=t._height,e[i++]=t._granularity,e[i++]=t._extrudedHeight,e[i++]=t._numberOfVerticalLines,e[i]=Object(o.default)(t._offsetAttribute,-1),e};var Lr=new _.default,Fr=new mi.default,Ur={center:Lr,ellipsoid:Fr,semiMajorAxis:void 0,semiMinorAxis:void 0,rotation:void 0,height:void 0,granularity:void 0,extrudedHeight:void 0,numberOfVerticalLines:void 0,offsetAttribute:void 0};Sr.unpack=function(t,e,i){e=Object(o.default)(e,0);var a=_.default.unpack(t,e,Lr);e+=_.default.packedLength;var r=mi.default.unpack(t,e,Fr);e+=mi.default.packedLength;var n=t[e++],s=t[e++],u=t[e++],d=t[e++],f=t[e++],c=t[e++],h=t[e++],p=t[e];return Object(l.default)(i)?(i._center=_.default.clone(a,i._center),i._ellipsoid=mi.default.clone(r,i._ellipsoid),i._semiMajorAxis=n,i._semiMinorAxis=s,i._rotation=u,i._height=d,i._granularity=f,i._extrudedHeight=c,i._numberOfVerticalLines=h,i._offsetAttribute=-1===p?void 0:p,i):(Ur.height=d,Ur.extrudedHeight=c,Ur.granularity=f,Ur.rotation=u,Ur.semiMajorAxis=n,Ur.semiMinorAxis=s,Ur.numberOfVerticalLines=h,Ur.offsetAttribute=-1===p?void 0:p,new Sr(Ur))},Sr.createGeometry=function(t){if(!(t._semiMajorAxis<=0||t._semiMinorAxis<=0)){var e=t._height,i=t._extrudedHeight,a=!Ut.default.equalsEpsilon(e,i,0,Ut.default.EPSILON2);t._center=t._ellipsoid.scaleToGeodeticSurface(t._center,t._center);var n,s={center:t._center,semiMajorAxis:t._semiMajorAxis,semiMinorAxis:t._semiMinorAxis,ellipsoid:t._ellipsoid,rotation:t._rotation,height:e,granularity:t._granularity,numberOfVerticalLines:t._numberOfVerticalLines};if(a)s.extrudedHeight=i,s.offsetAttribute=t._offsetAttribute,n=function(t){var e=t.center,i=t.ellipsoid,a=t.semiMajorAxis,n=_.default.multiplyByScalar(i.geodeticSurfaceNormal(e,Ir),t.height,Ir);Vr.center=_.default.add(e,n,Vr.center),Vr.radius=a,n=_.default.multiplyByScalar(i.geodeticSurfaceNormal(e,n),t.extrudedHeight,n),Nr.center=_.default.add(e,n,Nr.center),Nr.radius=a;var s=tr.computeEllipsePositions(t,!1,!0).outerPositions,u=new vi.a({position:new yi.a({componentDatatype:ut.a.DOUBLE,componentsPerAttribute:3,values:tr.raisePositionsToHeight(s,t,!0)})});s=u.position.values;var d=r.default.union(Vr,Nr),f=s.length/3;if(Object(l.default)(t.offsetAttribute)){var c=new Uint8Array(f);if(t.offsetAttribute===ht.a.TOP)c=Object($t.a)(c,1,0,f/2);else{var h=t.offsetAttribute===ht.a.NONE?0:1;c=Object($t.a)(c,h)}u.applyOffset=new yi.a({componentDatatype:ut.a.UNSIGNED_BYTE,componentsPerAttribute:1,values:c})}var p=Object(o.default)(t.numberOfVerticalLines,16);p=Ut.default.clamp(p,0,f/2);var m=_i.a.createTypedArray(f,2*f+2*p);f/=2;var g,y,v=0;for(g=0;g<f;++g)m[v++]=g,m[v++]=(g+1)%f,m[v++]=g+f,m[v++]=(g+1)%f+f;if(p>0){var b=Math.min(p,f);y=Math.round(f/b);var O=Math.min(y*p,f);for(g=0;g<O;g+=y)m[v++]=g,m[v++]=g+f}return{boundingSphere:d,attributes:u,indices:m}}(s);else if(n=function(t){var e=t.center;Mr=_.default.multiplyByScalar(t.ellipsoid.geodeticSurfaceNormal(e,Mr),t.height,Mr),Mr=_.default.add(e,Mr,Mr);for(var i=new r.default(Mr,t.semiMajorAxis),a=tr.computeEllipsePositions(t,!1,!0).outerPositions,n=new vi.a({position:new yi.a({componentDatatype:ut.a.DOUBLE,componentsPerAttribute:3,values:tr.raisePositionsToHeight(a,t,!1)})}),o=a.length/3,l=_i.a.createTypedArray(o,2*o),s=0,u=0;u<o;++u)l[s++]=u,l[s++]=(u+1)%o;return{boundingSphere:i,attributes:n,indices:l}}(s),Object(l.default)(t._offsetAttribute)){var u=n.attributes.position.values.length,d=new Uint8Array(u/3),f=t._offsetAttribute===ht.a.NONE?0:1;Object($t.a)(d,f),n.attributes.applyOffset=new yi.a({componentDatatype:ut.a.UNSIGNED_BYTE,componentsPerAttribute:1,values:d})}return new gi.a({attributes:n.attributes,indices:n.indices,primitiveType:Oi.a.LINES,boundingSphere:n.boundingSphere,offsetAttribute:t._offsetAttribute})}};var Rr=Sr,Hr=new b.default,Br=_.default.ZERO,Gr=new _.default,kr=new wi.default;function zr(t){this.id=t,this.vertexFormat=void 0,this.center=void 0,this.semiMajorAxis=void 0,this.semiMinorAxis=void 0,this.rotation=void 0,this.height=void 0,this.extrudedHeight=void 0,this.granularity=void 0,this.stRotation=void 0,this.numberOfVerticalLines=void 0,this.offsetAttribute=void 0}function Wr(t,e){oa.call(this,{entity:t,scene:e,geometryOptions:new zr(t),geometryPropertyName:"ellipse",observedPropertyNames:["availability","position","ellipse"]}),this._onEntityPropertyChanged(t,"ellipse",t.ellipse,void 0)}function Yr(t,e,i){wt.call(this,t,e,i)}Object(l.default)(Object.create)&&(Wr.prototype=Object.create(oa.prototype),Wr.prototype.constructor=Wr),Wr.prototype.createFillGeometryInstance=function(t){var e,i=this._entity,a=i.isAvailable(t),r={show:new gt.a(a&&i.isShowing&&this._showProperty.getValue(t)&&this._fillProperty.getValue(t)),distanceDisplayCondition:ft.fromDistanceDisplayCondition(this._distanceDisplayConditionProperty.getValue(t)),offset:void 0,color:void 0};this._materialProperty instanceof yt.default&&(Object(l.default)(this._materialProperty.color)&&(this._materialProperty.color.isConstant||a)&&(e=this._materialProperty.color.getValue(t,Hr)),Object(l.default)(e)||(e=b.default.WHITE),r.color=st.a.fromColor(e));return Object(l.default)(this._options.offsetAttribute)&&(r.offset=mt.a.fromCartesian3(D.default.getValueOrDefault(this._terrainOffsetProperty,t,Br,Gr))),new ct.a({id:i,geometry:new Tr(this._options),attributes:r})},Wr.prototype.createOutlineGeometryInstance=function(t){var e=this._entity,i=e.isAvailable(t),a=D.default.getValueOrDefault(this._outlineColorProperty,t,b.default.BLACK,Hr),r=this._distanceDisplayConditionProperty.getValue(t),n={show:new gt.a(i&&e.isShowing&&this._showProperty.getValue(t)&&this._showOutlineProperty.getValue(t)),color:st.a.fromColor(a),distanceDisplayCondition:ft.fromDistanceDisplayCondition(r),offset:void 0};return Object(l.default)(this._options.offsetAttribute)&&(n.offset=mt.a.fromCartesian3(D.default.getValueOrDefault(this._terrainOffsetProperty,t,Br,Gr))),new ct.a({id:e,geometry:new Rr(this._options),attributes:n})},Wr.prototype._computeCenter=function(t,e){return D.default.getValueOrUndefined(this._entity.position,t,e)},Wr.prototype._isHidden=function(t,e){var i=t.position;return!Object(l.default)(i)||!Object(l.default)(e.semiMajorAxis)||!Object(l.default)(e.semiMinorAxis)||St.prototype._isHidden.call(this,t,e)},Wr.prototype._isDynamic=function(t,e){return!t.position.isConstant||!e.semiMajorAxis.isConstant||!e.semiMinorAxis.isConstant||!D.default.isConstant(e.rotation)||!D.default.isConstant(e.height)||!D.default.isConstant(e.extrudedHeight)||!D.default.isConstant(e.granularity)||!D.default.isConstant(e.stRotation)||!D.default.isConstant(e.outlineWidth)||!D.default.isConstant(e.numberOfVerticalLines)||!D.default.isConstant(e.zIndex)||this._onTerrain&&!D.default.isConstant(this._materialProperty)},Wr.prototype._setStaticOptions=function(t,e){var i=D.default.getValueOrUndefined(e.height,pt.default.MINIMUM_VALUE),r=D.default.getValueOrDefault(e.heightReference,pt.default.MINIMUM_VALUE,P.default.NONE),n=D.default.getValueOrUndefined(e.extrudedHeight,pt.default.MINIMUM_VALUE),o=D.default.getValueOrDefault(e.extrudedHeightReference,pt.default.MINIMUM_VALUE,P.default.NONE);Object(l.default)(n)&&!Object(l.default)(i)&&(i=0);var s=this._options;s.vertexFormat=this._materialProperty instanceof yt.default?rt.a.VERTEX_FORMAT:at.MaterialSupport.TEXTURED.vertexFormat,s.center=t.position.getValue(pt.default.MINIMUM_VALUE,s.center),s.semiMajorAxis=e.semiMajorAxis.getValue(pt.default.MINIMUM_VALUE,s.semiMajorAxis),s.semiMinorAxis=e.semiMinorAxis.getValue(pt.default.MINIMUM_VALUE,s.semiMinorAxis),s.rotation=D.default.getValueOrUndefined(e.rotation,pt.default.MINIMUM_VALUE),s.granularity=D.default.getValueOrUndefined(e.granularity,pt.default.MINIMUM_VALUE),s.stRotation=D.default.getValueOrUndefined(e.stRotation,pt.default.MINIMUM_VALUE),s.numberOfVerticalLines=D.default.getValueOrUndefined(e.numberOfVerticalLines,pt.default.MINIMUM_VALUE),s.offsetAttribute=oa.computeGeometryOffsetAttribute(i,r,n,o),s.height=oa.getGeometryHeight(i,r),(n=oa.getGeometryExtrudedHeight(n,o))===oa.CLAMP_TO_GROUND&&(n=a.a.getMinimumMaximumHeights(Tr.computeRectangle(s,kr)).minimumTerrainHeight),s.extrudedHeight=n},Wr.DynamicGeometryUpdater=Yr,Object(l.default)(Object.create)&&(Yr.prototype=Object.create(wt.prototype),Yr.prototype.constructor=Yr),Yr.prototype._isHidden=function(t,e,i){var a=this._options;return!Object(l.default)(a.center)||!Object(l.default)(a.semiMajorAxis)||!Object(l.default)(a.semiMinorAxis)||wt.prototype._isHidden.call(this,t,e,i)},Yr.prototype._setOptions=function(t,e,i){var r=this._options,n=D.default.getValueOrUndefined(e.height,i),o=D.default.getValueOrDefault(e.heightReference,i,P.default.NONE),s=D.default.getValueOrUndefined(e.extrudedHeight,i),u=D.default.getValueOrDefault(e.extrudedHeightReference,i,P.default.NONE);Object(l.default)(s)&&!Object(l.default)(n)&&(n=0),r.center=D.default.getValueOrUndefined(t.position,i,r.center),r.semiMajorAxis=D.default.getValueOrUndefined(e.semiMajorAxis,i),r.semiMinorAxis=D.default.getValueOrUndefined(e.semiMinorAxis,i),r.rotation=D.default.getValueOrUndefined(e.rotation,i),r.granularity=D.default.getValueOrUndefined(e.granularity,i),r.stRotation=D.default.getValueOrUndefined(e.stRotation,i),r.numberOfVerticalLines=D.default.getValueOrUndefined(e.numberOfVerticalLines,i),r.offsetAttribute=oa.computeGeometryOffsetAttribute(n,o,s,u),r.height=oa.getGeometryHeight(n,o),(s=oa.getGeometryExtrudedHeight(s,u))===oa.CLAMP_TO_GROUND&&(s=a.a.getMinimumMaximumHeights(Tr.computeRectangle(r,kr)).minimumTerrainHeight),r.extrudedHeight=s};var qr=Wr,Xr=i(302),Zr=i(253),Jr=new yt.default(b.default.WHITE),Kr=_.default.ZERO,Qr=new _.default,$r=new _.default,tn=new _.default,en=new b.default,an=new _.default(1,1,1);function rn(t){this.id=t,this.vertexFormat=void 0,this.radii=void 0,this.innerRadii=void 0,this.minimumClock=void 0,this.maximumClock=void 0,this.minimumCone=void 0,this.maximumCone=void 0,this.stackPartitions=void 0,this.slicePartitions=void 0,this.subdivisions=void 0,this.offsetAttribute=void 0}function nn(t,e){St.call(this,{entity:t,scene:e,geometryOptions:new rn(t),geometryPropertyName:"ellipsoid",observedPropertyNames:["availability","position","orientation","ellipsoid"]}),this._onEntityPropertyChanged(t,"ellipsoid",t.ellipsoid,void 0)}function on(t,e,i){wt.call(this,t,e,i),this._scene=t._scene,this._modelMatrix=new oe.default,this._attributes=void 0,this._outlineAttributes=void 0,this._lastSceneMode=void 0,this._lastShow=void 0,this._lastOutlineShow=void 0,this._lastOutlineWidth=void 0,this._lastOutlineColor=void 0,this._lastOffset=new _.default,this._material={}}Object(l.default)(Object.create)&&(nn.prototype=Object.create(St.prototype),nn.prototype.constructor=nn),Object(s.default)(nn.prototype,{terrainOffsetProperty:{get:function(){return this._terrainOffsetProperty}}}),nn.prototype.createFillGeometryInstance=function(t,e,i){var a,r,n=this._entity,o=n.isAvailable(t),s=new gt.a(o&&n.isShowing&&this._showProperty.getValue(t)&&this._fillProperty.getValue(t)),u=this._distanceDisplayConditionProperty.getValue(t),d={show:s,distanceDisplayCondition:ft.fromDistanceDisplayCondition(u),color:void 0,offset:void 0};this._materialProperty instanceof yt.default&&(Object(l.default)(this._materialProperty.color)&&(this._materialProperty.color.isConstant||o)&&(r=this._materialProperty.color.getValue(t,en)),Object(l.default)(r)||(r=b.default.WHITE),a=st.a.fromColor(r),d.color=a);return Object(l.default)(this._options.offsetAttribute)&&(d.offset=mt.a.fromCartesian3(D.default.getValueOrDefault(this._terrainOffsetProperty,t,Kr,Qr))),new ct.a({id:n,geometry:new Xr.a(this._options),modelMatrix:e?void 0:n.computeModelMatrixForHeightReference(t,n.ellipsoid.heightReference,.5*this._options.radii.z,this._scene.mapProjection.ellipsoid,i),attributes:d})},nn.prototype.createOutlineGeometryInstance=function(t,e,i){var a=this._entity,r=a.isAvailable(t),n=D.default.getValueOrDefault(this._outlineColorProperty,t,b.default.BLACK,en),o=this._distanceDisplayConditionProperty.getValue(t),s={show:new gt.a(r&&a.isShowing&&this._showProperty.getValue(t)&&this._showOutlineProperty.getValue(t)),color:st.a.fromColor(n),distanceDisplayCondition:ft.fromDistanceDisplayCondition(o),offset:void 0};return Object(l.default)(this._options.offsetAttribute)&&(s.offset=mt.a.fromCartesian3(D.default.getValueOrDefault(this._terrainOffsetProperty,t,Kr,Qr))),new ct.a({id:a,geometry:new Zr.a(this._options),modelMatrix:e?void 0:a.computeModelMatrixForHeightReference(t,a.ellipsoid.heightReference,.5*this._options.radii.z,this._scene.mapProjection.ellipsoid,i),attributes:s})},nn.prototype._computeCenter=function(t,e){return D.default.getValueOrUndefined(this._entity.position,t,e)},nn.prototype._isHidden=function(t,e){return!Object(l.default)(t.position)||!Object(l.default)(e.radii)||St.prototype._isHidden.call(this,t,e)},nn.prototype._isDynamic=function(t,e){return!(t.position.isConstant&&D.default.isConstant(t.orientation)&&e.radii.isConstant&&D.default.isConstant(e.innerRadii)&&D.default.isConstant(e.stackPartitions)&&D.default.isConstant(e.slicePartitions)&&D.default.isConstant(e.outlineWidth)&&D.default.isConstant(e.minimumClock)&&D.default.isConstant(e.maximumClock)&&D.default.isConstant(e.minimumCone)&&D.default.isConstant(e.maximumCone)&&D.default.isConstant(e.subdivisions))},nn.prototype._setStaticOptions=function(t,e){var i=D.default.getValueOrDefault(e.heightReference,pt.default.MINIMUM_VALUE,P.default.NONE),a=this._options;a.vertexFormat=this._materialProperty instanceof yt.default?rt.a.VERTEX_FORMAT:at.MaterialSupport.TEXTURED.vertexFormat,a.radii=e.radii.getValue(pt.default.MINIMUM_VALUE,a.radii),a.innerRadii=D.default.getValueOrUndefined(e.innerRadii,a.radii),a.minimumClock=D.default.getValueOrUndefined(e.minimumClock,pt.default.MINIMUM_VALUE),a.maximumClock=D.default.getValueOrUndefined(e.maximumClock,pt.default.MINIMUM_VALUE),a.minimumCone=D.default.getValueOrUndefined(e.minimumCone,pt.default.MINIMUM_VALUE),a.maximumCone=D.default.getValueOrUndefined(e.maximumCone,pt.default.MINIMUM_VALUE),a.stackPartitions=D.default.getValueOrUndefined(e.stackPartitions,pt.default.MINIMUM_VALUE),a.slicePartitions=D.default.getValueOrUndefined(e.slicePartitions,pt.default.MINIMUM_VALUE),a.subdivisions=D.default.getValueOrUndefined(e.subdivisions,pt.default.MINIMUM_VALUE),a.offsetAttribute=i!==P.default.NONE?ht.a.ALL:void 0},nn.prototype._onEntityPropertyChanged=zt,nn.DynamicGeometryUpdater=on,Object(l.default)(Object.create)&&(on.prototype=Object.create(wt.prototype),on.prototype.constructor=on),on.prototype.update=function(t){var e=this._entity,i=e.ellipsoid;if(!e.isShowing||!e.isAvailable(t)||!D.default.getValueOrDefault(i.show,t,!0))return Object(l.default)(this._primitive)&&(this._primitive.show=!1),void(Object(l.default)(this._outlinePrimitive)&&(this._outlinePrimitive.show=!1));var a=D.default.getValueOrUndefined(i.radii,t,$r),r=Object(l.default)(a)?e.computeModelMatrixForHeightReference(t,i.heightReference,.5*a.z,this._scene.mapProjection.ellipsoid,this._modelMatrix):void 0;if(!Object(l.default)(r)||!Object(l.default)(a))return Object(l.default)(this._primitive)&&(this._primitive.show=!1),void(Object(l.default)(this._outlinePrimitive)&&(this._outlinePrimitive.show=!1));var n=D.default.getValueOrDefault(i.fill,t,!0),s=D.default.getValueOrDefault(i.outline,t,!1),u=D.default.getValueOrClonedDefault(i.outlineColor,t,b.default.BLACK,en),d=bt.getValue(t,Object(o.default)(i.material,Jr),this._material),f=D.default.getValueOrUndefined(i.innerRadii,t,tn),c=D.default.getValueOrUndefined(i.minimumClock,t),h=D.default.getValueOrUndefined(i.maximumClock,t),p=D.default.getValueOrUndefined(i.minimumCone,t),m=D.default.getValueOrUndefined(i.maximumCone,t),g=D.default.getValueOrUndefined(i.stackPartitions,t),y=D.default.getValueOrUndefined(i.slicePartitions,t),v=D.default.getValueOrUndefined(i.subdivisions,t),O=D.default.getValueOrDefault(i.outlineWidth,t,1),A=D.default.getValueOrDefault(i.heightReference,t,P.default.NONE),E=A!==P.default.NONE?ht.a.ALL:void 0,C=this._scene.mode,j=C===Rt.a.SCENE3D&&A===P.default.NONE,x=this._options,T=this._geometryUpdater.shadowsProperty.getValue(t),I=this._geometryUpdater.distanceDisplayConditionProperty.getValue(t),M=D.default.getValueOrDefault(this._geometryUpdater.terrainOffsetProperty,t,Kr,Qr);if(!j||this._lastSceneMode!==C||!Object(l.default)(this._primitive)||x.stackPartitions!==g||x.slicePartitions!==y||Object(l.default)(f)&&!_.default.equals(x.innerRadii!==f)||x.minimumClock!==c||x.maximumClock!==h||x.minimumCone!==p||x.maximumCone!==m||x.subdivisions!==v||this._lastOutlineWidth!==O||x.offsetAttribute!==E){var V=this._primitives;if(V.removeAndDestroy(this._primitive),V.removeAndDestroy(this._outlinePrimitive),this._primitive=void 0,this._outlinePrimitive=void 0,this._lastSceneMode=C,this._lastOutlineWidth=O,x.stackPartitions=g,x.slicePartitions=y,x.subdivisions=v,x.offsetAttribute=E,x.radii=_.default.clone(j?an:a,x.radii),Object(l.default)(f))if(j){var N=_.default.magnitude(a);x.innerRadii=_.default.fromElements(f.x/N,f.y/N,f.z/N,x.innerRadii)}else x.innerRadii=_.default.clone(f,x.innerRadii);else x.innerRadii=void 0;x.minimumClock=c,x.maximumClock=h,x.minimumCone=p,x.maximumCone=m;var S=new at({material:d,translucent:d.isTranslucent(),closed:!0});x.vertexFormat=S.vertexFormat;var L=this._geometryUpdater.createFillGeometryInstance(t,j,this._modelMatrix);this._primitive=V.add(new vt.a({geometryInstances:L,appearance:S,asynchronous:!1,shadows:T}));var F=this._geometryUpdater.createOutlineGeometryInstance(t,j,this._modelMatrix);this._outlinePrimitive=V.add(new vt.a({geometryInstances:F,appearance:new rt.a({flat:!0,translucent:255!==F.attributes.color.value[3],renderState:{lineWidth:this._geometryUpdater._scene.clampLineWidth(O)}}),asynchronous:!1,shadows:T})),this._lastShow=n,this._lastOutlineShow=s,this._lastOutlineColor=b.default.clone(u,this._lastOutlineColor),this._lastDistanceDisplayCondition=I,this._lastOffset=_.default.clone(M,this._lastOffset)}else if(this._primitive.ready){var U=this._primitive,R=this._outlinePrimitive;U.show=!0,R.show=!0,U.appearance.material=d;var H=this._attributes;Object(l.default)(H)||(H=U.getGeometryInstanceAttributes(e),this._attributes=H),n!==this._lastShow&&(H.show=gt.a.toValue(n,H.show),this._lastShow=n);var B=this._outlineAttributes;Object(l.default)(B)||(B=R.getGeometryInstanceAttributes(e),this._outlineAttributes=B),s!==this._lastOutlineShow&&(B.show=gt.a.toValue(s,B.show),this._lastOutlineShow=s),b.default.equals(u,this._lastOutlineColor)||(B.color=st.a.toValue(u,B.color),b.default.clone(u,this._lastOutlineColor)),w.a.equals(I,this._lastDistanceDisplayCondition)||(H.distanceDisplayCondition=ft.toValue(I,H.distanceDisplayCondition),B.distanceDisplayCondition=ft.toValue(I,B.distanceDisplayCondition),w.a.clone(I,this._lastDistanceDisplayCondition)),_.default.equals(M,this._lastOffset)||(H.offset=mt.a.toValue(M,H.offset),B.offset=mt.a.toValue(M,H.offset),_.default.clone(M,this._lastOffset))}j&&(a.x=Math.max(a.x,.001),a.y=Math.max(a.y,.001),a.z=Math.max(a.z,.001),r=oe.default.multiplyByScale(r,a,r),this._primitive.modelMatrix=r,this._outlinePrimitive.modelMatrix=r)};var ln=nn;function sn(t){t=Object(o.default)(t,o.default.EMPTY_OBJECT);var e=Object(o.default)(t.vertexFormat,$.default.DEFAULT);this._vertexFormat=e,this._workerName="createPlaneGeometry"}sn.packedLength=$.default.packedLength,sn.pack=function(t,e,i){return i=Object(o.default)(i,0),$.default.pack(t._vertexFormat,e,i),e};var un=new $.default,dn={vertexFormat:un};sn.unpack=function(t,e,i){e=Object(o.default)(e,0);var a=$.default.unpack(t,e,un);return Object(l.default)(i)?(i._vertexFormat=$.default.clone(a,i._vertexFormat),i):new sn(dn)};var fn=new _.default(-.5,-.5,0),cn=new _.default(.5,.5,0);sn.createGeometry=function(t){var e,i,a=t._vertexFormat,n=new vi.a;if(a.position){if((i=new Float64Array(12))[0]=fn.x,i[1]=fn.y,i[2]=0,i[3]=cn.x,i[4]=fn.y,i[5]=0,i[6]=cn.x,i[7]=cn.y,i[8]=0,i[9]=fn.x,i[10]=cn.y,i[11]=0,n.position=new yi.a({componentDatatype:ut.a.DOUBLE,componentsPerAttribute:3,values:i}),a.normal){var o=new Float32Array(12);o[0]=0,o[1]=0,o[2]=1,o[3]=0,o[4]=0,o[5]=1,o[6]=0,o[7]=0,o[8]=1,o[9]=0,o[10]=0,o[11]=1,n.normal=new yi.a({componentDatatype:ut.a.FLOAT,componentsPerAttribute:3,values:o})}if(a.st){var l=new Float32Array(8);l[0]=0,l[1]=0,l[2]=1,l[3]=0,l[4]=1,l[5]=1,l[6]=0,l[7]=1,n.st=new yi.a({componentDatatype:ut.a.FLOAT,componentsPerAttribute:2,values:l})}if(a.tangent){var s=new Float32Array(12);s[0]=1,s[1]=0,s[2]=0,s[3]=1,s[4]=0,s[5]=0,s[6]=1,s[7]=0,s[8]=0,s[9]=1,s[10]=0,s[11]=0,n.tangent=new yi.a({componentDatatype:ut.a.FLOAT,componentsPerAttribute:3,values:s})}if(a.bitangent){var u=new Float32Array(12);u[0]=0,u[1]=1,u[2]=0,u[3]=0,u[4]=1,u[5]=0,u[6]=0,u[7]=1,u[8]=0,u[9]=0,u[10]=1,u[11]=0,n.bitangent=new yi.a({componentDatatype:ut.a.FLOAT,componentsPerAttribute:3,values:u})}(e=new Uint16Array(6))[0]=0,e[1]=1,e[2]=2,e[3]=0,e[4]=2,e[5]=3}return new gi.a({attributes:n,indices:e,primitiveType:Oi.a.TRIANGLES,boundingSphere:new r.default(_.default.ZERO,Math.sqrt(2))})};var hn=sn;function pn(){this._workerName="createPlaneOutlineGeometry"}pn.packedLength=0,pn.pack=function(t,e){return e},pn.unpack=function(t,e,i){return Object(l.default)(i)?i:new pn};var mn=new _.default(-.5,-.5,0),gn=new _.default(.5,.5,0);pn.createGeometry=function(){var t=new vi.a,e=new Uint16Array(8),i=new Float64Array(12);return i[0]=mn.x,i[1]=mn.y,i[2]=mn.z,i[3]=gn.x,i[4]=mn.y,i[5]=mn.z,i[6]=gn.x,i[7]=gn.y,i[8]=mn.z,i[9]=mn.x,i[10]=gn.y,i[11]=mn.z,t.position=new yi.a({componentDatatype:ut.a.DOUBLE,componentsPerAttribute:3,values:i}),e[0]=0,e[1]=1,e[2]=1,e[3]=2,e[4]=2,e[5]=3,e[6]=3,e[7]=0,new gi.a({attributes:t,indices:e,primitiveType:Oi.a.LINES,boundingSphere:new r.default(_.default.ZERO,Math.sqrt(2))})};var yn=pn,vn=new _.default,_n=new b.default;function bn(t){this.id=t,this.vertexFormat=void 0,this.plane=void 0,this.dimensions=void 0}function On(t,e){St.call(this,{entity:t,scene:e,geometryOptions:new bn(t),geometryPropertyName:"plane",observedPropertyNames:["availability","position","orientation","plane"]}),this._onEntityPropertyChanged(t,"plane",t.plane,void 0)}function wn(t,e,i){wt.call(this,t,e,i)}Object(l.default)(Object.create)&&(On.prototype=Object.create(St.prototype),On.prototype.constructor=On),On.prototype.createFillGeometryInstance=function(t){var e,i,a=this._entity,r=a.isAvailable(t),n=new gt.a(r&&a.isShowing&&this._showProperty.getValue(t)&&this._fillProperty.getValue(t)),o=this._distanceDisplayConditionProperty.getValue(t),s=ft.fromDistanceDisplayCondition(o);this._materialProperty instanceof yt.default?(Object(l.default)(this._materialProperty.color)&&(this._materialProperty.color.isConstant||r)&&(i=this._materialProperty.color.getValue(t,_n)),Object(l.default)(i)||(i=b.default.WHITE),e={show:n,distanceDisplayCondition:s,color:st.a.fromColor(i)}):e={show:n,distanceDisplayCondition:s};var u=a.plane,d=this._options,f=a.computeModelMatrix(t),c=D.default.getValueOrDefault(u.plane,t,d.plane),h=D.default.getValueOrUndefined(u.dimensions,t,d.dimensions);return d.plane=c,d.dimensions=h,f=Tn(c,h,f,this._scene.mapProjection.ellipsoid,f),new ct.a({id:a,geometry:new hn(this._options),modelMatrix:f,attributes:e})},On.prototype.createOutlineGeometryInstance=function(t){var e=this._entity,i=e.isAvailable(t),a=D.default.getValueOrDefault(this._outlineColorProperty,t,b.default.BLACK,_n),r=this._distanceDisplayConditionProperty.getValue(t),n=e.plane,o=this._options,l=e.computeModelMatrix(t),s=D.default.getValueOrDefault(n.plane,t,o.plane),u=D.default.getValueOrUndefined(n.dimensions,t,o.dimensions);return o.plane=s,o.dimensions=u,l=Tn(s,u,l,this._scene.mapProjection.ellipsoid,l),new ct.a({id:e,geometry:new yn,modelMatrix:l,attributes:{show:new gt.a(i&&e.isShowing&&this._showProperty.getValue(t)&&this._showOutlineProperty.getValue(t)),color:st.a.fromColor(a),distanceDisplayCondition:ft.fromDistanceDisplayCondition(r)}})},On.prototype._isHidden=function(t,e){return!Object(l.default)(e.plane)||!Object(l.default)(e.dimensions)||!Object(l.default)(t.position)||St.prototype._isHidden.call(this,t,e)},On.prototype._getIsClosed=function(t){return!1},On.prototype._isDynamic=function(t,e){return!(t.position.isConstant&&D.default.isConstant(t.orientation)&&e.plane.isConstant&&e.dimensions.isConstant&&D.default.isConstant(e.outlineWidth))},On.prototype._setStaticOptions=function(t,e){var i=this._materialProperty instanceof yt.default,a=this._options;a.vertexFormat=i?rt.a.VERTEX_FORMAT:at.MaterialSupport.TEXTURED.vertexFormat,a.plane=e.plane.getValue(pt.default.MINIMUM_VALUE,a.plane),a.dimensions=e.dimensions.getValue(pt.default.MINIMUM_VALUE,a.dimensions)},On.DynamicGeometryUpdater=wn,Object(l.default)(Object.create)&&(wn.prototype=Object.create(wt.prototype),wn.prototype.constructor=wn),wn.prototype._isHidden=function(t,e,i){var a=this._options,r=D.default.getValueOrUndefined(t.position,i,vn);return!Object(l.default)(r)||!Object(l.default)(a.plane)||!Object(l.default)(a.dimensions)||wt.prototype._isHidden.call(this,t,e,i)},wn.prototype._setOptions=function(t,e,i){var a=this._options;a.plane=D.default.getValueOrDefault(e.plane,i,a.plane),a.dimensions=D.default.getValueOrUndefined(e.dimensions,i,a.dimensions)};var An=new _.default,Pn=new _.default,En=new _.default,Cn=new _.default,jn=new _.default,Dn=new le.default,xn=new ie.default;function Tn(t,e,i,a,r){var n=t.normal,o=t.distance,l=_.default.multiplyByScalar(n,-o,En);l=oe.default.multiplyByPoint(i,l,l);var s=oe.default.multiplyByPointAsVector(i,n,Cn);_.default.normalize(s,s);var u=a.geodeticSurfaceNormal(l,Pn);Ut.default.equalsEpsilon(Math.abs(_.default.dot(u,s)),1,Ut.default.EPSILON8)&&(u=_.default.clone(_.default.UNIT_Z,u));var d=_.default.cross(u,s,An);u=_.default.cross(s,d,u),_.default.normalize(d,d),_.default.normalize(u,u);var f=xn;ie.default.setColumn(f,0,d,f),ie.default.setColumn(f,1,u,f),ie.default.setColumn(f,2,s,f);var c=le.default.fromRotationMatrix(f,Dn),h=v.default.clone(e,jn);return h.z=1,oe.default.fromTranslationQuaternionRotationScale(l,c,h,r)}On.createPrimitiveMatrix=Tn;var In=On,Mn=i(150),Vn=i(113),Nn={},Sn=new _.default,Ln=new _.default,Fn=new _.default,Un=new _.default,Rn=new Vn.a;function Hn(t,e,i,a,r){var n=_.default.subtract(t,e,Sn),o=_.default.dot(i,n),l=_.default.dot(a,n);return v.default.fromElements(o,l,r)}Nn.validOutline=function(t){var e=Vn.a.fromPoints(t,Rn).halfAxes,i=ie.default.getColumn(e,0,Ln),a=ie.default.getColumn(e,1,Fn),r=ie.default.getColumn(e,2,Un),n=_.default.magnitude(i),o=_.default.magnitude(a),l=_.default.magnitude(r);return!(0===n&&(0===o||0===l)||0===o&&0===l)},Nn.computeProjectTo2DArguments=function(t,e,i,a){var r,n,o=Vn.a.fromPoints(t,Rn),l=o.halfAxes,s=ie.default.getColumn(l,0,Ln),u=ie.default.getColumn(l,1,Fn),d=ie.default.getColumn(l,2,Un),f=_.default.magnitude(s),c=_.default.magnitude(u),h=_.default.magnitude(d),p=Math.min(f,c,h);return(0!==f||0!==c&&0!==h)&&(0!==c||0!==h)&&(p!==c&&p!==h||(r=s),p===f?r=u:p===h&&(n=u),p!==f&&p!==c||(n=d),_.default.normalize(r,i),_.default.normalize(n,a),_.default.clone(o.center,e),!0)},Nn.createProjectPointsTo2DFunction=function(t,e,i){return function(a){for(var r=new Array(a.length),n=0;n<a.length;n++)r[n]=Hn(a[n],t,e,i);return r}},Nn.createProjectPointTo2DFunction=function(t,e,i){return function(a,r){return Hn(a,t,e,i,r)}};var Bn=Nn,Gn=i(703),kn=new _.default,zn=new y.default,Wn=new v.default,Yn=new v.default,qn=new _.default,Xn=new _.default,Zn=new _.default,Jn=new _.default,Kn=new _.default,Qn=new _.default,$n=new le.default,to=new ie.default,eo=new ie.default,io=new _.default;function ao(t,e,i,a,r,n,o,l){var s=t.positions,u=bi.a.triangulate(t.positions2D,t.holes);u.length<3&&(u=[0,1,2]);var d=_i.a.createTypedArray(s.length,u.length);d.set(u);var f=to;if(0!==a){var c=le.default.fromAxisAngle(n,a,$n);if(f=ie.default.fromQuaternion(c,f),e.tangent||e.bitangent){c=le.default.fromAxisAngle(n,-a,$n);var h=ie.default.fromQuaternion(c,eo);o=_.default.normalize(ie.default.multiplyByVector(h,o,o),o),e.bitangent&&(l=_.default.normalize(_.default.cross(n,o,l),l))}}else f=ie.default.clone(ie.default.IDENTITY,f);var p=Yn;e.st&&(p.x=i.x,p.y=i.y);for(var m=s.length,g=3*m,y=new Float64Array(g),b=e.normal?new Float32Array(g):void 0,O=e.tangent?new Float32Array(g):void 0,w=e.bitangent?new Float32Array(g):void 0,A=e.st?new Float32Array(2*m):void 0,P=0,E=0,C=0,j=0,D=0,x=0;x<m;x++){var T=s[x];if(y[P++]=T.x,y[P++]=T.y,y[P++]=T.z,e.st){var I=r(ie.default.multiplyByVector(f,T,kn),Wn);v.default.subtract(I,p,I);var M=Ut.default.clamp(I.x/i.width,0,1),V=Ut.default.clamp(I.y/i.height,0,1);A[D++]=M,A[D++]=V}e.normal&&(b[E++]=n.x,b[E++]=n.y,b[E++]=n.z),e.tangent&&(O[j++]=o.x,O[j++]=o.y,O[j++]=o.z),e.bitangent&&(w[C++]=l.x,w[C++]=l.y,w[C++]=l.z)}var N=new vi.a;return e.position&&(N.position=new yi.a({componentDatatype:ut.a.DOUBLE,componentsPerAttribute:3,values:y})),e.normal&&(N.normal=new yi.a({componentDatatype:ut.a.FLOAT,componentsPerAttribute:3,values:b})),e.tangent&&(N.tangent=new yi.a({componentDatatype:ut.a.FLOAT,componentsPerAttribute:3,values:O})),e.bitangent&&(N.bitangent=new yi.a({componentDatatype:ut.a.FLOAT,componentsPerAttribute:3,values:w})),e.st&&(N.st=new yi.a({componentDatatype:ut.a.FLOAT,componentsPerAttribute:2,values:A})),new gi.a({attributes:N,indices:d,primitiveType:Oi.a.TRIANGLES})}function ro(t){var e=(t=Object(o.default)(t,o.default.EMPTY_OBJECT)).polygonHierarchy,i=Object(o.default)(t.vertexFormat,$.default.DEFAULT);this._vertexFormat=$.default.clone(i),this._polygonHierarchy=e,this._stRotation=Object(o.default)(t.stRotation,0),this._ellipsoid=mi.default.clone(Object(o.default)(t.ellipsoid,mi.default.WGS84)),this._workerName="createCoplanarPolygonGeometry",this.packedLength=Gn.default.computeHierarchyPackedLength(e)+$.default.packedLength+mi.default.packedLength+2}ro.fromPositions=function(t){return new ro({polygonHierarchy:{positions:(t=Object(o.default)(t,o.default.EMPTY_OBJECT)).positions},vertexFormat:t.vertexFormat,stRotation:t.stRotation,ellipsoid:t.ellipsoid})},ro.pack=function(t,e,i){return i=Object(o.default)(i,0),i=Gn.default.packPolygonHierarchy(t._polygonHierarchy,e,i),mi.default.pack(t._ellipsoid,e,i),i+=mi.default.packedLength,$.default.pack(t._vertexFormat,e,i),i+=$.default.packedLength,e[i++]=t._stRotation,e[i]=t.packedLength,e};var no=mi.default.clone(mi.default.UNIT_SPHERE),oo=new $.default,lo={polygonHierarchy:{}};ro.unpack=function(t,e,i){e=Object(o.default)(e,0);var a=Gn.default.unpackPolygonHierarchy(t,e);e=a.startingIndex,delete a.startingIndex;var r=mi.default.unpack(t,e,no);e+=mi.default.packedLength;var n=$.default.unpack(t,e,oo);e+=$.default.packedLength;var s=t[e++],u=t[e];return Object(l.default)(i)||(i=new ro(lo)),i._polygonHierarchy=a,i._ellipsoid=mi.default.clone(r,i._ellipsoid),i._vertexFormat=$.default.clone(n,i._vertexFormat),i._stRotation=s,i.packedLength=u,i},ro.createGeometry=function(t){var e=t._vertexFormat,i=t._polygonHierarchy,a=t._stRotation,n=i.positions;if(!((n=Object(te.a)(n,_.default.equalsEpsilon,!0)).length<3)){var o=qn,l=Xn,s=Zn,u=Kn,d=Qn;if(Bn.computeProjectTo2DArguments(n,Jn,u,d)){if(o=_.default.cross(u,d,o),o=_.default.normalize(o,o),!_.default.equalsEpsilon(Jn,_.default.ZERO,Ut.default.EPSILON6)){var f=t._ellipsoid.geodeticSurfaceNormal(Jn,io);_.default.dot(o,f)<0&&(o=_.default.negate(o,o),u=_.default.negate(u,u))}var c=Bn.createProjectPointsTo2DFunction(Jn,u,d),h=Bn.createProjectPointTo2DFunction(Jn,u,d);e.tangent&&(l=_.default.clone(u,l)),e.bitangent&&(s=_.default.clone(d,s));var p=Gn.default.polygonsFromHierarchy(i,c,!1),m=p.hierarchy,g=p.polygons;if(0!==m.length){n=m[0].outerRing;for(var y=r.default.fromPoints(n),v=Gn.default.computeBoundingRectangle(o,h,n,a,zn),b=[],O=0;O<g.length;O++){var w=new ct.a({geometry:ao(g[O],e,v,a,h,o,l,s)});b.push(w)}var A=ir.a.combineInstances(b)[0];A.attributes.position.values=new Float64Array(A.attributes.position.values),A.indices=_i.a.createTypedArray(A.attributes.position.values.length/3,A.indices);var P=A.attributes;return e.position||delete P.position,new gi.a({attributes:P,indices:A.indices,primitiveType:A.primitiveType,boundingSphere:y})}}}};var so=ro;function uo(t){for(var e=t.length,i=new Float64Array(3*e),a=_i.a.createTypedArray(e,2*e),r=0,n=0,o=0;o<e;o++){var l=t[o];i[r++]=l.x,i[r++]=l.y,i[r++]=l.z,a[n++]=o,a[n++]=(o+1)%e}var s=new vi.a({position:new yi.a({componentDatatype:ut.a.DOUBLE,componentsPerAttribute:3,values:i})});return new gi.a({attributes:s,indices:a,primitiveType:Oi.a.LINES})}function fo(t){var e=(t=Object(o.default)(t,o.default.EMPTY_OBJECT)).polygonHierarchy;this._polygonHierarchy=e,this._workerName="createCoplanarPolygonOutlineGeometry",this.packedLength=Gn.default.computeHierarchyPackedLength(e)+1}fo.fromPositions=function(t){return new fo({polygonHierarchy:{positions:(t=Object(o.default)(t,o.default.EMPTY_OBJECT)).positions}})},fo.pack=function(t,e,i){return i=Object(o.default)(i,0),e[i=Gn.default.packPolygonHierarchy(t._polygonHierarchy,e,i)]=t.packedLength,e};var co={polygonHierarchy:{}};fo.unpack=function(t,e,i){e=Object(o.default)(e,0);var a=Gn.default.unpackPolygonHierarchy(t,e);e=a.startingIndex,delete a.startingIndex;var r=t[e];return Object(l.default)(i)||(i=new fo(co)),i._polygonHierarchy=a,i.packedLength=r,i},fo.createGeometry=function(t){var e=t._polygonHierarchy,i=e.positions;if(!((i=Object(te.a)(i,_.default.equalsEpsilon,!0)).length<3)&&Bn.validOutline(i)){var a=Gn.default.polygonOutlinesFromHierarchy(e,!1);if(0!==a.length){for(var n=[],o=0;o<a.length;o++){var l=new ct.a({geometry:uo(a[o])});n.push(l)}var s=ir.a.combineInstances(n)[0],u=r.default.fromPoints(e.positions);return new gi.a({attributes:s.attributes,indices:s.indices,primitiveType:s.primitiveType,boundingSphere:u})}}};var ho=fo,po=i(243),mo=i(202),go=new Ft.default,yo=new Ft.default;function vo(t,e,i,a){var r=a.cartesianToCartographic(t,go).height,n=a.cartesianToCartographic(e,yo);n.height=r,a.cartographicToCartesian(n,e);var o=a.cartesianToCartographic(i,yo);o.height=r-100,a.cartographicToCartesian(o,i)}var _o=new y.default,bo=new _.default,Oo=new _.default,wo=new _.default,Ao=new _.default,Po=new _.default,Eo=new _.default,Co=new _.default,jo=new _.default,Do=new _.default,xo=new v.default,To=new v.default,Io=new _.default,Mo=new le.default,Vo=new ie.default,No=new ie.default;function So(t){var e=t.vertexFormat,i=t.geometry,a=t.shadowVolume,r=i.attributes.position.values,n=r.length,o=t.wall,s=t.top||o,u=t.bottom||o;if(e.st||e.normal||e.tangent||e.bitangent||a){var d=t.boundingRectangle,f=t.tangentPlane,c=t.ellipsoid,h=t.stRotation,p=t.perPositionHeight,m=xo;m.x=d.x,m.y=d.y;var g,y=e.st?new Float32Array(n/3*2):void 0;e.normal&&(g=p&&s&&!o?i.attributes.normal.values:new Float32Array(n));var b=e.tangent?new Float32Array(n):void 0,O=e.bitangent?new Float32Array(n):void 0,w=a?new Float32Array(n):void 0,A=0,P=0,E=Oo,C=wo,j=Ao,D=!0,x=Vo,T=No;if(0!==h){var I=le.default.fromAxisAngle(f._plane.normal,h,Mo);x=ie.default.fromQuaternion(I,x),I=le.default.fromAxisAngle(f._plane.normal,-h,Mo),T=ie.default.fromQuaternion(I,T)}else x=ie.default.clone(ie.default.IDENTITY,x),T=ie.default.clone(ie.default.IDENTITY,T);var M=0,V=0;s&&u&&(M=n/2,V=n/3,n/=2);for(var N=0;N<n;N+=3){var S=_.default.fromArray(r,N,Io);if(e.st){var L=ie.default.multiplyByVector(x,S,bo);L=c.scaleToGeodeticSurface(L,L);var F=f.projectPointOntoPlane(L,To);v.default.subtract(F,m,F);var U=Ut.default.clamp(F.x/d.width,0,1),R=Ut.default.clamp(F.y/d.height,0,1);u&&(y[A+V]=U,y[A+1+V]=R),s&&(y[A]=U,y[A+1]=R),A+=2}if(e.normal||e.tangent||e.bitangent||a){var H=P+1,B=P+2;if(o){if(N+3<n){var G=_.default.fromArray(r,N+3,Po);if(D){var k=_.default.fromArray(r,N+n,Eo);p&&vo(S,G,k,c),_.default.subtract(G,S,G),_.default.subtract(k,S,k),E=_.default.normalize(_.default.cross(k,G,E),E),D=!1}_.default.equalsEpsilon(G,S,Ut.default.EPSILON10)&&(D=!0)}(e.tangent||e.bitangent)&&(j=c.geodeticSurfaceNormal(S,j),e.tangent&&(C=_.default.normalize(_.default.cross(j,E,C),C)))}else E=c.geodeticSurfaceNormal(S,E),(e.tangent||e.bitangent)&&(p&&(Co=_.default.fromArray(g,P,Co),jo=_.default.cross(_.default.UNIT_Z,Co,jo),jo=_.default.normalize(ie.default.multiplyByVector(T,jo,jo),jo),e.bitangent&&(Do=_.default.normalize(_.default.cross(Co,jo,Do),Do))),C=_.default.cross(_.default.UNIT_Z,E,C),C=_.default.normalize(ie.default.multiplyByVector(T,C,C),C),e.bitangent&&(j=_.default.normalize(_.default.cross(E,C,j),j)));e.normal&&(t.wall?(g[P+M]=E.x,g[H+M]=E.y,g[B+M]=E.z):u&&(g[P+M]=-E.x,g[H+M]=-E.y,g[B+M]=-E.z),(s&&!p||o)&&(g[P]=E.x,g[H]=E.y,g[B]=E.z)),a&&(o&&(E=c.geodeticSurfaceNormal(S,E)),w[P+M]=-E.x,w[H+M]=-E.y,w[B+M]=-E.z),e.tangent&&(t.wall?(b[P+M]=C.x,b[H+M]=C.y,b[B+M]=C.z):u&&(b[P+M]=-C.x,b[H+M]=-C.y,b[B+M]=-C.z),s&&(p?(b[P]=jo.x,b[H]=jo.y,b[B]=jo.z):(b[P]=C.x,b[H]=C.y,b[B]=C.z))),e.bitangent&&(u&&(O[P+M]=j.x,O[H+M]=j.y,O[B+M]=j.z),s&&(p?(O[P]=Do.x,O[H]=Do.y,O[B]=Do.z):(O[P]=j.x,O[H]=j.y,O[B]=j.z))),P+=3}}e.st&&(i.attributes.st=new yi.a({componentDatatype:ut.a.FLOAT,componentsPerAttribute:2,values:y})),e.normal&&(i.attributes.normal=new yi.a({componentDatatype:ut.a.FLOAT,componentsPerAttribute:3,values:g})),e.tangent&&(i.attributes.tangent=new yi.a({componentDatatype:ut.a.FLOAT,componentsPerAttribute:3,values:b})),e.bitangent&&(i.attributes.bitangent=new yi.a({componentDatatype:ut.a.FLOAT,componentsPerAttribute:3,values:O})),a&&(i.attributes.extrudeDirection=new yi.a({componentDatatype:ut.a.FLOAT,componentsPerAttribute:3,values:w}))}if(t.extrude&&Object(l.default)(t.offsetAttribute)){var z=r.length/3,W=new Uint8Array(z);if(t.offsetAttribute===ht.a.TOP)s&&u||o?W=Object($t.a)(W,1,0,z/2):s&&(W=Object($t.a)(W,1));else{var Y=t.offsetAttribute===ht.a.NONE?0:1;W=Object($t.a)(W,Y)}i.attributes.applyOffset=new yi.a({componentDatatype:ut.a.UNSIGNED_BYTE,componentsPerAttribute:1,values:W})}return i}var Lo=new Ft.default,Fo=new Ft.default,Uo={westOverIDL:0,eastOverIDL:0},Ro=new po.default;function Ho(t,e,i,a,r){if(r=Object(o.default)(r,new wi.default),!Object(l.default)(t)||t.length<3)return r.west=0,r.north=0,r.south=0,r.east=0,r;if(i===Mn.a.RHUMB)return wi.default.fromCartesianArray(t,e,r);Ro.ellipsoid.equals(e)||(Ro=new po.default(void 0,void 0,e)),r.west=Number.POSITIVE_INFINITY,r.east=Number.NEGATIVE_INFINITY,r.south=Number.POSITIVE_INFINITY,r.north=Number.NEGATIVE_INFINITY,Uo.westOverIDL=Number.POSITIVE_INFINITY,Uo.eastOverIDL=Number.NEGATIVE_INFINITY;for(var n,s=1/Ut.default.chordLength(a,e.maximumRadius),u=t.length,d=e.cartesianToCartographic(t[0],Fo),f=Lo,c=1;c<u;c++)n=f,f=d,d=e.cartesianToCartographic(t[c],n),Ro.setEndPoints(f,d),Go(Ro,s,r,Uo);return n=f,f=d,d=e.cartesianToCartographic(t[0],n),Ro.setEndPoints(f,d),Go(Ro,s,r,Uo),r.east-r.west>Uo.eastOverIDL-Uo.westOverIDL&&(r.west=Uo.westOverIDL,r.east=Uo.eastOverIDL,r.east>Ut.default.PI&&(r.east=r.east-Ut.default.TWO_PI),r.west>Ut.default.PI&&(r.west=r.west-Ut.default.TWO_PI)),r}var Bo=new Ft.default;function Go(t,e,i,a){for(var r=t.surfaceDistance,n=Math.ceil(r*e),o=n>0?r/(n-1):Number.POSITIVE_INFINITY,l=0,s=0;s<n;s++){var u=t.interpolateUsingSurfaceDistance(l,Bo);l+=o;var d=u.longitude,f=u.latitude;i.west=Math.min(i.west,d),i.east=Math.max(i.east,d),i.south=Math.min(i.south,f),i.north=Math.max(i.north,f);var c=d>=0?d:d+Ut.default.TWO_PI;a.westOverIDL=Math.min(a.westOverIDL,c),a.eastOverIDL=Math.max(a.eastOverIDL,c)}}var ko=[];function zo(t,e,i,a,r,n,o,l,s){var u,d={walls:[]};if(n||o){var f,c,h=Gn.default.createGeometryFromPositions(t,e,i,r,l,s),p=h.attributes.position.values,m=h.indices;if(n&&o){var g=p.concat(p);f=g.length/3,(c=_i.a.createTypedArray(f,2*m.length)).set(m);var y=m.length,v=f/2;for(u=0;u<y;u+=3){var _=c[u]+v,b=c[u+1]+v,O=c[u+2]+v;c[u+y]=O,c[u+1+y]=b,c[u+2+y]=_}if(h.attributes.position.values=g,r&&l.normal){var w=h.attributes.normal.values;h.attributes.normal.values=new Float32Array(g.length),h.attributes.normal.values.set(w)}h.indices=c}else if(o){for(f=p.length/3,c=_i.a.createTypedArray(f,m.length),u=0;u<m.length;u+=3)c[u]=m[u+2],c[u+1]=m[u+1],c[u+2]=m[u];h.indices=c}d.topAndBottom=new ct.a({geometry:h})}var A=a.outerRing,P=ne.default.fromPoints(A,t),E=P.projectPointsOntoPlane(A,ko),C=bi.a.computeWindingOrder2D(E);C===mo.default.CLOCKWISE&&(A=A.slice().reverse());var j=Gn.default.computeWallGeometry(A,t,i,r,s);d.walls.push(new ct.a({geometry:j}));var D=a.holes;for(u=0;u<D.length;u++){var x=D[u];E=(P=ne.default.fromPoints(x,t)).projectPointsOntoPlane(x,ko),(C=bi.a.computeWindingOrder2D(E))===mo.default.COUNTER_CLOCKWISE&&(x=x.slice().reverse()),j=Gn.default.computeWallGeometry(x,t,i,r,s),d.walls.push(new ct.a({geometry:j}))}return d}function Wo(t){var e=t.polygonHierarchy,i=Object(o.default)(t.vertexFormat,$.default.DEFAULT),a=Object(o.default)(t.ellipsoid,mi.default.WGS84),r=Object(o.default)(t.granularity,Ut.default.RADIANS_PER_DEGREE),n=Object(o.default)(t.stRotation,0),s=Object(o.default)(t.perPositionHeight,!1),u=s&&Object(l.default)(t.extrudedHeight),d=Object(o.default)(t.height,0),f=Object(o.default)(t.extrudedHeight,d);if(!u){var c=Math.max(d,f);f=Math.min(d,f),d=c}this._vertexFormat=$.default.clone(i),this._ellipsoid=mi.default.clone(a),this._granularity=r,this._stRotation=n,this._height=d,this._extrudedHeight=f,this._closeTop=Object(o.default)(t.closeTop,!0),this._closeBottom=Object(o.default)(t.closeBottom,!0),this._polygonHierarchy=e,this._perPositionHeight=s,this._perPositionHeightExtrude=u,this._shadowVolume=Object(o.default)(t.shadowVolume,!1),this._workerName="createPolygonGeometry",this._offsetAttribute=t.offsetAttribute,this._arcType=Object(o.default)(t.arcType,Mn.a.GEODESIC),this._rectangle=void 0,this._textureCoordinateRotationPoints=void 0,this.packedLength=Gn.default.computeHierarchyPackedLength(e)+mi.default.packedLength+$.default.packedLength+12}Wo.fromPositions=function(t){return new Wo({polygonHierarchy:{positions:(t=Object(o.default)(t,o.default.EMPTY_OBJECT)).positions},height:t.height,extrudedHeight:t.extrudedHeight,vertexFormat:t.vertexFormat,stRotation:t.stRotation,ellipsoid:t.ellipsoid,granularity:t.granularity,perPositionHeight:t.perPositionHeight,closeTop:t.closeTop,closeBottom:t.closeBottom,offsetAttribute:t.offsetAttribute,arcType:t.arcType})},Wo.pack=function(t,e,i){return i=Object(o.default)(i,0),i=Gn.default.packPolygonHierarchy(t._polygonHierarchy,e,i),mi.default.pack(t._ellipsoid,e,i),i+=mi.default.packedLength,$.default.pack(t._vertexFormat,e,i),i+=$.default.packedLength,e[i++]=t._height,e[i++]=t._extrudedHeight,e[i++]=t._granularity,e[i++]=t._stRotation,e[i++]=t._perPositionHeightExtrude?1:0,e[i++]=t._perPositionHeight?1:0,e[i++]=t._closeTop?1:0,e[i++]=t._closeBottom?1:0,e[i++]=t._shadowVolume?1:0,e[i++]=Object(o.default)(t._offsetAttribute,-1),e[i++]=t._arcType,e[i]=t.packedLength,e};var Yo=mi.default.clone(mi.default.UNIT_SPHERE),qo=new $.default,Xo={polygonHierarchy:{}};Wo.unpack=function(t,e,i){e=Object(o.default)(e,0);var a=Gn.default.unpackPolygonHierarchy(t,e);e=a.startingIndex,delete a.startingIndex;var r=mi.default.unpack(t,e,Yo);e+=mi.default.packedLength;var n=$.default.unpack(t,e,qo);e+=$.default.packedLength;var s=t[e++],u=t[e++],d=t[e++],f=t[e++],c=1===t[e++],h=1===t[e++],p=1===t[e++],m=1===t[e++],g=1===t[e++],y=t[e++],v=t[e++],_=t[e];return Object(l.default)(i)||(i=new Wo(Xo)),i._polygonHierarchy=a,i._ellipsoid=mi.default.clone(r,i._ellipsoid),i._vertexFormat=$.default.clone(n,i._vertexFormat),i._height=s,i._extrudedHeight=u,i._granularity=d,i._stRotation=f,i._perPositionHeightExtrude=c,i._perPositionHeight=h,i._closeTop=p,i._closeBottom=m,i._shadowVolume=g,i._offsetAttribute=-1===y?void 0:y,i._arcType=v,i.packedLength=_,i},Wo.computeRectangle=function(t,e){var i=Object(o.default)(t.granularity,Ut.default.RADIANS_PER_DEGREE),a=Object(o.default)(t.arcType,Mn.a.GEODESIC),r=t.polygonHierarchy,n=Object(o.default)(t.ellipsoid,mi.default.WGS84);return Ho(r.positions,n,a,i,e)},Wo.createGeometry=function(t){var e=t._vertexFormat,i=t._ellipsoid,a=t._granularity,n=t._stRotation,o=t._polygonHierarchy,s=t._perPositionHeight,u=t._closeTop,d=t._closeBottom,f=t._arcType,c=o.positions;if(!(c.length<3)){var h=ne.default.fromPoints(c,i),p=Gn.default.polygonsFromHierarchy(o,h.projectPointsOntoPlane.bind(h),!s,i),m=p.hierarchy,g=p.polygons;if(0!==m.length){c=m[0].outerRing;var y,v=Gn.default.computeBoundingRectangle(h.plane.normal,h.projectPointOntoPlane.bind(h),c,n,_o),_=[],b=t._height,O=t._extrudedHeight,w={perPositionHeight:s,vertexFormat:e,geometry:void 0,tangentPlane:h,boundingRectangle:v,ellipsoid:i,stRotation:n,bottom:!1,top:!0,wall:!1,extrude:!1,arcType:f};if(t._perPositionHeightExtrude||!Ut.default.equalsEpsilon(b,O,0,Ut.default.EPSILON2))for(w.extrude=!0,w.top=u,w.bottom=d,w.shadowVolume=t._shadowVolume,w.offsetAttribute=t._offsetAttribute,y=0;y<g.length;y++){var A,P=zo(i,g[y],a,m[y],s,u,d,e,f);u&&d?(A=P.topAndBottom,w.geometry=Gn.default.scaleToGeodeticHeightExtruded(A.geometry,b,O,i,s)):u?((A=P.topAndBottom).geometry.attributes.position.values=bi.a.scaleToGeodeticHeight(A.geometry.attributes.position.values,b,i,!s),w.geometry=A.geometry):d&&((A=P.topAndBottom).geometry.attributes.position.values=bi.a.scaleToGeodeticHeight(A.geometry.attributes.position.values,O,i,!0),w.geometry=A.geometry),(u||d)&&(w.wall=!1,A.geometry=So(w),_.push(A));var E=P.walls;w.wall=!0;for(var C=0;C<E.length;C++){var j=E[C];w.geometry=Gn.default.scaleToGeodeticHeightExtruded(j.geometry,b,O,i,s),j.geometry=So(w),_.push(j)}}else for(y=0;y<g.length;y++){var D=new ct.a({geometry:Gn.default.createGeometryFromPositions(i,g[y],a,s,e,f)});if(D.geometry.attributes.position.values=bi.a.scaleToGeodeticHeight(D.geometry.attributes.position.values,b,i,!s),w.geometry=D.geometry,D.geometry=So(w),Object(l.default)(t._offsetAttribute)){var x=D.geometry.attributes.position.values.length,T=new Uint8Array(x/3),I=t._offsetAttribute===ht.a.NONE?0:1;Object($t.a)(T,I),D.geometry.attributes.applyOffset=new yi.a({componentDatatype:ut.a.UNSIGNED_BYTE,componentsPerAttribute:1,values:T})}_.push(D)}var M=ir.a.combineInstances(_)[0];M.attributes.position.values=new Float64Array(M.attributes.position.values),M.indices=_i.a.createTypedArray(M.attributes.position.values.length/3,M.indices);var V=M.attributes,N=r.default.fromVertices(V.position.values);return e.position||delete V.position,new gi.a({attributes:V,indices:M.indices,primitiveType:M.primitiveType,boundingSphere:N,offsetAttribute:t._offsetAttribute})}}},Wo.createShadowVolume=function(t,e,i){var a=t._granularity,r=t._ellipsoid,n=e(a,r),o=i(a,r);return new Wo({polygonHierarchy:t._polygonHierarchy,ellipsoid:r,stRotation:t._stRotation,granularity:a,perPositionHeight:!1,extrudedHeight:n,height:o,vertexFormat:$.default.POSITION_ONLY,shadowVolume:!0,arcType:t._arcType})},Object(s.default)(Wo.prototype,{rectangle:{get:function(){if(!Object(l.default)(this._rectangle)){var t=this._polygonHierarchy.positions;this._rectangle=Ho(t,this._ellipsoid,this._arcType,this._granularity)}return this._rectangle}},textureCoordinateRotationPoints:{get:function(){return Object(l.default)(this._textureCoordinateRotationPoints)||(this._textureCoordinateRotationPoints=function(t){var e=-t._stRotation;if(0===e)return[0,0,0,1,1,0];var i=t._ellipsoid,a=t._polygonHierarchy.positions,r=t.rectangle;return gi.a._textureCoordinateRotationPoints(a,e,i,r)}(this)),this._textureCoordinateRotationPoints}}});var Zo=Wo,Jo=[],Ko=[];function Qo(t,e,i,a,r){var n,o,l=ne.default.fromPoints(e,t).projectPointsOntoPlane(e,Jo);bi.a.computeWindingOrder2D(l)===mo.default.CLOCKWISE&&(l.reverse(),e=e.slice().reverse());var s=e.length,u=0;if(a)for(n=new Float64Array(2*s*3),o=0;o<s;o++){var d=e[o],f=e[(o+1)%s];n[u++]=d.x,n[u++]=d.y,n[u++]=d.z,n[u++]=f.x,n[u++]=f.y,n[u++]=f.z}else{var c=0;if(r===Mn.a.GEODESIC)for(o=0;o<s;o++)c+=Gn.default.subdivideLineCount(e[o],e[(o+1)%s],i);else if(r===Mn.a.RHUMB)for(o=0;o<s;o++)c+=Gn.default.subdivideRhumbLineCount(t,e[o],e[(o+1)%s],i);for(n=new Float64Array(3*c),o=0;o<s;o++){var h;r===Mn.a.GEODESIC?h=Gn.default.subdivideLine(e[o],e[(o+1)%s],i,Ko):r===Mn.a.RHUMB&&(h=Gn.default.subdivideRhumbLine(t,e[o],e[(o+1)%s],i,Ko));for(var p=h.length,m=0;m<p;++m)n[u++]=h[m]}}var g=2*(s=n.length/3),y=_i.a.createTypedArray(s,g);for(u=0,o=0;o<s-1;o++)y[u++]=o,y[u++]=o+1;return y[u++]=s-1,y[u++]=0,new ct.a({geometry:new gi.a({attributes:new vi.a({position:new yi.a({componentDatatype:ut.a.DOUBLE,componentsPerAttribute:3,values:n})}),indices:y,primitiveType:Oi.a.LINES})})}function $o(t,e,i,a,r){var n,o,l=ne.default.fromPoints(e,t).projectPointsOntoPlane(e,Jo);bi.a.computeWindingOrder2D(l)===mo.default.CLOCKWISE&&(l.reverse(),e=e.slice().reverse());var s=e.length,u=new Array(s),d=0;if(a)for(n=new Float64Array(2*s*3*2),o=0;o<s;++o){u[o]=d/3;var f=e[o],c=e[(o+1)%s];n[d++]=f.x,n[d++]=f.y,n[d++]=f.z,n[d++]=c.x,n[d++]=c.y,n[d++]=c.z}else{var h=0;if(r===Mn.a.GEODESIC)for(o=0;o<s;o++)h+=Gn.default.subdivideLineCount(e[o],e[(o+1)%s],i);else if(r===Mn.a.RHUMB)for(o=0;o<s;o++)h+=Gn.default.subdivideRhumbLineCount(t,e[o],e[(o+1)%s],i);for(n=new Float64Array(3*h*2),o=0;o<s;++o){var p;u[o]=d/3,r===Mn.a.GEODESIC?p=Gn.default.subdivideLine(e[o],e[(o+1)%s],i,Ko):r===Mn.a.RHUMB&&(p=Gn.default.subdivideRhumbLine(t,e[o],e[(o+1)%s],i,Ko));for(var m=p.length,g=0;g<m;++g)n[d++]=p[g]}}s=n.length/6;var y=u.length,v=2*(2*s+y),_=_i.a.createTypedArray(s+y,v);for(d=0,o=0;o<s;++o)_[d++]=o,_[d++]=(o+1)%s,_[d++]=o+s,_[d++]=(o+1)%s+s;for(o=0;o<y;o++){var b=u[o];_[d++]=b,_[d++]=b+s}return new ct.a({geometry:new gi.a({attributes:new vi.a({position:new yi.a({componentDatatype:ut.a.DOUBLE,componentsPerAttribute:3,values:n})}),indices:_,primitiveType:Oi.a.LINES})})}function tl(t){var e=t.polygonHierarchy,i=Object(o.default)(t.ellipsoid,mi.default.WGS84),a=Object(o.default)(t.granularity,Ut.default.RADIANS_PER_DEGREE),r=Object(o.default)(t.perPositionHeight,!1),n=r&&Object(l.default)(t.extrudedHeight),s=Object(o.default)(t.arcType,Mn.a.GEODESIC),u=Object(o.default)(t.height,0),d=Object(o.default)(t.extrudedHeight,u);if(!n){var f=Math.max(u,d);d=Math.min(u,d),u=f}this._ellipsoid=mi.default.clone(i),this._granularity=a,this._height=u,this._extrudedHeight=d,this._arcType=s,this._polygonHierarchy=e,this._perPositionHeight=r,this._perPositionHeightExtrude=n,this._offsetAttribute=t.offsetAttribute,this._workerName="createPolygonOutlineGeometry",this.packedLength=Gn.default.computeHierarchyPackedLength(e)+mi.default.packedLength+8}tl.pack=function(t,e,i){return i=Object(o.default)(i,0),i=Gn.default.packPolygonHierarchy(t._polygonHierarchy,e,i),mi.default.pack(t._ellipsoid,e,i),i+=mi.default.packedLength,e[i++]=t._height,e[i++]=t._extrudedHeight,e[i++]=t._granularity,e[i++]=t._perPositionHeightExtrude?1:0,e[i++]=t._perPositionHeight?1:0,e[i++]=t._arcType,e[i++]=Object(o.default)(t._offsetAttribute,-1),e[i]=t.packedLength,e};var el=mi.default.clone(mi.default.UNIT_SPHERE),il={polygonHierarchy:{}};tl.unpack=function(t,e,i){e=Object(o.default)(e,0);var a=Gn.default.unpackPolygonHierarchy(t,e);e=a.startingIndex,delete a.startingIndex;var r=mi.default.unpack(t,e,el);e+=mi.default.packedLength;var n=t[e++],s=t[e++],u=t[e++],d=1===t[e++],f=1===t[e++],c=t[e++],h=t[e++],p=t[e];return Object(l.default)(i)||(i=new tl(il)),i._polygonHierarchy=a,i._ellipsoid=mi.default.clone(r,i._ellipsoid),i._height=n,i._extrudedHeight=s,i._granularity=u,i._perPositionHeight=f,i._perPositionHeightExtrude=d,i._arcType=c,i._offsetAttribute=-1===h?void 0:h,i.packedLength=p,i},tl.fromPositions=function(t){return new tl({polygonHierarchy:{positions:(t=Object(o.default)(t,o.default.EMPTY_OBJECT)).positions},height:t.height,extrudedHeight:t.extrudedHeight,ellipsoid:t.ellipsoid,granularity:t.granularity,perPositionHeight:t.perPositionHeight,arcType:t.arcType,offsetAttribute:t.offsetAttribute})},tl.createGeometry=function(t){var e=t._ellipsoid,i=t._granularity,a=t._polygonHierarchy,n=t._perPositionHeight,o=t._arcType,s=Gn.default.polygonOutlinesFromHierarchy(a,!n,e);if(0!==s.length){var u,d,f,c=[],h=Ut.default.chordLength(i,e.maximumRadius),p=t._height,m=t._extrudedHeight;if(t._perPositionHeightExtrude||!Ut.default.equalsEpsilon(p,m,0,Ut.default.EPSILON2))for(f=0;f<s.length;f++){if((u=$o(e,s[f],h,n,o)).geometry=Gn.default.scaleToGeodeticHeightExtruded(u.geometry,p,m,e,n),Object(l.default)(t._offsetAttribute)){var g=u.geometry.attributes.position.values.length/3,y=new Uint8Array(g);t._offsetAttribute===ht.a.TOP?y=Object($t.a)(y,1,0,g/2):(d=t._offsetAttribute===ht.a.NONE?0:1,y=Object($t.a)(y,d)),u.geometry.attributes.applyOffset=new yi.a({componentDatatype:ut.a.UNSIGNED_BYTE,componentsPerAttribute:1,values:y})}c.push(u)}else for(f=0;f<s.length;f++){if((u=Qo(e,s[f],h,n,o)).geometry.attributes.position.values=bi.a.scaleToGeodeticHeight(u.geometry.attributes.position.values,p,e,!n),Object(l.default)(t._offsetAttribute)){var v=u.geometry.attributes.position.values.length,_=new Uint8Array(v/3);d=t._offsetAttribute===ht.a.NONE?0:1,Object($t.a)(_,d),u.geometry.attributes.applyOffset=new yi.a({componentDatatype:ut.a.UNSIGNED_BYTE,componentsPerAttribute:1,values:_})}c.push(u)}var b=ir.a.combineInstances(c)[0],O=r.default.fromVertices(b.attributes.position.values);return new gi.a({attributes:b.attributes,indices:b.indices,primitiveType:b.primitiveType,boundingSphere:O,offsetAttribute:t._offsetAttribute})}};var al=tl,rl=new b.default,nl=_.default.ZERO,ol=new _.default,ll=new wi.default,sl=[],ul=new v.default;function dl(t){this.id=t,this.vertexFormat=void 0,this.polygonHierarchy=void 0,this.perPositionHeight=void 0,this.closeTop=void 0,this.closeBottom=void 0,this.height=void 0,this.extrudedHeight=void 0,this.granularity=void 0,this.stRotation=void 0,this.offsetAttribute=void 0,this.arcType=void 0}function fl(t,e){oa.call(this,{entity:t,scene:e,geometryOptions:new dl(t),geometryPropertyName:"polygon",observedPropertyNames:["availability","polygon"]}),this._onEntityPropertyChanged(t,"polygon",t.polygon,void 0)}function cl(t,e,i){wt.call(this,t,e,i)}Object(l.default)(Object.create)&&(fl.prototype=Object.create(oa.prototype),fl.prototype.constructor=fl),fl.prototype.createFillGeometryInstance=function(t){var e,i,a=this._entity,r=a.isAvailable(t),n=this._options,o={show:new gt.a(r&&a.isShowing&&this._showProperty.getValue(t)&&this._fillProperty.getValue(t)),distanceDisplayCondition:ft.fromDistanceDisplayCondition(this._distanceDisplayConditionProperty.getValue(t)),offset:void 0,color:void 0};this._materialProperty instanceof yt.default&&(Object(l.default)(this._materialProperty.color)&&(this._materialProperty.color.isConstant||r)&&(e=this._materialProperty.color.getValue(t,rl)),Object(l.default)(e)||(e=b.default.WHITE),o.color=st.a.fromColor(e));return Object(l.default)(n.offsetAttribute)&&(o.offset=mt.a.fromCartesian3(D.default.getValueOrDefault(this._terrainOffsetProperty,t,nl,ol))),i=n.perPositionHeight&&!Object(l.default)(n.extrudedHeight)?new so(n):new Zo(n),new ct.a({id:a,geometry:i,attributes:o})},fl.prototype.createOutlineGeometryInstance=function(t){var e,i=this._entity,a=i.isAvailable(t),r=this._options,n=D.default.getValueOrDefault(this._outlineColorProperty,t,b.default.BLACK,rl),o=this._distanceDisplayConditionProperty.getValue(t),s={show:new gt.a(a&&i.isShowing&&this._showProperty.getValue(t)&&this._showOutlineProperty.getValue(t)),color:st.a.fromColor(n),distanceDisplayCondition:ft.fromDistanceDisplayCondition(o),offset:void 0};return Object(l.default)(r.offsetAttribute)&&(s.offset=mt.a.fromCartesian3(D.default.getValueOrDefault(this._terrainOffsetProperty,t,nl,ol))),e=r.perPositionHeight&&!Object(l.default)(r.extrudedHeight)?new ho(r):new al(r),new ct.a({id:i,geometry:e,attributes:s})},fl.prototype._computeCenter=function(t,e){var i=D.default.getValueOrUndefined(this._entity.polygon.hierarchy,t);if(Object(l.default)(i)){var a=i.positions;if(0!==a.length){for(var r=this._scene.mapProjection.ellipsoid,n=ne.default.fromPoints(a,r),o=n.projectPointsOntoPlane(a,sl),s=o.length,u=0,d=s-1,f=new v.default,c=0;c<s;d=c++){var h=o[c],p=o[d],m=h.x*p.y-p.x*h.y,g=v.default.add(h,p,ul);g=v.default.multiplyByScalar(g,m,g),f=v.default.add(f,g,f),u+=m}var y=1/(3*u);return f=v.default.multiplyByScalar(f,y,f),n.projectPointOntoEllipsoid(f,e)}}},fl.prototype._isHidden=function(t,e){return!Object(l.default)(e.hierarchy)||St.prototype._isHidden.call(this,t,e)},fl.prototype._isOnTerrain=function(t,e){var i=oa.prototype._isOnTerrain.call(this,t,e),a=e.perPositionHeight,r=Object(l.default)(a)&&(!a.isConstant||a.getValue(pt.default.MINIMUM_VALUE));return i&&!r},fl.prototype._isDynamic=function(t,e){return!e.hierarchy.isConstant||!D.default.isConstant(e.height)||!D.default.isConstant(e.extrudedHeight)||!D.default.isConstant(e.granularity)||!D.default.isConstant(e.stRotation)||!D.default.isConstant(e.outlineWidth)||!D.default.isConstant(e.perPositionHeight)||!D.default.isConstant(e.closeTop)||!D.default.isConstant(e.closeBottom)||!D.default.isConstant(e.zIndex)||!D.default.isConstant(e.arcType)||this._onTerrain&&!D.default.isConstant(this._materialProperty)},fl.prototype._setStaticOptions=function(t,e){var i=this._materialProperty instanceof yt.default,r=this._options;r.vertexFormat=i?rt.a.VERTEX_FORMAT:at.MaterialSupport.TEXTURED.vertexFormat;var n,o=e.hierarchy.getValue(pt.default.MINIMUM_VALUE),s=D.default.getValueOrUndefined(e.height,pt.default.MINIMUM_VALUE),u=D.default.getValueOrDefault(e.heightReference,pt.default.MINIMUM_VALUE,P.default.NONE),d=D.default.getValueOrUndefined(e.extrudedHeight,pt.default.MINIMUM_VALUE),f=D.default.getValueOrDefault(e.extrudedHeightReference,pt.default.MINIMUM_VALUE,P.default.NONE),c=D.default.getValueOrDefault(e.perPositionHeight,pt.default.MINIMUM_VALUE,!1);s=oa.getGeometryHeight(s,u),c?(Object(l.default)(s)&&(s=void 0,Object(At.a)("Entity polygons cannot have both height and perPositionHeight.  height will be ignored")),u!==P.default.NONE&&c&&(s=void 0,Object(At.a)("heightReference is not supported for entity polygons with perPositionHeight. heightReference will be ignored"))):(Object(l.default)(d)&&!Object(l.default)(s)&&(s=0),n=oa.computeGeometryOffsetAttribute(s,u,d,f)),r.polygonHierarchy=o,r.granularity=D.default.getValueOrUndefined(e.granularity,pt.default.MINIMUM_VALUE),r.stRotation=D.default.getValueOrUndefined(e.stRotation,pt.default.MINIMUM_VALUE),r.perPositionHeight=c,r.closeTop=D.default.getValueOrDefault(e.closeTop,pt.default.MINIMUM_VALUE,!0),r.closeBottom=D.default.getValueOrDefault(e.closeBottom,pt.default.MINIMUM_VALUE,!0),r.offsetAttribute=n,r.height=s,r.arcType=D.default.getValueOrDefault(e.arcType,pt.default.MINIMUM_VALUE,Mn.a.GEODESIC),(d=oa.getGeometryExtrudedHeight(d,f))===oa.CLAMP_TO_GROUND&&(d=a.a.getMinimumMaximumHeights(Zo.computeRectangle(r,ll)).minimumTerrainHeight),r.extrudedHeight=d},fl.prototype._getIsClosed=function(t){var e=t.height,i=t.extrudedHeight,a=Object(l.default)(i)&&i!==e;return!t.perPositionHeight&&(!a&&0===e||a&&t.closeTop&&t.closeBottom)},fl.DynamicGeometryUpdater=cl,Object(l.default)(Object.create)&&(cl.prototype=Object.create(wt.prototype),cl.prototype.constructor=cl),cl.prototype._isHidden=function(t,e,i){return!Object(l.default)(this._options.polygonHierarchy)||wt.prototype._isHidden.call(this,t,e,i)},cl.prototype._setOptions=function(t,e,i){var r=this._options;r.polygonHierarchy=D.default.getValueOrUndefined(e.hierarchy,i);var n,o=D.default.getValueOrUndefined(e.height,i),s=D.default.getValueOrDefault(e.heightReference,i,P.default.NONE),u=D.default.getValueOrDefault(e.extrudedHeightReference,i,P.default.NONE),d=D.default.getValueOrUndefined(e.extrudedHeight,i),f=D.default.getValueOrUndefined(e.perPositionHeight,i);o=oa.getGeometryHeight(o,u),f?(Object(l.default)(o)&&(o=void 0,Object(At.a)("Entity polygons cannot have both height and perPositionHeight.  height will be ignored")),s!==P.default.NONE&&f&&(o=void 0,Object(At.a)("heightReference is not supported for entity polygons with perPositionHeight. heightReference will be ignored"))):(Object(l.default)(d)&&!Object(l.default)(o)&&(o=0),n=oa.computeGeometryOffsetAttribute(o,s,d,u)),r.granularity=D.default.getValueOrUndefined(e.granularity,i),r.stRotation=D.default.getValueOrUndefined(e.stRotation,i),r.perPositionHeight=D.default.getValueOrUndefined(e.perPositionHeight,i),r.closeTop=D.default.getValueOrDefault(e.closeTop,i,!0),r.closeBottom=D.default.getValueOrDefault(e.closeBottom,i,!0),r.offsetAttribute=n,r.height=o,r.arcType=D.default.getValueOrDefault(e.arcType,i,Mn.a.GEODESIC),(d=oa.getGeometryExtrudedHeight(d,u))===oa.CLAMP_TO_GROUND&&(d=a.a.getMinimumMaximumHeights(Zo.computeRectangle(r,ll)).minimumTerrainHeight),r.extrudedHeight=d};var hl=fl;function pl(t){var e=(t=Object(o.default)(t,o.default.EMPTY_OBJECT)).polylinePositions,i=t.shapePositions;this._positions=e,this._shape=i,this._ellipsoid=mi.default.clone(Object(o.default)(t.ellipsoid,mi.default.WGS84)),this._cornerType=Object(o.default)(t.cornerType,ee.a.ROUNDED),this._vertexFormat=$.default.clone(Object(o.default)(t.vertexFormat,$.default.DEFAULT)),this._granularity=Object(o.default)(t.granularity,Ut.default.RADIANS_PER_DEGREE),this._workerName="createPolylineVolumeGeometry";var a=1+e.length*_.default.packedLength;a+=1+i.length*v.default.packedLength,this.packedLength=a+mi.default.packedLength+$.default.packedLength+2}pl.pack=function(t,e,i){var a;i=Object(o.default)(i,0);var r=t._positions,n=r.length;for(e[i++]=n,a=0;a<n;++a,i+=_.default.packedLength)_.default.pack(r[a],e,i);var l=t._shape;for(n=l.length,e[i++]=n,a=0;a<n;++a,i+=v.default.packedLength)v.default.pack(l[a],e,i);return mi.default.pack(t._ellipsoid,e,i),i+=mi.default.packedLength,$.default.pack(t._vertexFormat,e,i),i+=$.default.packedLength,e[i++]=t._cornerType,e[i]=t._granularity,e};var ml=mi.default.clone(mi.default.UNIT_SPHERE),gl=new $.default,yl={polylinePositions:void 0,shapePositions:void 0,ellipsoid:ml,vertexFormat:gl,cornerType:void 0,granularity:void 0};pl.unpack=function(t,e,i){var a;e=Object(o.default)(e,0);var r=t[e++],n=new Array(r);for(a=0;a<r;++a,e+=_.default.packedLength)n[a]=_.default.unpack(t,e);r=t[e++];var s=new Array(r);for(a=0;a<r;++a,e+=v.default.packedLength)s[a]=v.default.unpack(t,e);var u=mi.default.unpack(t,e,ml);e+=mi.default.packedLength;var d=$.default.unpack(t,e,gl);e+=$.default.packedLength;var f=t[e++],c=t[e];return Object(l.default)(i)?(i._positions=n,i._shape=s,i._ellipsoid=mi.default.clone(u,i._ellipsoid),i._vertexFormat=$.default.clone(d,i._vertexFormat),i._cornerType=f,i._granularity=c,i):(yl.polylinePositions=n,yl.shapePositions=s,yl.cornerType=f,yl.granularity=c,new pl(yl))};var vl=new y.default;pl.createGeometry=function(t){var e=t._positions,i=Object(te.a)(e,_.default.equalsEpsilon),a=t._shape;if(a=ze.removeDuplicatesFromShape(a),!(i.length<2||a.length<3)){bi.a.computeWindingOrder2D(a)===mo.default.CLOCKWISE&&a.reverse();var n=y.default.fromPoints(a,vl);return function(t,e,i,a){var n=new vi.a;a.position&&(n.position=new yi.a({componentDatatype:ut.a.DOUBLE,componentsPerAttribute:3,values:t}));var o,l,s,u,d,f,c=e.length,h=t.length/3,p=(h-2*c)/(2*c),m=bi.a.triangulate(e),g=(p-1)*c*6+2*m.length,y=_i.a.createTypedArray(h,g),v=2*c,_=0;for(o=0;o<p-1;o++){for(l=0;l<c-1;l++)f=(s=2*l+o*c*2)+v,d=(u=s+1)+v,y[_++]=u,y[_++]=s,y[_++]=d,y[_++]=d,y[_++]=s,y[_++]=f;d=(u=1+(s=2*c-2+o*c*2))+v,f=s+v,y[_++]=u,y[_++]=s,y[_++]=d,y[_++]=d,y[_++]=s,y[_++]=f}if(a.st||a.tangent||a.bitangent){var b,O,w=new Float32Array(2*h),A=1/(p-1),P=1/i.height,E=i.height/2,C=0;for(o=0;o<p;o++){for(b=o*A,O=P*(e[0].y+E),w[C++]=b,w[C++]=O,l=1;l<c;l++)O=P*(e[l].y+E),w[C++]=b,w[C++]=O,w[C++]=b,w[C++]=O;O=P*(e[0].y+E),w[C++]=b,w[C++]=O}for(l=0;l<c;l++)b=0,O=P*(e[l].y+E),w[C++]=b,w[C++]=O;for(l=0;l<c;l++)b=(p-1)*A,O=P*(e[l].y+E),w[C++]=b,w[C++]=O;n.st=new yi.a({componentDatatype:ut.a.FLOAT,componentsPerAttribute:2,values:new Float32Array(w)})}var j=h-2*c;for(o=0;o<m.length;o+=3){var D=m[o]+j,x=m[o+1]+j,T=m[o+2]+j;y[_++]=D,y[_++]=x,y[_++]=T,y[_++]=T+c,y[_++]=x+c,y[_++]=D+c}var I=new gi.a({attributes:n,indices:y,boundingSphere:r.default.fromVertices(t),primitiveType:Oi.a.TRIANGLES});if(a.normal&&(I=ir.a.computeNormal(I)),a.tangent||a.bitangent){try{I=ir.a.computeTangentAndBitangent(I)}catch(t){Object(At.a)("polyline-volume-tangent-bitangent","Unable to compute tangents and bitangents for polyline volume geometry")}a.tangent||(I.attributes.tangent=void 0),a.bitangent||(I.attributes.bitangent=void 0),a.st||(I.attributes.st=void 0)}return I}(ze.computePositions(i,a,n,t,!0),a,n,t._vertexFormat)}};var _l=pl;function bl(t){var e=(t=Object(o.default)(t,o.default.EMPTY_OBJECT)).polylinePositions,i=t.shapePositions;this._positions=e,this._shape=i,this._ellipsoid=mi.default.clone(Object(o.default)(t.ellipsoid,mi.default.WGS84)),this._cornerType=Object(o.default)(t.cornerType,ee.a.ROUNDED),this._granularity=Object(o.default)(t.granularity,Ut.default.RADIANS_PER_DEGREE),this._workerName="createPolylineVolumeOutlineGeometry";var a=1+e.length*_.default.packedLength;a+=1+i.length*v.default.packedLength,this.packedLength=a+mi.default.packedLength+2}bl.pack=function(t,e,i){var a;i=Object(o.default)(i,0);var r=t._positions,n=r.length;for(e[i++]=n,a=0;a<n;++a,i+=_.default.packedLength)_.default.pack(r[a],e,i);var l=t._shape;for(n=l.length,e[i++]=n,a=0;a<n;++a,i+=v.default.packedLength)v.default.pack(l[a],e,i);return mi.default.pack(t._ellipsoid,e,i),i+=mi.default.packedLength,e[i++]=t._cornerType,e[i]=t._granularity,e};var Ol=mi.default.clone(mi.default.UNIT_SPHERE),wl={polylinePositions:void 0,shapePositions:void 0,ellipsoid:Ol,height:void 0,cornerType:void 0,granularity:void 0};bl.unpack=function(t,e,i){var a;e=Object(o.default)(e,0);var r=t[e++],n=new Array(r);for(a=0;a<r;++a,e+=_.default.packedLength)n[a]=_.default.unpack(t,e);r=t[e++];var s=new Array(r);for(a=0;a<r;++a,e+=v.default.packedLength)s[a]=v.default.unpack(t,e);var u=mi.default.unpack(t,e,Ol);e+=mi.default.packedLength;var d=t[e++],f=t[e];return Object(l.default)(i)?(i._positions=n,i._shape=s,i._ellipsoid=mi.default.clone(u,i._ellipsoid),i._cornerType=d,i._granularity=f,i):(wl.polylinePositions=n,wl.shapePositions=s,wl.cornerType=d,wl.granularity=f,new bl(wl))};var Al=new y.default;bl.createGeometry=function(t){var e=t._positions,i=Object(te.a)(e,_.default.equalsEpsilon),a=t._shape;if(a=ze.removeDuplicatesFromShape(a),!(i.length<2||a.length<3)){bi.a.computeWindingOrder2D(a)===mo.default.CLOCKWISE&&a.reverse();var n=y.default.fromPoints(a,Al);return function(t,e){var i=new vi.a;i.position=new yi.a({componentDatatype:ut.a.DOUBLE,componentsPerAttribute:3,values:t});var a,n,o=e.length,l=i.position.values.length/3,s=t.length/3/o,u=_i.a.createTypedArray(l,2*o*(s+1)),d=0,f=(a=0)*o;for(n=0;n<o-1;n++)u[d++]=n+f,u[d++]=n+f+1;for(u[d++]=o-1+f,u[d++]=f,f=(a=s-1)*o,n=0;n<o-1;n++)u[d++]=n+f,u[d++]=n+f+1;for(u[d++]=o-1+f,u[d++]=f,a=0;a<s-1;a++){var c=o*a,h=c+o;for(n=0;n<o;n++)u[d++]=n+c,u[d++]=n+h}return new gi.a({attributes:i,indices:_i.a.createTypedArray(l,u),boundingSphere:r.default.fromVertices(t),primitiveType:Oi.a.LINES})}(ze.computePositions(i,a,n,t,!1),a)}};var Pl=bl,El=new b.default;function Cl(t){this.id=t,this.vertexFormat=void 0,this.polylinePositions=void 0,this.shapePositions=void 0,this.cornerType=void 0,this.granularity=void 0}function jl(t,e){St.call(this,{entity:t,scene:e,geometryOptions:new Cl(t),geometryPropertyName:"polylineVolume",observedPropertyNames:["availability","polylineVolume"]}),this._onEntityPropertyChanged(t,"polylineVolume",t.polylineVolume,void 0)}function Dl(t,e,i){wt.call(this,t,e,i)}Object(l.default)(Object.create)&&(jl.prototype=Object.create(St.prototype),jl.prototype.constructor=jl),jl.prototype.createFillGeometryInstance=function(t){var e,i,a=this._entity,r=a.isAvailable(t),n=new gt.a(r&&a.isShowing&&this._showProperty.getValue(t)&&this._fillProperty.getValue(t)),o=this._distanceDisplayConditionProperty.getValue(t),s=ft.fromDistanceDisplayCondition(o);this._materialProperty instanceof yt.default?(Object(l.default)(this._materialProperty.color)&&(this._materialProperty.color.isConstant||r)&&(i=this._materialProperty.color.getValue(t,El)),Object(l.default)(i)||(i=b.default.WHITE),e={show:n,distanceDisplayCondition:s,color:st.a.fromColor(i)}):e={show:n,distanceDisplayCondition:s};return new ct.a({id:a,geometry:new _l(this._options),attributes:e})},jl.prototype.createOutlineGeometryInstance=function(t){var e=this._entity,i=e.isAvailable(t),a=D.default.getValueOrDefault(this._outlineColorProperty,t,b.default.BLACK,El),r=this._distanceDisplayConditionProperty.getValue(t);return new ct.a({id:e,geometry:new Pl(this._options),attributes:{show:new gt.a(i&&e.isShowing&&this._showProperty.getValue(t)&&this._showOutlineProperty.getValue(t)),color:st.a.fromColor(a),distanceDisplayCondition:ft.fromDistanceDisplayCondition(r)}})},jl.prototype._isHidden=function(t,e){return!Object(l.default)(e.positions)||!Object(l.default)(e.shape)||St.prototype._isHidden.call(this,t,e)},jl.prototype._isDynamic=function(t,e){return!(e.positions.isConstant&&e.shape.isConstant&&D.default.isConstant(e.granularity)&&D.default.isConstant(e.outlineWidth)&&D.default.isConstant(e.cornerType))},jl.prototype._setStaticOptions=function(t,e){var i=e.granularity,a=e.cornerType,r=this._options,n=this._materialProperty instanceof yt.default;r.vertexFormat=n?rt.a.VERTEX_FORMAT:at.MaterialSupport.TEXTURED.vertexFormat,r.polylinePositions=e.positions.getValue(pt.default.MINIMUM_VALUE,r.polylinePositions),r.shapePositions=e.shape.getValue(pt.default.MINIMUM_VALUE,r.shape),r.granularity=Object(l.default)(i)?i.getValue(pt.default.MINIMUM_VALUE):void 0,r.cornerType=Object(l.default)(a)?a.getValue(pt.default.MINIMUM_VALUE):void 0},jl.DynamicGeometryUpdater=Dl,Object(l.default)(Object.create)&&(Dl.prototype=Object.create(wt.prototype),Dl.prototype.constructor=Dl),Dl.prototype._isHidden=function(t,e,i){var a=this._options;return!Object(l.default)(a.polylinePositions)||!Object(l.default)(a.shapePositions)||wt.prototype._isHidden.call(this,t,e,i)},Dl.prototype._setOptions=function(t,e,i){var a=this._options;a.polylinePositions=D.default.getValueOrUndefined(e.positions,i,a.polylinePositions),a.shapePositions=D.default.getValueOrUndefined(e.shape,i),a.granularity=D.default.getValueOrUndefined(e.granularity,i),a.cornerType=D.default.getValueOrUndefined(e.cornerType,i)};var xl=jl,Tl=i(127),Il=i(280),Ml=new _.default,Vl=new _.default,Nl=new _.default,Sl=new _.default,Ll=new wi.default,Fl=new v.default,Ul=new r.default,Rl=new r.default;function Hl(t,e){var i=new gi.a({attributes:new vi.a,primitiveType:Oi.a.TRIANGLES});return i.attributes.position=new yi.a({componentDatatype:ut.a.DOUBLE,componentsPerAttribute:3,values:e.positions}),t.normal&&(i.attributes.normal=new yi.a({componentDatatype:ut.a.FLOAT,componentsPerAttribute:3,values:e.normals})),t.tangent&&(i.attributes.tangent=new yi.a({componentDatatype:ut.a.FLOAT,componentsPerAttribute:3,values:e.tangents})),t.bitangent&&(i.attributes.bitangent=new yi.a({componentDatatype:ut.a.FLOAT,componentsPerAttribute:3,values:e.bitangents})),i}var Bl=new _.default,Gl=new _.default;function kl(t,e){var i=t._vertexFormat,a=t._ellipsoid,r=e.height,n=e.width,o=e.northCap,l=e.southCap,s=0,u=r,d=r,f=0;o&&(s=1,d-=1,f+=1),l&&(u-=1,d-=1,f+=1),f+=n*d;for(var c=i.position?new Float64Array(3*f):void 0,h=i.st?new Float32Array(2*f):void 0,p=0,m=0,g=Ml,y=Fl,v=Number.MAX_VALUE,b=Number.MAX_VALUE,O=-Number.MAX_VALUE,w=-Number.MAX_VALUE,A=s;A<u;++A)for(var P=0;P<n;++P)Il.a.computePosition(e,a,i.st,A,P,g,y),c[p++]=g.x,c[p++]=g.y,c[p++]=g.z,i.st&&(h[m++]=y.x,h[m++]=y.y,v=Math.min(v,y.x),b=Math.min(b,y.y),O=Math.max(O,y.x),w=Math.max(w,y.y));if(o&&(Il.a.computePosition(e,a,i.st,0,0,g,y),c[p++]=g.x,c[p++]=g.y,c[p++]=g.z,i.st&&(h[m++]=y.x,h[m++]=y.y,v=y.x,b=y.y,O=y.x,w=y.y)),l&&(Il.a.computePosition(e,a,i.st,r-1,0,g,y),c[p++]=g.x,c[p++]=g.y,c[p]=g.z,i.st&&(h[m++]=y.x,h[m]=y.y,v=Math.min(v,y.x),b=Math.min(b,y.y),O=Math.max(O,y.x),w=Math.max(w,y.y))),i.st&&(v<0||b<0||O>1||w>1))for(var E=0;E<h.length;E+=2)h[E]=(h[E]-v)/(O-v),h[E+1]=(h[E+1]-b)/(w-b);var C=function(t,e,i,a){var r=t.length,n=e.normal?new Float32Array(r):void 0,o=e.tangent?new Float32Array(r):void 0,l=e.bitangent?new Float32Array(r):void 0,s=0,u=Sl,d=Nl,f=Vl;if(e.normal||e.tangent||e.bitangent)for(var c=0;c<r;c+=3){var h=_.default.fromArray(t,c,Ml),p=s+1,m=s+2;f=i.geodeticSurfaceNormal(h,f),(e.tangent||e.bitangent)&&(_.default.cross(_.default.UNIT_Z,f,d),ie.default.multiplyByVector(a,d,d),_.default.normalize(d,d),e.bitangent&&_.default.normalize(_.default.cross(f,d,u),u)),e.normal&&(n[s]=f.x,n[p]=f.y,n[m]=f.z),e.tangent&&(o[s]=d.x,o[p]=d.y,o[m]=d.z),e.bitangent&&(l[s]=u.x,l[p]=u.y,l[m]=u.z),s+=3}return Hl(e,{positions:t,normals:n,tangents:o,bitangents:l})}(c,i,a,e.tangentRotationMatrix),j=6*(n-1)*(d-1);o&&(j+=3*(n-1)),l&&(j+=3*(n-1));var D,x=_i.a.createTypedArray(f,j),T=0,I=0;for(D=0;D<d-1;++D){for(var M=0;M<n-1;++M){var V=T,N=V+n,S=N+1,L=V+1;x[I++]=V,x[I++]=N,x[I++]=L,x[I++]=L,x[I++]=N,x[I++]=S,++T}++T}if(o||l){var F,U,R=f-1,H=f-1;if(o&&l&&(R=f-2),T=0,o)for(D=0;D<n-1;D++)U=(F=T)+1,x[I++]=R,x[I++]=F,x[I++]=U,++T;if(l)for(T=(d-1)*n,D=0;D<n-1;D++)U=(F=T)+1,x[I++]=F,x[I++]=H,x[I++]=U,++T}return C.indices=x,i.st&&(C.attributes.st=new yi.a({componentDatatype:ut.a.FLOAT,componentsPerAttribute:2,values:h})),C}function zl(t,e,i,a,r){return t[e++]=a[i],t[e++]=a[i+1],t[e++]=a[i+2],t[e++]=r[i],t[e++]=r[i+1],t[e]=r[i+2],t}function Wl(t,e,i,a){return t[e++]=a[i],t[e++]=a[i+1],t[e++]=a[i],t[e]=a[i+1],t}var Yl=new $.default;function ql(t,e){var i,a=t._shadowVolume,r=t._offsetAttribute,n=t._vertexFormat,o=t._extrudedHeight,s=t._surfaceHeight,u=t._ellipsoid,d=e.height,f=e.width;if(a){var c=$.default.clone(n,Yl);c.normal=!0,t._vertexFormat=c}var h=kl(t,e);a&&(t._vertexFormat=n);var p=bi.a.scaleToGeodeticHeight(h.attributes.position.values,s,u,!1),m=(p=new Float64Array(p)).length,g=2*m,y=new Float64Array(g);y.set(p);var v=bi.a.scaleToGeodeticHeight(h.attributes.position.values,o,u);y.set(v,m),h.attributes.position.values=y;var b,O,w,A=n.normal?new Float32Array(g):void 0,P=n.tangent?new Float32Array(g):void 0,E=n.bitangent?new Float32Array(g):void 0,C=n.st?new Float32Array(g/3*2):void 0;if(n.normal){for(O=h.attributes.normal.values,A.set(O),i=0;i<m;i++)O[i]=-O[i];A.set(O,m),h.attributes.normal.values=A}if(a){O=h.attributes.normal.values,n.normal||(h.attributes.normal=void 0);var j=new Float32Array(g);for(i=0;i<m;i++)O[i]=-O[i];j.set(O,m),h.attributes.extrudeDirection=new yi.a({componentDatatype:ut.a.FLOAT,componentsPerAttribute:3,values:j})}var D=Object(l.default)(r);if(D){var x=m/3*2,T=new Uint8Array(x);r===ht.a.TOP?T=Object($t.a)(T,1,0,x/2):(w=r===ht.a.NONE?0:1,T=Object($t.a)(T,w)),h.attributes.applyOffset=new yi.a({componentDatatype:ut.a.UNSIGNED_BYTE,componentsPerAttribute:1,values:T})}if(n.tangent){var I=h.attributes.tangent.values;for(P.set(I),i=0;i<m;i++)I[i]=-I[i];P.set(I,m),h.attributes.tangent.values=P}if(n.bitangent){var M=h.attributes.bitangent.values;E.set(M),E.set(M,m),h.attributes.bitangent.values=E}n.st&&(b=h.attributes.st.values,C.set(b),C.set(b,m/3*2),h.attributes.st.values=C);var V=h.indices,N=V.length,S=m/3,L=_i.a.createTypedArray(g/3,2*N);for(L.set(V),i=0;i<N;i+=3)L[i+N]=V[i+2]+S,L[i+1+N]=V[i+1]+S,L[i+2+N]=V[i]+S;h.indices=L;var F=e.northCap,U=e.southCap,R=d,H=2,B=0,G=4,k=4;F&&(H-=1,R-=1,B+=1,G-=2,k-=1),U&&(H-=1,R-=1,B+=1,G-=2,k-=1);var z=2*((B+=H*f+2*R-G)+k),W=new Float64Array(3*z),Y=a?new Float32Array(3*z):void 0,q=D?new Uint8Array(z):void 0,X=n.st?new Float32Array(2*z):void 0,Z=r===ht.a.TOP;D&&!Z&&(w=r===ht.a.ALL?1:0,q=Object($t.a)(q,w));var J,K=0,Q=0,tt=0,et=0,it=f*R;for(i=0;i<it;i+=f)W=zl(W,K,J=3*i,p,v),K+=6,n.st&&(X=Wl(X,Q,2*i,b),Q+=4),a&&(tt+=3,Y[tt++]=O[J],Y[tt++]=O[J+1],Y[tt++]=O[J+2]),Z&&(q[et++]=1,et+=1);if(U){var at=F?it+1:it;for(J=3*at,i=0;i<2;i++)W=zl(W,K,J,p,v),K+=6,n.st&&(X=Wl(X,Q,2*at,b),Q+=4),a&&(tt+=3,Y[tt++]=O[J],Y[tt++]=O[J+1],Y[tt++]=O[J+2]),Z&&(q[et++]=1,et+=1)}else for(i=it-f;i<it;i++)W=zl(W,K,J=3*i,p,v),K+=6,n.st&&(X=Wl(X,Q,2*i,b),Q+=4),a&&(tt+=3,Y[tt++]=O[J],Y[tt++]=O[J+1],Y[tt++]=O[J+2]),Z&&(q[et++]=1,et+=1);for(i=it-1;i>0;i-=f)W=zl(W,K,J=3*i,p,v),K+=6,n.st&&(X=Wl(X,Q,2*i,b),Q+=4),a&&(tt+=3,Y[tt++]=O[J],Y[tt++]=O[J+1],Y[tt++]=O[J+2]),Z&&(q[et++]=1,et+=1);if(F){var rt=it;for(J=3*rt,i=0;i<2;i++)W=zl(W,K,J,p,v),K+=6,n.st&&(X=Wl(X,Q,2*rt,b),Q+=4),a&&(tt+=3,Y[tt++]=O[J],Y[tt++]=O[J+1],Y[tt++]=O[J+2]),Z&&(q[et++]=1,et+=1)}else for(i=f-1;i>=0;i--)W=zl(W,K,J=3*i,p,v),K+=6,n.st&&(X=Wl(X,Q,2*i,b),Q+=4),a&&(tt+=3,Y[tt++]=O[J],Y[tt++]=O[J+1],Y[tt++]=O[J+2]),Z&&(q[et++]=1,et+=1);var nt=function(t,e,i){var a=t.length,r=e.normal?new Float32Array(a):void 0,n=e.tangent?new Float32Array(a):void 0,o=e.bitangent?new Float32Array(a):void 0,l=0,s=0,u=0,d=!0,f=Sl,c=Nl,h=Vl;if(e.normal||e.tangent||e.bitangent)for(var p=0;p<a;p+=6){var m=_.default.fromArray(t,p,Ml),g=_.default.fromArray(t,(p+6)%a,Bl);if(d){var y=_.default.fromArray(t,(p+3)%a,Gl);_.default.subtract(g,m,g),_.default.subtract(y,m,y),h=_.default.normalize(_.default.cross(y,g,h),h),d=!1}_.default.equalsEpsilon(g,m,Ut.default.EPSILON10)&&(d=!0),(e.tangent||e.bitangent)&&(f=i.geodeticSurfaceNormal(m,f),e.tangent&&(c=_.default.normalize(_.default.cross(f,h,c),c))),e.normal&&(r[l++]=h.x,r[l++]=h.y,r[l++]=h.z,r[l++]=h.x,r[l++]=h.y,r[l++]=h.z),e.tangent&&(n[s++]=c.x,n[s++]=c.y,n[s++]=c.z,n[s++]=c.x,n[s++]=c.y,n[s++]=c.z),e.bitangent&&(o[u++]=f.x,o[u++]=f.y,o[u++]=f.z,o[u++]=f.x,o[u++]=f.y,o[u++]=f.z)}return Hl(e,{positions:t,normals:r,tangents:n,bitangents:o})}(W,n,u);n.st&&(nt.attributes.st=new yi.a({componentDatatype:ut.a.FLOAT,componentsPerAttribute:2,values:X})),a&&(nt.attributes.extrudeDirection=new yi.a({componentDatatype:ut.a.FLOAT,componentsPerAttribute:3,values:Y})),D&&(nt.attributes.applyOffset=new yi.a({componentDatatype:ut.a.UNSIGNED_BYTE,componentsPerAttribute:1,values:q}));var ot,lt,st,dt,ft=_i.a.createTypedArray(z,6*B);m=W.length/3;var pt=0;for(i=0;i<m-1;i+=2){dt=((ot=i)+2)%m;var mt=_.default.fromArray(W,3*ot,Bl),gt=_.default.fromArray(W,3*dt,Gl);_.default.equalsEpsilon(mt,gt,Ut.default.EPSILON10)||(st=((lt=(ot+1)%m)+2)%m,ft[pt++]=ot,ft[pt++]=lt,ft[pt++]=dt,ft[pt++]=dt,ft[pt++]=lt,ft[pt++]=st)}return nt.indices=ft,(nt=ir.a.combineInstances([new ct.a({geometry:h}),new ct.a({geometry:nt})]))[0]}var Xl=[new _.default,new _.default,new _.default,new _.default],Zl=new Ft.default,Jl=new Ft.default;function Kl(t,e,i,a,r){if(0===i)return wi.default.clone(t,r);var n=Il.a.computeOptions(t,e,i,0,Ll,Zl),o=n.height,l=n.width,s=Xl;return Il.a.computePosition(n,a,!1,0,0,s[0]),Il.a.computePosition(n,a,!1,0,l-1,s[1]),Il.a.computePosition(n,a,!1,o-1,0,s[2]),Il.a.computePosition(n,a,!1,o-1,l-1,s[3]),wi.default.fromCartesianArray(s,a,r)}function Ql(t){var e=(t=Object(o.default)(t,o.default.EMPTY_OBJECT)).rectangle,i=Object(o.default)(t.height,0),a=Object(o.default)(t.extrudedHeight,i);this._rectangle=wi.default.clone(e),this._granularity=Object(o.default)(t.granularity,Ut.default.RADIANS_PER_DEGREE),this._ellipsoid=mi.default.clone(Object(o.default)(t.ellipsoid,mi.default.WGS84)),this._surfaceHeight=Math.max(i,a),this._rotation=Object(o.default)(t.rotation,0),this._stRotation=Object(o.default)(t.stRotation,0),this._vertexFormat=$.default.clone(Object(o.default)(t.vertexFormat,$.default.DEFAULT)),this._extrudedHeight=Math.min(i,a),this._shadowVolume=Object(o.default)(t.shadowVolume,!1),this._workerName="createRectangleGeometry",this._offsetAttribute=t.offsetAttribute,this._rotatedRectangle=void 0,this._textureCoordinateRotationPoints=void 0}Ql.packedLength=wi.default.packedLength+mi.default.packedLength+$.default.packedLength+7,Ql.pack=function(t,e,i){return i=Object(o.default)(i,0),wi.default.pack(t._rectangle,e,i),i+=wi.default.packedLength,mi.default.pack(t._ellipsoid,e,i),i+=mi.default.packedLength,$.default.pack(t._vertexFormat,e,i),i+=$.default.packedLength,e[i++]=t._granularity,e[i++]=t._surfaceHeight,e[i++]=t._rotation,e[i++]=t._stRotation,e[i++]=t._extrudedHeight,e[i++]=t._shadowVolume?1:0,e[i]=Object(o.default)(t._offsetAttribute,-1),e};var $l=new wi.default,ts=mi.default.clone(mi.default.UNIT_SPHERE),es={rectangle:$l,ellipsoid:ts,vertexFormat:Yl,granularity:void 0,height:void 0,rotation:void 0,stRotation:void 0,extrudedHeight:void 0,shadowVolume:void 0,offsetAttribute:void 0};Ql.unpack=function(t,e,i){e=Object(o.default)(e,0);var a=wi.default.unpack(t,e,$l);e+=wi.default.packedLength;var r=mi.default.unpack(t,e,ts);e+=mi.default.packedLength;var n=$.default.unpack(t,e,Yl);e+=$.default.packedLength;var s=t[e++],u=t[e++],d=t[e++],f=t[e++],c=t[e++],h=1===t[e++],p=t[e];return Object(l.default)(i)?(i._rectangle=wi.default.clone(a,i._rectangle),i._ellipsoid=mi.default.clone(r,i._ellipsoid),i._vertexFormat=$.default.clone(n,i._vertexFormat),i._granularity=s,i._surfaceHeight=u,i._rotation=d,i._stRotation=f,i._extrudedHeight=c,i._shadowVolume=h,i._offsetAttribute=-1===p?void 0:p,i):(es.granularity=s,es.height=u,es.rotation=d,es.stRotation=f,es.extrudedHeight=c,es.shadowVolume=h,es.offsetAttribute=-1===p?void 0:p,new Ql(es))},Ql.computeRectangle=function(t,e){var i=(t=Object(o.default)(t,o.default.EMPTY_OBJECT)).rectangle,a=Object(o.default)(t.granularity,Ut.default.RADIANS_PER_DEGREE),r=Object(o.default)(t.ellipsoid,mi.default.WGS84);return Kl(i,a,Object(o.default)(t.rotation,0),r,e)};var is=new ie.default,as=new le.default,rs=new Ft.default;Ql.createGeometry=function(t){if(!Ut.default.equalsEpsilon(t._rectangle.north,t._rectangle.south,Ut.default.EPSILON10)&&!Ut.default.equalsEpsilon(t._rectangle.east,t._rectangle.west,Ut.default.EPSILON10)){var e=t._rectangle,i=t._ellipsoid,a=t._rotation,n=t._stRotation,o=t._vertexFormat,s=Il.a.computeOptions(e,t._granularity,a,n,Ll,Zl,Jl),u=is;if(0!==n||0!==a){var d=wi.default.center(e,rs),f=i.geodeticSurfaceNormalCartographic(d,Bl);le.default.fromAxisAngle(f,-n,as),ie.default.fromQuaternion(as,u)}else ie.default.clone(ie.default.IDENTITY,u);var c,h,p=t._surfaceHeight,m=t._extrudedHeight,g=!Ut.default.equalsEpsilon(p,m,0,Ut.default.EPSILON2);if(s.lonScalar=1/t._rectangle.width,s.latScalar=1/t._rectangle.height,s.tangentRotationMatrix=u,e=t._rectangle,g){c=ql(t,s);var y=r.default.fromRectangle3D(e,i,p,Rl),v=r.default.fromRectangle3D(e,i,m,Ul);h=r.default.union(y,v)}else{if((c=kl(t,s)).attributes.position.values=bi.a.scaleToGeodeticHeight(c.attributes.position.values,p,i,!1),Object(l.default)(t._offsetAttribute)){var _=c.attributes.position.values.length,b=new Uint8Array(_/3),O=t._offsetAttribute===ht.a.NONE?0:1;Object($t.a)(b,O),c.attributes.applyOffset=new yi.a({componentDatatype:ut.a.UNSIGNED_BYTE,componentsPerAttribute:1,values:b})}h=r.default.fromRectangle3D(e,i,p)}return o.position||delete c.attributes.position,new gi.a({attributes:c.attributes,indices:c.indices,primitiveType:c.primitiveType,boundingSphere:h,offsetAttribute:t._offsetAttribute})}},Ql.createShadowVolume=function(t,e,i){var a=t._granularity,r=t._ellipsoid,n=e(a,r),o=i(a,r);return new Ql({rectangle:t._rectangle,rotation:t._rotation,ellipsoid:r,stRotation:t._stRotation,granularity:a,extrudedHeight:o,height:n,vertexFormat:$.default.POSITION_ONLY,shadowVolume:!0})};var ns=new wi.default,os=[new v.default,new v.default,new v.default],ls=new Tl.a,ss=new Ft.default;Object(s.default)(Ql.prototype,{rectangle:{get:function(){return Object(l.default)(this._rotatedRectangle)||(this._rotatedRectangle=Kl(this._rectangle,this._granularity,this._rotation,this._ellipsoid)),this._rotatedRectangle}},textureCoordinateRotationPoints:{get:function(){return Object(l.default)(this._textureCoordinateRotationPoints)||(this._textureCoordinateRotationPoints=function(t){if(0===t._stRotation)return[0,0,0,1,1,0];var e=wi.default.clone(t._rectangle,ns),i=t._granularity,a=t._ellipsoid,r=Kl(e,i,t._rotation-t._stRotation,a,ns),n=os;n[0].x=r.west,n[0].y=r.south,n[1].x=r.west,n[1].y=r.north,n[2].x=r.east,n[2].y=r.south;for(var o=t.rectangle,l=Tl.a.fromRotation(t._stRotation,ls),s=wi.default.center(o,ss),u=0;u<3;++u){var d=n[u];d.x-=s.longitude,d.y-=s.latitude,Tl.a.multiplyByVector(l,d,d),d.x+=s.longitude,d.y+=s.latitude,d.x=(d.x-o.west)/o.width,d.y=(d.y-o.south)/o.height}var f=n[0],c=n[1],h=n[2],p=new Array(6);return v.default.pack(f,p),v.default.pack(c,p,2),v.default.pack(h,p,4),p}(this)),this._textureCoordinateRotationPoints}}});var us=Ql,ds=i(606),fs=new b.default,cs=_.default.ZERO,hs=new _.default,ps=new wi.default,ms=new wi.default,gs=new Ft.default;function ys(t){this.id=t,this.vertexFormat=void 0,this.rectangle=void 0,this.height=void 0,this.extrudedHeight=void 0,this.granularity=void 0,this.stRotation=void 0,this.rotation=void 0,this.offsetAttribute=void 0}function vs(t,e){oa.call(this,{entity:t,scene:e,geometryOptions:new ys(t),geometryPropertyName:"rectangle",observedPropertyNames:["availability","rectangle"]}),this._onEntityPropertyChanged(t,"rectangle",t.rectangle,void 0)}function _s(t,e,i){wt.call(this,t,e,i)}Object(l.default)(Object.create)&&(vs.prototype=Object.create(oa.prototype),vs.prototype.constructor=vs),vs.prototype.createFillGeometryInstance=function(t){var e,i=this._entity,a=i.isAvailable(t),r={show:new gt.a(a&&i.isShowing&&this._showProperty.getValue(t)&&this._fillProperty.getValue(t)),distanceDisplayCondition:ft.fromDistanceDisplayCondition(this._distanceDisplayConditionProperty.getValue(t)),offset:void 0,color:void 0};this._materialProperty instanceof yt.default&&(Object(l.default)(this._materialProperty.color)&&(this._materialProperty.color.isConstant||a)&&(e=this._materialProperty.color.getValue(t,fs)),Object(l.default)(e)||(e=b.default.WHITE),r.color=st.a.fromColor(e));return Object(l.default)(this._options.offsetAttribute)&&(r.offset=mt.a.fromCartesian3(D.default.getValueOrDefault(this._terrainOffsetProperty,t,cs,hs))),new ct.a({id:i,geometry:new us(this._options),attributes:r})},vs.prototype.createOutlineGeometryInstance=function(t){var e=this._entity,i=e.isAvailable(t),a=D.default.getValueOrDefault(this._outlineColorProperty,t,b.default.BLACK,fs),r=this._distanceDisplayConditionProperty.getValue(t),n={show:new gt.a(i&&e.isShowing&&this._showProperty.getValue(t)&&this._showOutlineProperty.getValue(t)),color:st.a.fromColor(a),distanceDisplayCondition:ft.fromDistanceDisplayCondition(r),offset:void 0};return Object(l.default)(this._options.offsetAttribute)&&(n.offset=mt.a.fromCartesian3(D.default.getValueOrDefault(this._terrainOffsetProperty,t,cs,hs))),new ct.a({id:e,geometry:new ds.a(this._options),attributes:n})},vs.prototype._computeCenter=function(t,e){var i=D.default.getValueOrUndefined(this._entity.rectangle.coordinates,t,ms);if(Object(l.default)(i)){var a=wi.default.center(i,gs);return Ft.default.toCartesian(a,mi.default.WGS84,e)}},vs.prototype._isHidden=function(t,e){return!Object(l.default)(e.coordinates)||St.prototype._isHidden.call(this,t,e)},vs.prototype._isDynamic=function(t,e){return!e.coordinates.isConstant||!D.default.isConstant(e.height)||!D.default.isConstant(e.extrudedHeight)||!D.default.isConstant(e.granularity)||!D.default.isConstant(e.stRotation)||!D.default.isConstant(e.rotation)||!D.default.isConstant(e.outlineWidth)||!D.default.isConstant(e.zIndex)||this._onTerrain&&!D.default.isConstant(this._materialProperty)},vs.prototype._setStaticOptions=function(t,e){var i=this._materialProperty instanceof yt.default,r=D.default.getValueOrUndefined(e.height,pt.default.MINIMUM_VALUE),n=D.default.getValueOrDefault(e.heightReference,pt.default.MINIMUM_VALUE,P.default.NONE),o=D.default.getValueOrUndefined(e.extrudedHeight,pt.default.MINIMUM_VALUE),s=D.default.getValueOrDefault(e.extrudedHeightReference,pt.default.MINIMUM_VALUE,P.default.NONE);Object(l.default)(o)&&!Object(l.default)(r)&&(r=0);var u=this._options;u.vertexFormat=i?rt.a.VERTEX_FORMAT:at.MaterialSupport.TEXTURED.vertexFormat,u.rectangle=e.coordinates.getValue(pt.default.MINIMUM_VALUE,u.rectangle),u.granularity=D.default.getValueOrUndefined(e.granularity,pt.default.MINIMUM_VALUE),u.stRotation=D.default.getValueOrUndefined(e.stRotation,pt.default.MINIMUM_VALUE),u.rotation=D.default.getValueOrUndefined(e.rotation,pt.default.MINIMUM_VALUE),u.offsetAttribute=oa.computeGeometryOffsetAttribute(r,n,o,s),u.height=oa.getGeometryHeight(r,n),(o=oa.getGeometryExtrudedHeight(o,s))===oa.CLAMP_TO_GROUND&&(o=a.a.getMinimumMaximumHeights(us.computeRectangle(u,ps)).minimumTerrainHeight),u.extrudedHeight=o},vs.DynamicGeometryUpdater=_s,Object(l.default)(Object.create)&&(_s.prototype=Object.create(wt.prototype),_s.prototype.constructor=_s),_s.prototype._isHidden=function(t,e,i){return!Object(l.default)(this._options.rectangle)||wt.prototype._isHidden.call(this,t,e,i)},_s.prototype._setOptions=function(t,e,i){var r=this._options,n=D.default.getValueOrUndefined(e.height,i),o=D.default.getValueOrDefault(e.heightReference,i,P.default.NONE),s=D.default.getValueOrUndefined(e.extrudedHeight,i),u=D.default.getValueOrDefault(e.extrudedHeightReference,i,P.default.NONE);Object(l.default)(s)&&!Object(l.default)(n)&&(n=0),r.rectangle=D.default.getValueOrUndefined(e.coordinates,i,r.rectangle),r.granularity=D.default.getValueOrUndefined(e.granularity,i),r.stRotation=D.default.getValueOrUndefined(e.stRotation,i),r.rotation=D.default.getValueOrUndefined(e.rotation,i),r.offsetAttribute=oa.computeGeometryOffsetAttribute(n,o,s,u),r.height=oa.getGeometryHeight(n,o),(s=oa.getGeometryExtrudedHeight(s,u))===oa.CLAMP_TO_GROUND&&(s=a.a.getMinimumMaximumHeights(us.computeRectangle(r,ps)).minimumTerrainHeight),r.extrudedHeight=s};var bs=vs,Os=new b.default,ws=new w.a,As=new w.a,Ps=_.default.ZERO,Es=new _.default;function Cs(t,e,i,a,r,n,o){var s;this.translucent=e,this.appearanceType=i,this.depthFailAppearanceType=a,this.depthFailMaterialProperty=r,this.depthFailMaterial=void 0,this.closed=n,this.shadows=o,this.primitives=t,this.createPrimitive=!1,this.waitingOnCreate=!1,this.primitive=void 0,this.oldPrimitive=void 0,this.geometry=new g.default,this.updaters=new g.default,this.updatersWithAttributes=new g.default,this.attributes=new g.default,this.subscriptions=new g.default,this.showsUpdated=new g.default,this.itemsToRemove=[],this.invalidated=!1,Object(l.default)(r)&&(s=r.definitionChanged.addEventListener(Cs.prototype.onMaterialChanged,this)),this.removeMaterialSubscription=s}function js(t,e,i,a,r){this._solidItems=[],this._translucentItems=[],this._primitives=t,this._appearanceType=e,this._depthFailAppearanceType=i,this._closed=a,this._shadows=r}function Ds(t,e){for(var i=t.length-1;i>=0;i--){var a=t[i];if(a.remove(e))return 0===a.updaters.length&&(t.splice(i,1),a.destroy()),!0}return!1}function xs(t,e,i){for(var a=!1,r=e.length,n=0;n<r;++n){var o=e[n],l=o.itemsToRemove,s=l.length;if(s>0)for(n=0;n<s;n++){var u=l[n];o.remove(u),t.add(i,u),a=!0}}return a}function Ts(t,e,i,a){var r,n=e.length;for(r=n-1;r>=0;r--){var o=e[r];if(o.invalidated){e.splice(r,1);for(var l=o.updaters.values,s=l.length,u=0;u<s;u++)t.add(i,l[u]);o.destroy()}}for(n=e.length,r=0;r<n;++r)a=e[r].update(i)&&a;return a}function Is(t,e,i){for(var a=t.length,r=0;r<a;r++){var n=t[r];if(n.contains(e))return n.getBoundingSphere(e,i)}return j.default.FAILED}function Ms(t){for(var e=t.length,i=0;i<e;i++)t[i].destroy();t.length=0}Cs.prototype.onMaterialChanged=function(){this.invalidated=!0},Cs.prototype.isMaterial=function(t){var e=this.depthFailMaterialProperty,i=t.depthFailMaterialProperty;return i===e||!!Object(l.default)(e)&&e.equals(i)},Cs.prototype.add=function(t,e){var i=t.id;if(this.createPrimitive=!0,this.geometry.set(i,e),this.updaters.set(i,t),t.hasConstantFill&&t.fillMaterialProperty.isConstant&&D.default.isConstant(t.distanceDisplayConditionProperty)&&D.default.isConstant(t.terrainOffsetProperty)){var a=this;this.subscriptions.set(i,t.entity.definitionChanged.addEventListener(function(e,i,r,n){"isShowing"===i&&a.showsUpdated.set(t.id,t)}))}else this.updatersWithAttributes.set(i,t)},Cs.prototype.remove=function(t){var e=t.id;if(this.createPrimitive=this.geometry.remove(e)||this.createPrimitive,this.updaters.remove(e)){this.updatersWithAttributes.remove(e);var i=this.subscriptions.get(e);return Object(l.default)(i)&&(i(),this.subscriptions.remove(e),this.showsUpdated.remove(e)),!0}return!1},Cs.prototype.update=function(t){var e,i=!0,a=0,r=this.primitive,n=this.primitives;if(this.createPrimitive){var o=this.geometry.values;if(o.length>0){var s;Object(l.default)(r)&&(Object(l.default)(this.oldPrimitive)?n.remove(r):this.oldPrimitive=r),Object(l.default)(this.depthFailAppearanceType)&&(Object(l.default)(this.depthFailMaterialProperty)&&(this.depthFailMaterial=bt.getValue(t,this.depthFailMaterialProperty,this.depthFailMaterial)),s=new this.depthFailAppearanceType({material:this.depthFailMaterial,translucent:this.translucent,closed:this.closed})),r=new vt.a({show:!1,asynchronous:!0,geometryInstances:o,appearance:new this.appearanceType({translucent:this.translucent,closed:this.closed}),depthFailAppearance:s,shadows:this.shadows}),n.add(r),i=!1}else{Object(l.default)(r)&&(n.remove(r),r=void 0);var u=this.oldPrimitive;Object(l.default)(u)&&(n.remove(u),this.oldPrimitive=void 0)}this.attributes.removeAll(),this.primitive=r,this.createPrimitive=!1,this.waitingOnCreate=!0}else if(Object(l.default)(r)&&r.ready){r.show=!0,Object(l.default)(this.oldPrimitive)&&(n.remove(this.oldPrimitive),this.oldPrimitive=void 0),!Object(l.default)(this.depthFailAppearanceType)||this.depthFailMaterialProperty instanceof yt.default||(this.depthFailMaterial=bt.getValue(t,this.depthFailMaterialProperty,this.depthFailMaterial),this.primitive.depthFailAppearance.material=this.depthFailMaterial);var d=this.updatersWithAttributes.values,f=d.length,c=this.waitingOnCreate;for(e=0;e<f;e++){var h=d[e],p=this.geometry.get(h.id),m=this.attributes.get(p.id.id);if(Object(l.default)(m)||(m=r.getGeometryInstanceAttributes(p.id),this.attributes.set(p.id.id,m)),!h.fillMaterialProperty.isConstant||c){var g=h.fillMaterialProperty.color,y=D.default.getValueOrDefault(g,t,b.default.WHITE,Os);b.default.equals(m._lastColor,y)||(m._lastColor=b.default.clone(y,m._lastColor),m.color=st.a.toValue(y,m.color),(this.translucent&&255===m.color[3]||!this.translucent&&255!==m.color[3])&&(this.itemsToRemove[a++]=h))}if(Object(l.default)(this.depthFailAppearanceType)&&h.depthFailMaterialProperty instanceof yt.default&&(!h.depthFailMaterialProperty.isConstant||c)){var v=h.depthFailMaterialProperty.color,O=D.default.getValueOrDefault(v,t,b.default.WHITE,Os);b.default.equals(m._lastDepthFailColor,O)||(m._lastDepthFailColor=b.default.clone(O,m._lastDepthFailColor),m.depthFailColor=st.a.toValue(O,m.depthFailColor))}var A=h.entity.isShowing&&(h.hasConstantFill||h.isFilled(t));A!==(1===m.show[0])&&(m.show=gt.a.toValue(A,m.show));var P=h.distanceDisplayConditionProperty;if(!D.default.isConstant(P)){var E=D.default.getValueOrDefault(P,t,As,ws);w.a.equals(E,m._lastDistanceDisplayCondition)||(m._lastDistanceDisplayCondition=w.a.clone(E,m._lastDistanceDisplayCondition),m.distanceDisplayCondition=ft.toValue(E,m.distanceDisplayCondition))}var C=h.terrainOffsetProperty;if(!D.default.isConstant(C)){var j=D.default.getValueOrDefault(C,t,Ps,Es);_.default.equals(j,m._lastOffset)||(m._lastOffset=_.default.clone(j,m._lastOffset),m.offset=mt.a.toValue(j,m.offset))}}this.updateShows(r),this.waitingOnCreate=!1}else Object(l.default)(r)&&!r.ready&&(i=!1);return this.itemsToRemove.length=a,i},Cs.prototype.updateShows=function(t){for(var e=this.showsUpdated.values,i=e.length,a=0;a<i;a++){var r=e[a],n=this.geometry.get(r.id),o=this.attributes.get(n.id.id);Object(l.default)(o)||(o=t.getGeometryInstanceAttributes(n.id),this.attributes.set(n.id.id,o));var s=r.entity.isShowing;s!==(1===o.show[0])&&(o.show=gt.a.toValue(s,o.show),n.attributes.show.value[0]=o.show[0])}this.showsUpdated.removeAll()},Cs.prototype.contains=function(t){return this.updaters.contains(t.id)},Cs.prototype.getBoundingSphere=function(t,e){var i=this.primitive;if(!i.ready)return j.default.PENDING;var a=i.getGeometryInstanceAttributes(t.entity);return!Object(l.default)(a)||!Object(l.default)(a.boundingSphere)||Object(l.default)(a.show)&&0===a.show[0]?j.default.FAILED:(a.boundingSphere.clone(e),j.default.DONE)},Cs.prototype.destroy=function(){var t=this.primitive,e=this.primitives;Object(l.default)(t)&&e.remove(t);var i=this.oldPrimitive;Object(l.default)(i)&&e.remove(i),Object(l.default)(this.removeMaterialSubscription)&&this.removeMaterialSubscription()},js.prototype.add=function(t,e){var i,a,r=e.createFillGeometryInstance(t);255===r.attributes.color.value[3]?(i=this._solidItems,a=!1):(i=this._translucentItems,a=!0);for(var n=i.length,o=0;o<n;o++){var l=i[o];if(l.isMaterial(e))return void l.add(e,r)}var s=new Cs(this._primitives,a,this._appearanceType,this._depthFailAppearanceType,e.depthFailMaterialProperty,this._closed,this._shadows);s.add(e,r),i.push(s)},js.prototype.remove=function(t){Ds(this._solidItems,t)||Ds(this._translucentItems,t)},js.prototype.update=function(t){var e=Ts(this,this._solidItems,t,!0);e=Ts(this,this._translucentItems,t,e)&&e;var i=xs(this,this._solidItems,t),a=xs(this,this._translucentItems,t);return(i||a)&&(e=Ts(this,this._solidItems,t,e)&&e,e=Ts(this,this._translucentItems,t,e)&&e),e},js.prototype.getBoundingSphere=function(t,e){var i=Is(this._solidItems,t,e);return i===j.default.FAILED?Is(this._translucentItems,t,e):i},js.prototype.removeAllPrimitives=function(){Ms(this._solidItems),Ms(this._translucentItems)};var Vs=js,Ns=new w.a,Ss=new w.a,Ls=_.default.ZERO,Fs=new _.default;function Us(t,e,i,a,r,n,o){this.primitives=t,this.appearanceType=e,this.materialProperty=i,this.depthFailAppearanceType=a,this.depthFailMaterialProperty=r,this.closed=n,this.shadows=o,this.updaters=new g.default,this.createPrimitive=!0,this.primitive=void 0,this.oldPrimitive=void 0,this.geometry=new g.default,this.material=void 0,this.depthFailMaterial=void 0,this.updatersWithAttributes=new g.default,this.attributes=new g.default,this.invalidated=!1,this.removeMaterialSubscription=i.definitionChanged.addEventListener(Us.prototype.onMaterialChanged,this),this.subscriptions=new g.default,this.showsUpdated=new g.default}Us.prototype.onMaterialChanged=function(){this.invalidated=!0},Us.prototype.isMaterial=function(t){var e=this.materialProperty,i=t.fillMaterialProperty,a=this.depthFailMaterialProperty,r=t.depthFailMaterialProperty;if(i===e&&r===a)return!0;var n=Object(l.default)(e)&&e.equals(i);return n=(!Object(l.default)(a)&&!Object(l.default)(r)||Object(l.default)(a)&&a.equals(r))&&n},Us.prototype.add=function(t,e){var i=e.id;if(this.updaters.set(i,e),this.geometry.set(i,e.createFillGeometryInstance(t)),e.hasConstantFill&&e.fillMaterialProperty.isConstant&&D.default.isConstant(e.distanceDisplayConditionProperty)&&D.default.isConstant(e.terrainOffsetProperty)){var a=this;this.subscriptions.set(i,e.entity.definitionChanged.addEventListener(function(t,i,r,n){"isShowing"===i&&a.showsUpdated.set(e.id,e)}))}else this.updatersWithAttributes.set(i,e);this.createPrimitive=!0},Us.prototype.remove=function(t){var e=t.id;if(this.createPrimitive=this.geometry.remove(e)||this.createPrimitive,this.updaters.remove(e)){this.updatersWithAttributes.remove(e);var i=this.subscriptions.get(e);return Object(l.default)(i)&&(i(),this.subscriptions.remove(e),this.showsUpdated.remove(e)),!0}return!1};var Rs=new b.default;function Hs(t,e,i,a,r){this._items=[],this._primitives=t,this._appearanceType=e,this._depthFailAppearanceType=i,this._closed=a,this._shadows=r}Us.prototype.update=function(t){var e,i=!0,a=this.primitive,r=this.primitives,n=this.geometry.values;if(this.createPrimitive){if(n.length>0){var o;Object(l.default)(a)&&(Object(l.default)(this.oldPrimitive)?r.remove(a):this.oldPrimitive=a),this.material=bt.getValue(t,this.materialProperty,this.material),Object(l.default)(this.depthFailMaterialProperty)&&(this.depthFailMaterial=bt.getValue(t,this.depthFailMaterialProperty,this.depthFailMaterial),o=new this.depthFailAppearanceType({material:this.depthFailMaterial,translucent:this.depthFailMaterial.isTranslucent(),closed:this.closed})),a=new vt.a({show:!1,asynchronous:!0,geometryInstances:n,appearance:new this.appearanceType({material:this.material,translucent:this.material.isTranslucent(),closed:this.closed}),depthFailAppearance:o,shadows:this.shadows}),r.add(a),i=!1}else{Object(l.default)(a)&&(r.remove(a),a=void 0);var s=this.oldPrimitive;Object(l.default)(s)&&(r.remove(s),this.oldPrimitive=void 0)}this.attributes.removeAll(),this.primitive=a,this.createPrimitive=!1}else if(Object(l.default)(a)&&a.ready){a.show=!0,Object(l.default)(this.oldPrimitive)&&(r.remove(this.oldPrimitive),this.oldPrimitive=void 0),this.material=bt.getValue(t,this.materialProperty,this.material),this.primitive.appearance.material=this.material,!Object(l.default)(this.depthFailAppearanceType)||this.depthFailMaterialProperty instanceof yt.default||(this.depthFailMaterial=bt.getValue(t,this.depthFailMaterialProperty,this.depthFailMaterial),this.primitive.depthFailAppearance.material=this.depthFailMaterial);var u=this.updatersWithAttributes.values,d=u.length;for(e=0;e<d;e++){var f=u[e],c=f.entity,h=this.geometry.get(f.id),p=this.attributes.get(h.id.id);if(Object(l.default)(p)||(p=a.getGeometryInstanceAttributes(h.id),this.attributes.set(h.id.id,p)),Object(l.default)(this.depthFailAppearanceType)&&this.depthFailMaterialProperty instanceof yt.default&&!f.depthFailMaterialProperty.isConstant){var m=f.depthFailMaterialProperty.color,g=D.default.getValueOrDefault(m,t,b.default.WHITE,Rs);b.default.equals(p._lastDepthFailColor,g)||(p._lastDepthFailColor=b.default.clone(g,p._lastDepthFailColor),p.depthFailColor=st.a.toValue(g,p.depthFailColor))}var y=c.isShowing&&(f.hasConstantFill||f.isFilled(t));y!==(1===p.show[0])&&(p.show=gt.a.toValue(y,p.show));var v=f.distanceDisplayConditionProperty;if(!D.default.isConstant(v)){var O=D.default.getValueOrDefault(v,t,Ss,Ns);w.a.equals(O,p._lastDistanceDisplayCondition)||(p._lastDistanceDisplayCondition=w.a.clone(O,p._lastDistanceDisplayCondition),p.distanceDisplayCondition=ft.toValue(O,p.distanceDisplayCondition))}var A=f.terrainOffsetProperty;if(!D.default.isConstant(A)){var P=D.default.getValueOrDefault(A,t,Ls,Fs);_.default.equals(P,p._lastOffset)||(p._lastOffset=_.default.clone(P,p._lastOffset),p.offset=mt.a.toValue(P,p.offset))}}this.updateShows(a)}else Object(l.default)(a)&&!a.ready&&(i=!1);return i},Us.prototype.updateShows=function(t){for(var e=this.showsUpdated.values,i=e.length,a=0;a<i;a++){var r=e[a],n=r.entity,o=this.geometry.get(r.id),s=this.attributes.get(o.id.id);Object(l.default)(s)||(s=t.getGeometryInstanceAttributes(o.id),this.attributes.set(o.id.id,s));var u=n.isShowing;u!==(1===s.show[0])&&(s.show=gt.a.toValue(u,s.show),o.attributes.show.value[0]=s.show[0])}this.showsUpdated.removeAll()},Us.prototype.contains=function(t){return this.updaters.contains(t.id)},Us.prototype.getBoundingSphere=function(t,e){var i=this.primitive;if(!i.ready)return j.default.PENDING;var a=i.getGeometryInstanceAttributes(t.entity);return!Object(l.default)(a)||!Object(l.default)(a.boundingSphere)||Object(l.default)(a.show)&&0===a.show[0]?j.default.FAILED:(a.boundingSphere.clone(e),j.default.DONE)},Us.prototype.destroy=function(){var t=this.primitive,e=this.primitives;Object(l.default)(t)&&e.remove(t);var i=this.oldPrimitive;Object(l.default)(i)&&e.remove(i),this.removeMaterialSubscription()},Hs.prototype.add=function(t,e){for(var i=this._items,a=i.length,r=0;r<a;r++){var n=i[r];if(n.isMaterial(e))return void n.add(t,e)}var o=new Us(this._primitives,this._appearanceType,e.fillMaterialProperty,this._depthFailAppearanceType,e.depthFailMaterialProperty,this._closed,this._shadows);o.add(t,e),i.push(o)},Hs.prototype.remove=function(t){for(var e=this._items,i=e.length-1;i>=0;i--){var a=e[i];if(a.remove(t)){0===a.updaters.length&&(e.splice(i,1),a.destroy());break}}},Hs.prototype.update=function(t){var e,i=this._items;for(e=i.length-1;e>=0;e--){var a=i[e];if(a.invalidated){i.splice(e,1);for(var r=a.updaters.values,n=r.length,o=0;o<n;o++)this.add(t,r[o]);a.destroy()}}var l=!0;for(e=0;e<i.length;e++)l=i[e].update(t)&&l;return l},Hs.prototype.getBoundingSphere=function(t,e){for(var i=this._items,a=i.length,r=0;r<a;r++){var n=i[r];if(n.contains(t))return n.getBoundingSphere(t,e)}return j.default.FAILED},Hs.prototype.removeAllPrimitives=function(){for(var t=this._items,e=t.length,i=0;i<e;i++)t[i].destroy();this._items.length=0};var Bs=Hs,Gs=new b.default,ks=new w.a,zs=new w.a;function Ws(t,e,i,a,r){this.primitives=t,this.zIndex=r,this.classificationType=e,this.color=i,this.key=a,this.createPrimitive=!1,this.waitingOnCreate=!1,this.primitive=void 0,this.oldPrimitive=void 0,this.geometry=new g.default,this.updaters=new g.default,this.updatersWithAttributes=new g.default,this.attributes=new g.default,this.subscriptions=new g.default,this.showsUpdated=new g.default,this.itemsToRemove=[],this.isDirty=!1}Ws.prototype.add=function(t,e){var i=t.id;if(this.createPrimitive=!0,this.geometry.set(i,e),this.updaters.set(i,t),t.hasConstantFill&&t.fillMaterialProperty.isConstant&&D.default.isConstant(t.distanceDisplayConditionProperty)){var a=this;this.subscriptions.set(i,t.entity.definitionChanged.addEventListener(function(e,i,r,n){"isShowing"===i&&a.showsUpdated.set(t.id,t)}))}else this.updatersWithAttributes.set(i,t)},Ws.prototype.remove=function(t){var e=t.id;if(this.createPrimitive=this.geometry.remove(e)||this.createPrimitive,this.updaters.remove(e)){this.updatersWithAttributes.remove(e);var i=this.subscriptions.get(e);return Object(l.default)(i)&&(i(),this.subscriptions.remove(e),this.showsUpdated.remove(e)),!0}return!1};var Ys=new Array(4);function qs(t,e){this._batches=new g.default,this._primitives=t,this._classificationType=e}Ws.prototype.update=function(t){var e,i=!0,a=0,r=this.primitive,n=this.primitives;if(this.createPrimitive){var o=this.geometry.values;if(o.length>0)Object(l.default)(r)&&(Object(l.default)(this.oldPrimitive)?n.remove(r):this.oldPrimitive=r),r=new c.a({show:!1,asynchronous:!0,geometryInstances:o,classificationType:this.classificationType}),n.add(r,this.zIndex),i=!1;else{Object(l.default)(r)&&(n.remove(r),r=void 0);var s=this.oldPrimitive;Object(l.default)(s)&&(n.remove(s),this.oldPrimitive=void 0)}this.attributes.removeAll(),this.primitive=r,this.createPrimitive=!1,this.waitingOnCreate=!0}else if(Object(l.default)(r)&&r.ready){r.show=!0,Object(l.default)(this.oldPrimitive)&&(n.remove(this.oldPrimitive),this.oldPrimitive=void 0);var u=this.updatersWithAttributes.values,d=u.length,f=this.waitingOnCreate;for(e=0;e<d;e++){var h=u[e],p=this.geometry.get(h.id),m=this.attributes.get(p.id.id);if(Object(l.default)(m)||(m=r.getGeometryInstanceAttributes(p.id),this.attributes.set(p.id.id,m)),!h.fillMaterialProperty.isConstant||f){var g=h.fillMaterialProperty.color,y=D.default.getValueOrDefault(g,t,b.default.WHITE,Gs);if(!b.default.equals(m._lastColor,y)){m._lastColor=b.default.clone(y,m._lastColor);var v=this.color,_=y.toBytes(Ys);v[0]===_[0]&&v[1]===_[1]&&v[2]===_[2]&&v[3]===_[3]||(this.itemsToRemove[a++]=h)}}var O=h.entity.isShowing&&(h.hasConstantFill||h.isFilled(t));O!==(1===m.show[0])&&(m.show=gt.a.toValue(O,m.show));var A=h.distanceDisplayConditionProperty;if(!D.default.isConstant(A)){var P=D.default.getValueOrDefault(A,t,zs,ks);w.a.equals(P,m._lastDistanceDisplayCondition)||(m._lastDistanceDisplayCondition=w.a.clone(P,m._lastDistanceDisplayCondition),m.distanceDisplayCondition=ft.toValue(P,m.distanceDisplayCondition))}}this.updateShows(r),this.waitingOnCreate=!1}else Object(l.default)(r)&&!r.ready&&(i=!1);return this.itemsToRemove.length=a,i},Ws.prototype.updateShows=function(t){for(var e=this.showsUpdated.values,i=e.length,a=0;a<i;a++){var r=e[a],n=this.geometry.get(r.id),o=this.attributes.get(n.id.id);Object(l.default)(o)||(o=t.getGeometryInstanceAttributes(n.id),this.attributes.set(n.id.id,o));var s=r.entity.isShowing;s!==(1===o.show[0])&&(o.show=gt.a.toValue(s,o.show),n.attributes.show.value[0]=o.show[0])}this.showsUpdated.removeAll()},Ws.prototype.contains=function(t){return this.updaters.contains(t.id)},Ws.prototype.getBoundingSphere=function(t,e){var i=this.primitive;if(!i.ready)return j.default.PENDING;var a=i.getBoundingSphere(t.entity);return Object(l.default)(a)?(a.clone(e),j.default.DONE):j.default.FAILED},Ws.prototype.removeAllPrimitives=function(){var t=this.primitives,e=this.primitive;Object(l.default)(e)&&(t.remove(e),this.primitive=void 0,this.geometry.removeAll(),this.updaters.removeAll());var i=this.oldPrimitive;Object(l.default)(i)&&(t.remove(i),this.oldPrimitive=void 0)},qs.prototype.add=function(t,e){var i,a=e.createFillGeometryInstance(t),r=this._batches,n=D.default.getValueOrDefault(e.zIndex,0),o=new Uint32Array(a.attributes.color.value.buffer)[0]+":"+n;return r.contains(o)?i=r.get(o):(i=new Ws(this._primitives,this._classificationType,a.attributes.color.value,o,n),r.set(o,i)),i.add(e,a),i},qs.prototype.remove=function(t){for(var e=this._batches.values,i=e.length,a=0;a<i;++a)if(e[a].remove(t))return},qs.prototype.update=function(t){var e,i,a=!0,r=this._batches,n=r.values,o=n.length;for(e=0;e<o;++e)a=n[e].update(t)&&a;for(e=0;e<o;++e)for(var l=n[e],s=l.itemsToRemove,u=s.length,d=0;d<u;d++){i=s[d],l.remove(i);var f=this.add(t,i);l.isDirty=!0,f.isDirty=!0}var c=n.slice(),h=c.length;for(e=0;e<h;++e){var p=c[e];p.isDirty&&(a=c[e].update(t)&&a,p.isDirty=!1),0===p.geometry.length&&r.remove(p.key)}return a},qs.prototype.getBoundingSphere=function(t,e){for(var i=this._batches.values,a=i.length,r=0;r<a;++r){var n=i[r];if(n.contains(t))return n.getBoundingSphere(t,e)}return j.default.FAILED},qs.prototype.removeAllPrimitives=function(){for(var t=this._batches.values,e=t.length,i=0;i<e;++i)t[i].removeAllPrimitives()};var Xs=qs;function Zs(t,e,i){var a=t[e];t[e]=t[i],t[i]=a}function Js(t,e){return t<e?-1:t>e?1:0}var Ks=function(t,e,i,a,r){!function t(e,i,a,r,n){for(;r>a;){if(r-a>600){var o=r-a+1,l=i-a+1,s=Math.log(o),u=.5*Math.exp(2*s/3),d=.5*Math.sqrt(s*u*(o-u)/o)*(l-o/2<0?-1:1),f=Math.max(a,Math.floor(i-l*u/o+d)),c=Math.min(r,Math.floor(i+(o-l)*u/o+d));t(e,i,f,c,n)}var h=e[i],p=a,m=r;for(Zs(e,a,i),n(e[r],h)>0&&Zs(e,a,r);p<m;){for(Zs(e,p,m),p++,m--;n(e[p],h)<0;)p++;for(;n(e[m],h)>0;)m--}0===n(e[a],h)?Zs(e,a,m):Zs(e,++m,r),m<=i&&(a=m+1),i<=m&&(r=m-1)}}(t,e,i||0,a||t.length-1,r||Js)};function Qs(t,e){if(!(this instanceof Qs))return new Qs(t,e);this._maxEntries=Math.max(4,t||9),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),e&&this._initFormat(e),this.clear()}function $s(t,e,i){if(!i)return e.indexOf(t);for(var a=0;a<e.length;a++)if(i(t,e[a]))return a;return-1}function tu(t,e){eu(t,0,t.children.length,e,t)}function eu(t,e,i,a,r){r||(r=uu(null)),r.minX=1/0,r.minY=1/0,r.maxX=-1/0,r.maxY=-1/0;for(var n,o=e;o<i;o++)n=t.children[o],iu(r,t.leaf?a(n):n);return r}function iu(t,e){return t.minX=Math.min(t.minX,e.minX),t.minY=Math.min(t.minY,e.minY),t.maxX=Math.max(t.maxX,e.maxX),t.maxY=Math.max(t.maxY,e.maxY),t}function au(t,e){return t.minX-e.minX}function ru(t,e){return t.minY-e.minY}function nu(t){return(t.maxX-t.minX)*(t.maxY-t.minY)}function ou(t){return t.maxX-t.minX+(t.maxY-t.minY)}function lu(t,e){return t.minX<=e.minX&&t.minY<=e.minY&&e.maxX<=t.maxX&&e.maxY<=t.maxY}function su(t,e){return e.minX<=t.maxX&&e.minY<=t.maxY&&e.maxX>=t.minX&&e.maxY>=t.minY}function uu(t){return{children:t,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function du(t,e,i,a,r){for(var n,o=[e,i];o.length;)(i=o.pop())-(e=o.pop())<=a||(n=e+Math.ceil((i-e)/a/2)*a,Ks(t,n,e,i,r),o.push(e,n,n,i))}Qs.prototype={all:function(){return this._all(this.data,[])},search:function(t){var e=this.data,i=[],a=this.toBBox;if(!su(t,e))return i;for(var r,n,o,l,s=[];e;){for(r=0,n=e.children.length;r<n;r++)o=e.children[r],su(t,l=e.leaf?a(o):o)&&(e.leaf?i.push(o):lu(t,l)?this._all(o,i):s.push(o));e=s.pop()}return i},collides:function(t){var e=this.data,i=this.toBBox;if(!su(t,e))return!1;for(var a,r,n,o,l=[];e;){for(a=0,r=e.children.length;a<r;a++)if(n=e.children[a],su(t,o=e.leaf?i(n):n)){if(e.leaf||lu(t,o))return!0;l.push(n)}e=l.pop()}return!1},load:function(t){if(!t||!t.length)return this;if(t.length<this._minEntries){for(var e=0,i=t.length;e<i;e++)this.insert(t[e]);return this}var a=this._build(t.slice(),0,t.length-1,0);if(this.data.children.length)if(this.data.height===a.height)this._splitRoot(this.data,a);else{if(this.data.height<a.height){var r=this.data;this.data=a,a=r}this._insert(a,this.data.height-a.height-1,!0)}else this.data=a;return this},insert:function(t){return t&&this._insert(t,this.data.height-1),this},clear:function(){return this.data=uu([]),this},remove:function(t,e){if(!t)return this;for(var i,a,r,n,o=this.data,l=this.toBBox(t),s=[],u=[];o||s.length;){if(o||(o=s.pop(),a=s[s.length-1],i=u.pop(),n=!0),o.leaf&&-1!==(r=$s(t,o.children,e)))return o.children.splice(r,1),s.push(o),this._condense(s),this;n||o.leaf||!lu(o,l)?a?(i++,o=a.children[i],n=!1):o=null:(s.push(o),u.push(i),i=0,a=o,o=o.children[0])}return this},toBBox:function(t){return t},compareMinX:au,compareMinY:ru,toJSON:function(){return this.data},fromJSON:function(t){return this.data=t,this},_all:function(t,e){for(var i=[];t;)t.leaf?e.push.apply(e,t.children):i.push.apply(i,t.children),t=i.pop();return e},_build:function(t,e,i,a){var r,n=i-e+1,o=this._maxEntries;if(n<=o)return tu(r=uu(t.slice(e,i+1)),this.toBBox),r;a||(a=Math.ceil(Math.log(n)/Math.log(o)),o=Math.ceil(n/Math.pow(o,a-1))),(r=uu([])).leaf=!1,r.height=a;var l,s,u,d,f=Math.ceil(n/o),c=f*Math.ceil(Math.sqrt(o));for(du(t,e,i,c,this.compareMinX),l=e;l<=i;l+=c)for(du(t,l,u=Math.min(l+c-1,i),f,this.compareMinY),s=l;s<=u;s+=f)d=Math.min(s+f-1,u),r.children.push(this._build(t,s,d,a-1));return tu(r,this.toBBox),r},_chooseSubtree:function(t,e,i,a){for(var r,n,o,l,s,u,d,f,c,h;a.push(e),!e.leaf&&a.length-1!==i;){for(d=f=1/0,r=0,n=e.children.length;r<n;r++)s=nu(o=e.children[r]),c=t,h=o,(u=(Math.max(h.maxX,c.maxX)-Math.min(h.minX,c.minX))*(Math.max(h.maxY,c.maxY)-Math.min(h.minY,c.minY))-s)<f?(f=u,d=s<d?s:d,l=o):u===f&&s<d&&(d=s,l=o);e=l||e.children[0]}return e},_insert:function(t,e,i){var a=this.toBBox,r=i?t:a(t),n=[],o=this._chooseSubtree(r,this.data,e,n);for(o.children.push(t),iu(o,r);e>=0&&n[e].children.length>this._maxEntries;)this._split(n,e),e--;this._adjustParentBBoxes(r,n,e)},_split:function(t,e){var i=t[e],a=i.children.length,r=this._minEntries;this._chooseSplitAxis(i,r,a);var n=this._chooseSplitIndex(i,r,a),o=uu(i.children.splice(n,i.children.length-n));o.height=i.height,o.leaf=i.leaf,tu(i,this.toBBox),tu(o,this.toBBox),e?t[e-1].children.push(o):this._splitRoot(i,o)},_splitRoot:function(t,e){this.data=uu([t,e]),this.data.height=t.height+1,this.data.leaf=!1,tu(this.data,this.toBBox)},_chooseSplitIndex:function(t,e,i){var a,r,n,o,l,s,u,d,f,c,h,p,m,g;for(s=u=1/0,a=e;a<=i-e;a++)r=eu(t,0,a,this.toBBox),n=eu(t,a,i,this.toBBox),f=r,c=n,h=void 0,p=void 0,m=void 0,g=void 0,h=Math.max(f.minX,c.minX),p=Math.max(f.minY,c.minY),m=Math.min(f.maxX,c.maxX),g=Math.min(f.maxY,c.maxY),o=Math.max(0,m-h)*Math.max(0,g-p),l=nu(r)+nu(n),o<s?(s=o,d=a,u=l<u?l:u):o===s&&l<u&&(u=l,d=a);return d},_chooseSplitAxis:function(t,e,i){var a=t.leaf?this.compareMinX:au,r=t.leaf?this.compareMinY:ru;this._allDistMargin(t,e,i,a)<this._allDistMargin(t,e,i,r)&&t.children.sort(a)},_allDistMargin:function(t,e,i,a){t.children.sort(a);var r,n,o=this.toBBox,l=eu(t,0,e,o),s=eu(t,i-e,i,o),u=ou(l)+ou(s);for(r=e;r<i-e;r++)n=t.children[r],iu(l,t.leaf?o(n):n),u+=ou(l);for(r=i-e-1;r>=e;r--)n=t.children[r],iu(s,t.leaf?o(n):n),u+=ou(s);return u},_adjustParentBBoxes:function(t,e,i){for(var a=i;a>=0;a--)iu(e[a],t)},_condense:function(t){for(var e,i=t.length-1;i>=0;i--)0===t[i].children.length?i>0?(e=t[i-1].children).splice(e.indexOf(t[i]),1):this.clear():tu(t[i],this.toBBox)},_initFormat:function(t){var e=["return a"," - b",";"];this.compareMinX=new Function("a","b",e.join(t[0])),this.compareMinY=new Function("a","b",e.join(t[1])),this.toBBox=new Function("a","return {minX: a"+t[0]+", minY: a"+t[1]+", maxX: a"+t[2]+", maxY: a"+t[3]+"};")}};var fu=Qs;function cu(){this._tree=fu()}function hu(){this.minX=0,this.minY=0,this.maxX=0,this.maxY=0,this.id=""}function pu(t,e){return t.id===e.id}hu.fromRectangleAndId=function(t,e,i){return i.minX=e.west,i.minY=e.south,i.maxX=e.east,i.maxY=e.north,i.id=t,i},cu.prototype.insert=function(t,e){var i=hu.fromRectangleAndId(t,e,new hu);this._tree.insert(i)};var mu=new hu;cu.prototype.remove=function(t,e){var i=hu.fromRectangleAndId(t,e,mu);this._tree.remove(i,pu)};var gu=new hu;cu.prototype.collides=function(t){var e=hu.fromRectangleAndId("",t,gu);return this._tree.collides(e)};var yu=cu,vu=i(251),_u=new w.a,bu=new w.a;function Ou(t,e,i,a,r,n){this.primitives=t,this.classificationType=e,this.appearanceType=i,this.materialProperty=a,this.updaters=new g.default,this.createPrimitive=!0,this.primitive=void 0,this.oldPrimitive=void 0,this.geometry=new g.default,this.material=void 0,this.updatersWithAttributes=new g.default,this.attributes=new g.default,this.invalidated=!1,this.removeMaterialSubscription=a.definitionChanged.addEventListener(Ou.prototype.onMaterialChanged,this),this.subscriptions=new g.default,this.showsUpdated=new g.default,this.usingSphericalTextureCoordinates=r,this.zIndex=n,this.rectangleCollisionCheck=new yu}function wu(t,e,i){this._items=[],this._primitives=t,this._classificationType=e,this._appearanceType=i}Ou.prototype.onMaterialChanged=function(){this.invalidated=!0},Ou.prototype.overlapping=function(t){return this.rectangleCollisionCheck.collides(t)},Ou.prototype.isMaterial=function(t){var e=this.materialProperty,i=t.fillMaterialProperty;return i===e||i instanceof yt.default&&e instanceof yt.default||Object(l.default)(e)&&e.equals(i)},Ou.prototype.add=function(t,e,i){var a=e.id;if(this.updaters.set(a,e),this.geometry.set(a,i),this.rectangleCollisionCheck.insert(a,i.geometry.rectangle),e.hasConstantFill&&e.fillMaterialProperty.isConstant&&D.default.isConstant(e.distanceDisplayConditionProperty)){var r=this;this.subscriptions.set(a,e.entity.definitionChanged.addEventListener(function(t,i,a,n){"isShowing"===i&&r.showsUpdated.set(e.id,e)}))}else this.updatersWithAttributes.set(a,e);this.createPrimitive=!0},Ou.prototype.remove=function(t){var e=t.id,i=this.geometry.get(e);if(this.createPrimitive=this.geometry.remove(e)||this.createPrimitive,this.updaters.remove(e)){this.rectangleCollisionCheck.remove(e,i.geometry.rectangle),this.updatersWithAttributes.remove(e);var a=this.subscriptions.get(e);return Object(l.default)(a)&&(a(),this.subscriptions.remove(e)),!0}return!1},Ou.prototype.update=function(t){var e,i=!0,a=this.primitive,r=this.primitives,n=this.geometry.values;if(this.createPrimitive){if(n.length>0)Object(l.default)(a)&&(Object(l.default)(this.oldPrimitive)?r.remove(a):this.oldPrimitive=a),this.material=bt.getValue(t,this.materialProperty,this.material),a=new c.a({show:!1,asynchronous:!0,geometryInstances:n,appearance:new this.appearanceType({material:this.material}),classificationType:this.classificationType}),r.add(a,this.zIndex),i=!1;else{Object(l.default)(a)&&(r.remove(a),a=void 0);var o=this.oldPrimitive;Object(l.default)(o)&&(r.remove(o),this.oldPrimitive=void 0)}this.attributes.removeAll(),this.primitive=a,this.createPrimitive=!1}else if(Object(l.default)(a)&&a.ready){a.show=!0,Object(l.default)(this.oldPrimitive)&&(r.remove(this.oldPrimitive),this.oldPrimitive=void 0),this.material=bt.getValue(t,this.materialProperty,this.material),this.primitive.appearance.material=this.material;var s=this.updatersWithAttributes.values,u=s.length;for(e=0;e<u;e++){var d=s[e],f=d.entity,h=this.geometry.get(d.id),p=this.attributes.get(h.id.id);Object(l.default)(p)||(p=a.getGeometryInstanceAttributes(h.id),this.attributes.set(h.id.id,p));var m=f.isShowing&&(d.hasConstantFill||d.isFilled(t));m!==(1===p.show[0])&&(p.show=gt.a.toValue(m,p.show));var g=d.distanceDisplayConditionProperty;if(!D.default.isConstant(g)){var y=D.default.getValueOrDefault(g,t,bu,_u);w.a.equals(y,p._lastDistanceDisplayCondition)||(p._lastDistanceDisplayCondition=w.a.clone(y,p._lastDistanceDisplayCondition),p.distanceDisplayCondition=ft.toValue(y,p.distanceDisplayCondition))}}this.updateShows(a)}else Object(l.default)(a)&&!a.ready&&(i=!1);return i},Ou.prototype.updateShows=function(t){for(var e=this.showsUpdated.values,i=e.length,a=0;a<i;a++){var r=e[a],n=r.entity,o=this.geometry.get(r.id),s=this.attributes.get(o.id.id);Object(l.default)(s)||(s=t.getGeometryInstanceAttributes(o.id),this.attributes.set(o.id.id,s));var u=n.isShowing;u!==(1===s.show[0])&&(s.show=gt.a.toValue(u,s.show),o.attributes.show.value[0]=s.show[0])}this.showsUpdated.removeAll()},Ou.prototype.contains=function(t){return this.updaters.contains(t.id)},Ou.prototype.getBoundingSphere=function(t,e){var i=this.primitive;if(!i.ready)return j.default.PENDING;var a=i.getGeometryInstanceAttributes(t.entity);return!Object(l.default)(a)||!Object(l.default)(a.boundingSphere)||Object(l.default)(a.show)&&0===a.show[0]?j.default.FAILED:(a.boundingSphere.clone(e),j.default.DONE)},Ou.prototype.destroy=function(){var t=this.primitive,e=this.primitives;Object(l.default)(t)&&e.remove(t);var i=this.oldPrimitive;Object(l.default)(i)&&e.remove(i),this.removeMaterialSubscription()},wu.prototype.add=function(t,e){for(var i=this._items,a=i.length,r=e.createFillGeometryInstance(t),n=vu.a.shouldUseSphericalCoordinates(r.geometry.rectangle),o=D.default.getValueOrDefault(e.zIndex,0),l=0;l<a;++l){var s=i[l];if(s.isMaterial(e)&&s.usingSphericalTextureCoordinates===n&&s.zIndex===o&&!s.overlapping(r.geometry.rectangle))return void s.add(t,e,r)}var u=new Ou(this._primitives,this._classificationType,this._appearanceType,e.fillMaterialProperty,n,o);u.add(t,e,r),i.push(u)},wu.prototype.remove=function(t){for(var e=this._items,i=e.length-1;i>=0;i--){var a=e[i];if(a.remove(t)){0===a.updaters.length&&(e.splice(i,1),a.destroy());break}}},wu.prototype.update=function(t){var e,i=this._items;for(e=i.length-1;e>=0;e--){var a=i[e];if(a.invalidated){i.splice(e,1);for(var r=a.updaters.values,n=r.length,o=0;o<n;o++)this.add(t,r[o]);a.destroy()}}var l=!0;for(e=0;e<i.length;e++)l=i[e].update(t)&&l;return l},wu.prototype.getBoundingSphere=function(t,e){for(var i=this._items,a=i.length,r=0;r<a;r++){var n=i[r];if(n.contains(t))return n.getBoundingSphere(t,e)}return j.default.FAILED},wu.prototype.removeAllPrimitives=function(){for(var t=this._items,e=t.length,i=0;i<e;i++)t[i].destroy();this._items.length=0};var Au=wu,Pu=new b.default,Eu=new w.a,Cu=new w.a,ju=_.default.ZERO,Du=new _.default;function xu(t,e,i,a){this.translucent=e,this.width=i,this.shadows=a,this.primitives=t,this.createPrimitive=!1,this.waitingOnCreate=!1,this.primitive=void 0,this.oldPrimitive=void 0,this.geometry=new g.default,this.updaters=new g.default,this.updatersWithAttributes=new g.default,this.attributes=new g.default,this.itemsToRemove=[],this.subscriptions=new g.default,this.showsUpdated=new g.default}function Tu(t,e,i){this._primitives=t,this._scene=e,this._shadows=i,this._solidBatches=new g.default,this._translucentBatches=new g.default}xu.prototype.add=function(t,e){var i=t.id;if(this.createPrimitive=!0,this.geometry.set(i,e),this.updaters.set(i,t),t.hasConstantOutline&&t.outlineColorProperty.isConstant&&D.default.isConstant(t.distanceDisplayConditionProperty)&&D.default.isConstant(t.terrainOffsetProperty)){var a=this;this.subscriptions.set(i,t.entity.definitionChanged.addEventListener(function(e,i,r,n){"isShowing"===i&&a.showsUpdated.set(t.id,t)}))}else this.updatersWithAttributes.set(i,t)},xu.prototype.remove=function(t){var e=t.id;if(this.createPrimitive=this.geometry.remove(e)||this.createPrimitive,this.updaters.remove(e)){this.updatersWithAttributes.remove(e);var i=this.subscriptions.get(e);return Object(l.default)(i)&&(i(),this.subscriptions.remove(e),this.showsUpdated.remove(e)),!0}return!1},xu.prototype.update=function(t){var e,i=!0,a=0,r=this.primitive,n=this.primitives;if(this.createPrimitive){var o=this.geometry.values;if(o.length>0)Object(l.default)(r)&&(Object(l.default)(this.oldPrimitive)?n.remove(r):this.oldPrimitive=r),r=new vt.a({show:!1,asynchronous:!0,geometryInstances:o,appearance:new rt.a({flat:!0,translucent:this.translucent,renderState:{lineWidth:this.width}}),shadows:this.shadows}),n.add(r),i=!1;else{Object(l.default)(r)&&(n.remove(r),r=void 0);var s=this.oldPrimitive;Object(l.default)(s)&&(n.remove(s),this.oldPrimitive=void 0)}this.attributes.removeAll(),this.primitive=r,this.createPrimitive=!1,this.waitingOnCreate=!0}else if(Object(l.default)(r)&&r.ready){r.show=!0,Object(l.default)(this.oldPrimitive)&&(n.remove(this.oldPrimitive),this.oldPrimitive=void 0);var u=this.updatersWithAttributes.values,d=u.length,f=this.waitingOnCreate;for(e=0;e<d;e++){var c=u[e],h=this.geometry.get(c.id),p=this.attributes.get(h.id.id);if(Object(l.default)(p)||(p=r.getGeometryInstanceAttributes(h.id),this.attributes.set(h.id.id,p)),!c.outlineColorProperty.isConstant||f){var m=c.outlineColorProperty,g=D.default.getValueOrDefault(m,t,b.default.WHITE,Pu);b.default.equals(p._lastColor,g)||(p._lastColor=b.default.clone(g,p._lastColor),p.color=st.a.toValue(g,p.color),(this.translucent&&255===p.color[3]||!this.translucent&&255!==p.color[3])&&(this.itemsToRemove[a++]=c))}var y=c.entity.isShowing&&(c.hasConstantOutline||c.isOutlineVisible(t));y!==(1===p.show[0])&&(p.show=gt.a.toValue(y,p.show));var v=c.distanceDisplayConditionProperty;if(!D.default.isConstant(v)){var O=D.default.getValueOrDefault(v,t,Cu,Eu);w.a.equals(O,p._lastDistanceDisplayCondition)||(p._lastDistanceDisplayCondition=w.a.clone(O,p._lastDistanceDisplayCondition),p.distanceDisplayCondition=ft.toValue(O,p.distanceDisplayCondition))}var A=c.terrainOffsetProperty;if(!D.default.isConstant(A)){var P=D.default.getValueOrDefault(A,t,ju,Du);_.default.equals(P,p._lastOffset)||(p._lastOffset=_.default.clone(P,p._lastOffset),p.offset=mt.a.toValue(P,p.offset))}}this.updateShows(r),this.waitingOnCreate=!1}else Object(l.default)(r)&&!r.ready&&(i=!1);return this.itemsToRemove.length=a,i},xu.prototype.updateShows=function(t){for(var e=this.showsUpdated.values,i=e.length,a=0;a<i;a++){var r=e[a],n=this.geometry.get(r.id),o=this.attributes.get(n.id.id);Object(l.default)(o)||(o=t.getGeometryInstanceAttributes(n.id),this.attributes.set(n.id.id,o));var s=r.entity.isShowing;s!==(1===o.show[0])&&(o.show=gt.a.toValue(s,o.show),n.attributes.show.value[0]=o.show[0])}this.showsUpdated.removeAll()},xu.prototype.contains=function(t){return this.updaters.contains(t.id)},xu.prototype.getBoundingSphere=function(t,e){var i=this.primitive;if(!i.ready)return j.default.PENDING;var a=i.getGeometryInstanceAttributes(t.entity);return!Object(l.default)(a)||!Object(l.default)(a.boundingSphere)||Object(l.default)(a.show)&&0===a.show[0]?j.default.FAILED:(a.boundingSphere.clone(e),j.default.DONE)},xu.prototype.removeAllPrimitives=function(){var t=this.primitives,e=this.primitive;Object(l.default)(e)&&(t.remove(e),this.primitive=void 0,this.geometry.removeAll(),this.updaters.removeAll());var i=this.oldPrimitive;Object(l.default)(i)&&(t.remove(i),this.oldPrimitive=void 0)},Tu.prototype.add=function(t,e){var i,a,r=e.createOutlineGeometryInstance(t),n=this._scene.clampLineWidth(e.outlineWidth);255===r.attributes.color.value[3]?(a=(i=this._solidBatches).get(n),Object(l.default)(a)||(a=new xu(this._primitives,!1,n,this._shadows),i.set(n,a)),a.add(e,r)):(a=(i=this._translucentBatches).get(n),Object(l.default)(a)||(a=new xu(this._primitives,!0,n,this._shadows),i.set(n,a)),a.add(e,r))},Tu.prototype.remove=function(t){var e,i=this._solidBatches.values,a=i.length;for(e=0;e<a;e++)if(i[e].remove(t))return;var r=this._translucentBatches.values,n=r.length;for(e=0;e<n;e++)if(r[e].remove(t))return},Tu.prototype.update=function(t){var e,i,a,r,n,o=this._solidBatches.values,l=o.length,s=this._translucentBatches.values,u=s.length,d=!0,f=!1;do{for(f=!1,i=0;i<l;i++){d=(r=o[i]).update(t);var c=(n=r.itemsToRemove).length;if(c>0)for(f=!0,e=0;e<c;e++)a=n[e],r.remove(a),this.add(t,a)}for(i=0;i<u;i++){d=(r=s[i]).update(t);var h=(n=r.itemsToRemove).length;if(h>0)for(f=!0,e=0;e<h;e++)a=n[e],r.remove(a),this.add(t,a)}}while(f);return d},Tu.prototype.getBoundingSphere=function(t,e){var i,a=this._solidBatches.values,r=a.length;for(i=0;i<r;i++){var n=a[i];if(n.contains(t))return n.getBoundingSphere(t,e)}var o=this._translucentBatches.values,l=o.length;for(i=0;i<l;i++){var s=o[i];if(s.contains(t))return s.getBoundingSphere(t,e)}return j.default.FAILED},Tu.prototype.removeAllPrimitives=function(){var t,e=this._solidBatches.values,i=e.length;for(t=0;t<i;t++)e[t].removeAllPrimitives();var a=this._translucentBatches.values,r=a.length;for(t=0;t<r;t++)a[t].removeAllPrimitives()};var Iu=Tu,Mu={};function Vu(t,e){return Ut.default.equalsEpsilon(t.latitude,e.latitude,Ut.default.EPSILON14)&&Ut.default.equalsEpsilon(t.longitude,e.longitude,Ut.default.EPSILON14)}var Nu=new Ft.default,Su=new Ft.default;var Lu=new Array(2),Fu=new Array(2),Uu={positions:void 0,height:void 0,granularity:void 0,ellipsoid:void 0};Mu.computePositions=function(t,e,i,a,r,n){var o=function(t,e,i,a){var r=e.length;if(!(r<2)){var n=Object(l.default)(a),o=Object(l.default)(i),s=!0,u=new Array(r),d=new Array(r),f=new Array(r),c=e[0];u[0]=c;var h=t.cartesianToCartographic(c,Nu);o&&(h.height=i[0]),s=s&&h.height<=0,d[0]=h.height,f[0]=n?a[0]:0;for(var p=1,m=1;m<r;++m){var g=e[m],y=t.cartesianToCartographic(g,Su);o&&(y.height=i[m]),s=s&&y.height<=0,Vu(h,y)?h.height<y.height&&(d[p-1]=y.height):(u[p]=g,d[p]=y.height,f[p]=n?a[m]:0,Ft.default.clone(y,h),++p)}if(!(s||p<2))return u.length=p,d.length=p,f.length=p,{positions:u,topHeights:d,bottomHeights:f}}}(t,e,i,a);if(Object(l.default)(o)){if(e=o.positions,i=o.topHeights,a=o.bottomHeights,e.length>=3){var s=ne.default.fromPoints(e,t).projectPointsOntoPlane(e);bi.a.computeWindingOrder2D(s)===mo.default.CLOCKWISE&&(e.reverse(),i.reverse(),a.reverse())}var u,d,f=e.length,c=f-2,h=Ut.default.chordLength(r,t.maximumRadius),p=Uu;if(p.minDistance=h,p.ellipsoid=t,n){var m,g=0;for(m=0;m<f-1;m++)g+=ae.a.numberOfPoints(e[m],e[m+1],h)+1;u=new Float64Array(3*g),d=new Float64Array(3*g);var y=Lu,v=Fu;p.positions=y,p.height=v;var _=0;for(m=0;m<f-1;m++){y[0]=e[m],y[1]=e[m+1],v[0]=i[m],v[1]=i[m+1];var b=ae.a.generateArc(p);u.set(b,_),v[0]=a[m],v[1]=a[m+1],d.set(ae.a.generateArc(p),_),_+=b.length}}else p.positions=e,p.height=i,u=new Float64Array(ae.a.generateArc(p)),p.height=a,d=new Float64Array(ae.a.generateArc(p));return{bottomPositions:d,topPositions:u,numCorners:c}}};var Ru=Mu,Hu=new _.default,Bu=new _.default,Gu=new _.default,ku=new _.default,zu=new _.default,Wu=new _.default,Yu=new _.default,qu=new _.default;function Xu(t){var e=(t=Object(o.default)(t,o.default.EMPTY_OBJECT)).positions,i=t.maximumHeights,a=t.minimumHeights,r=Object(o.default)(t.vertexFormat,$.default.DEFAULT),n=Object(o.default)(t.granularity,Ut.default.RADIANS_PER_DEGREE),s=Object(o.default)(t.ellipsoid,mi.default.WGS84);this._positions=e,this._minimumHeights=a,this._maximumHeights=i,this._vertexFormat=$.default.clone(r),this._granularity=n,this._ellipsoid=mi.default.clone(s),this._workerName="createWallGeometry";var u=1+e.length*_.default.packedLength+2;Object(l.default)(a)&&(u+=a.length),Object(l.default)(i)&&(u+=i.length),this.packedLength=u+mi.default.packedLength+$.default.packedLength+1}Xu.pack=function(t,e,i){var a;i=Object(o.default)(i,0);var r=t._positions,n=r.length;for(e[i++]=n,a=0;a<n;++a,i+=_.default.packedLength)_.default.pack(r[a],e,i);var s=t._minimumHeights;if(n=Object(l.default)(s)?s.length:0,e[i++]=n,Object(l.default)(s))for(a=0;a<n;++a)e[i++]=s[a];var u=t._maximumHeights;if(n=Object(l.default)(u)?u.length:0,e[i++]=n,Object(l.default)(u))for(a=0;a<n;++a)e[i++]=u[a];return mi.default.pack(t._ellipsoid,e,i),i+=mi.default.packedLength,$.default.pack(t._vertexFormat,e,i),e[i+=$.default.packedLength]=t._granularity,e};var Zu=mi.default.clone(mi.default.UNIT_SPHERE),Ju=new $.default,Ku={positions:void 0,minimumHeights:void 0,maximumHeights:void 0,ellipsoid:Zu,vertexFormat:Ju,granularity:void 0};Xu.unpack=function(t,e,i){var a;e=Object(o.default)(e,0);var r,n,s=t[e++],u=new Array(s);for(a=0;a<s;++a,e+=_.default.packedLength)u[a]=_.default.unpack(t,e);if((s=t[e++])>0)for(r=new Array(s),a=0;a<s;++a)r[a]=t[e++];if((s=t[e++])>0)for(n=new Array(s),a=0;a<s;++a)n[a]=t[e++];var d=mi.default.unpack(t,e,Zu);e+=mi.default.packedLength;var f=$.default.unpack(t,e,Ju),c=t[e+=$.default.packedLength];return Object(l.default)(i)?(i._positions=u,i._minimumHeights=r,i._maximumHeights=n,i._ellipsoid=mi.default.clone(d,i._ellipsoid),i._vertexFormat=$.default.clone(f,i._vertexFormat),i._granularity=c,i):(Ku.positions=u,Ku.minimumHeights=r,Ku.maximumHeights=n,Ku.granularity=c,new Xu(Ku))},Xu.fromConstantHeights=function(t){var e,i,a=(t=Object(o.default)(t,o.default.EMPTY_OBJECT)).positions,r=t.minimumHeight,n=t.maximumHeight,s=Object(l.default)(r),u=Object(l.default)(n);if(s||u){var d=a.length;e=s?new Array(d):void 0,i=u?new Array(d):void 0;for(var f=0;f<d;++f)s&&(e[f]=r),u&&(i[f]=n)}return new Xu({positions:a,maximumHeights:i,minimumHeights:e,ellipsoid:t.ellipsoid,vertexFormat:t.vertexFormat})},Xu.createGeometry=function(t){var e=t._positions,i=t._minimumHeights,a=t._maximumHeights,n=t._vertexFormat,o=t._granularity,s=t._ellipsoid,u=Ru.computePositions(s,e,a,i,o,!0);if(Object(l.default)(u)){var d,f=u.bottomPositions,c=u.topPositions,h=u.numCorners,p=c.length,m=2*p,g=n.position?new Float64Array(m):void 0,y=n.normal?new Float32Array(m):void 0,v=n.tangent?new Float32Array(m):void 0,b=n.bitangent?new Float32Array(m):void 0,O=n.st?new Float32Array(m/3*2):void 0,w=0,A=0,P=0,E=0,C=0,j=qu,D=Yu,x=Wu,T=!0,I=0,M=1/((p/=3)-e.length+1);for(d=0;d<p;++d){var V=3*d,N=_.default.fromArray(c,V,Hu),S=_.default.fromArray(f,V,Bu);if(n.position&&(g[w++]=S.x,g[w++]=S.y,g[w++]=S.z,g[w++]=N.x,g[w++]=N.y,g[w++]=N.z),n.st&&(O[C++]=I,O[C++]=0,O[C++]=I,O[C++]=1),n.normal||n.tangent||n.bitangent){var L,F=_.default.clone(_.default.ZERO,zu),U=s.scaleToGeodeticSurface(_.default.fromArray(c,V,Bu),Bu);if(d+1<p&&(L=s.scaleToGeodeticSurface(_.default.fromArray(c,V+3,Gu),Gu),F=_.default.fromArray(c,V+3,zu)),T){var R=_.default.subtract(F,N,ku),H=_.default.subtract(U,N,Hu);j=_.default.normalize(_.default.cross(H,R,j),j),T=!1}_.default.equalsEpsilon(L,U,Ut.default.EPSILON10)?T=!0:(I+=M,n.tangent&&(D=_.default.normalize(_.default.subtract(L,U,D),D)),n.bitangent&&(x=_.default.normalize(_.default.cross(j,D,x),x))),n.normal&&(y[A++]=j.x,y[A++]=j.y,y[A++]=j.z,y[A++]=j.x,y[A++]=j.y,y[A++]=j.z),n.tangent&&(v[E++]=D.x,v[E++]=D.y,v[E++]=D.z,v[E++]=D.x,v[E++]=D.y,v[E++]=D.z),n.bitangent&&(b[P++]=x.x,b[P++]=x.y,b[P++]=x.z,b[P++]=x.x,b[P++]=x.y,b[P++]=x.z)}}var B=new vi.a;n.position&&(B.position=new yi.a({componentDatatype:ut.a.DOUBLE,componentsPerAttribute:3,values:g})),n.normal&&(B.normal=new yi.a({componentDatatype:ut.a.FLOAT,componentsPerAttribute:3,values:y})),n.tangent&&(B.tangent=new yi.a({componentDatatype:ut.a.FLOAT,componentsPerAttribute:3,values:v})),n.bitangent&&(B.bitangent=new yi.a({componentDatatype:ut.a.FLOAT,componentsPerAttribute:3,values:b})),n.st&&(B.st=new yi.a({componentDatatype:ut.a.FLOAT,componentsPerAttribute:2,values:O}));var G=m/3;m-=6*(h+1);var k=_i.a.createTypedArray(G,m),z=0;for(d=0;d<G-2;d+=2){var W=d,Y=d+2,q=_.default.fromArray(g,3*W,Hu),X=_.default.fromArray(g,3*Y,Bu);if(!_.default.equalsEpsilon(q,X,Ut.default.EPSILON10)){var Z=d+1,J=d+3;k[z++]=Z,k[z++]=W,k[z++]=J,k[z++]=J,k[z++]=W,k[z++]=Y}}return new gi.a({attributes:B,indices:k,primitiveType:Oi.a.TRIANGLES,boundingSphere:new r.default.fromVertices(g)})}};var Qu=Xu,$u=new _.default,td=new _.default;function ed(t){var e=(t=Object(o.default)(t,o.default.EMPTY_OBJECT)).positions,i=t.maximumHeights,a=t.minimumHeights,r=Object(o.default)(t.granularity,Ut.default.RADIANS_PER_DEGREE),n=Object(o.default)(t.ellipsoid,mi.default.WGS84);this._positions=e,this._minimumHeights=a,this._maximumHeights=i,this._granularity=r,this._ellipsoid=mi.default.clone(n),this._workerName="createWallOutlineGeometry";var s=1+e.length*_.default.packedLength+2;Object(l.default)(a)&&(s+=a.length),Object(l.default)(i)&&(s+=i.length),this.packedLength=s+mi.default.packedLength+1}ed.pack=function(t,e,i){var a;i=Object(o.default)(i,0);var r=t._positions,n=r.length;for(e[i++]=n,a=0;a<n;++a,i+=_.default.packedLength)_.default.pack(r[a],e,i);var s=t._minimumHeights;if(n=Object(l.default)(s)?s.length:0,e[i++]=n,Object(l.default)(s))for(a=0;a<n;++a)e[i++]=s[a];var u=t._maximumHeights;if(n=Object(l.default)(u)?u.length:0,e[i++]=n,Object(l.default)(u))for(a=0;a<n;++a)e[i++]=u[a];return mi.default.pack(t._ellipsoid,e,i),e[i+=mi.default.packedLength]=t._granularity,e};var id=mi.default.clone(mi.default.UNIT_SPHERE),ad={positions:void 0,minimumHeights:void 0,maximumHeights:void 0,ellipsoid:id,granularity:void 0};ed.unpack=function(t,e,i){var a;e=Object(o.default)(e,0);var r,n,s=t[e++],u=new Array(s);for(a=0;a<s;++a,e+=_.default.packedLength)u[a]=_.default.unpack(t,e);if((s=t[e++])>0)for(r=new Array(s),a=0;a<s;++a)r[a]=t[e++];if((s=t[e++])>0)for(n=new Array(s),a=0;a<s;++a)n[a]=t[e++];var d=mi.default.unpack(t,e,id),f=t[e+=mi.default.packedLength];return Object(l.default)(i)?(i._positions=u,i._minimumHeights=r,i._maximumHeights=n,i._ellipsoid=mi.default.clone(d,i._ellipsoid),i._granularity=f,i):(ad.positions=u,ad.minimumHeights=r,ad.maximumHeights=n,ad.granularity=f,new ed(ad))},ed.fromConstantHeights=function(t){var e,i,a=(t=Object(o.default)(t,o.default.EMPTY_OBJECT)).positions,r=t.minimumHeight,n=t.maximumHeight,s=Object(l.default)(r),u=Object(l.default)(n);if(s||u){var d=a.length;e=s?new Array(d):void 0,i=u?new Array(d):void 0;for(var f=0;f<d;++f)s&&(e[f]=r),u&&(i[f]=n)}return new ed({positions:a,maximumHeights:i,minimumHeights:e,ellipsoid:t.ellipsoid})},ed.createGeometry=function(t){var e=t._positions,i=t._minimumHeights,a=t._maximumHeights,n=t._granularity,o=t._ellipsoid,s=Ru.computePositions(o,e,a,i,n,!1);if(Object(l.default)(s)){var u,d=s.bottomPositions,f=s.topPositions,c=f.length,h=2*c,p=new Float64Array(h),m=0;for(c/=3,u=0;u<c;++u){var g=3*u,y=_.default.fromArray(f,g,$u),v=_.default.fromArray(d,g,td);p[m++]=v.x,p[m++]=v.y,p[m++]=v.z,p[m++]=y.x,p[m++]=y.y,p[m++]=y.z}var b=new vi.a({position:new yi.a({componentDatatype:ut.a.DOUBLE,componentsPerAttribute:3,values:p})}),O=h/3;h=2*O-4+O;var w=_i.a.createTypedArray(O,h),A=0;for(u=0;u<O-2;u+=2){var P=u,E=u+2,C=_.default.fromArray(p,3*P,$u),j=_.default.fromArray(p,3*E,td);if(!_.default.equalsEpsilon(C,j,Ut.default.EPSILON10)){var D=u+1,x=u+3;w[A++]=D,w[A++]=P,w[A++]=D,w[A++]=x,w[A++]=P,w[A++]=E}}return w[A++]=O-2,w[A++]=O-1,new gi.a({attributes:b,indices:w,primitiveType:Oi.a.LINES,boundingSphere:new r.default.fromVertices(p)})}};var rd=ed,nd=new b.default;function od(t){this.id=t,this.vertexFormat=void 0,this.positions=void 0,this.minimumHeights=void 0,this.maximumHeights=void 0,this.granularity=void 0}function ld(t,e){St.call(this,{entity:t,scene:e,geometryOptions:new od(t),geometryPropertyName:"wall",observedPropertyNames:["availability","wall"]}),this._onEntityPropertyChanged(t,"wall",t.wall,void 0)}function sd(t,e,i){wt.call(this,t,e,i)}Object(l.default)(Object.create)&&(ld.prototype=Object.create(St.prototype),ld.prototype.constructor=ld),ld.prototype.createFillGeometryInstance=function(t){var e,i,a=this._entity,r=a.isAvailable(t),n=new gt.a(r&&a.isShowing&&this._showProperty.getValue(t)&&this._fillProperty.getValue(t)),o=this._distanceDisplayConditionProperty.getValue(t),s=ft.fromDistanceDisplayCondition(o);this._materialProperty instanceof yt.default?(Object(l.default)(this._materialProperty.color)&&(this._materialProperty.color.isConstant||r)&&(i=this._materialProperty.color.getValue(t,nd)),Object(l.default)(i)||(i=b.default.WHITE),e={show:n,distanceDisplayCondition:s,color:st.a.fromColor(i)}):e={show:n,distanceDisplayCondition:s};return new ct.a({id:a,geometry:new Qu(this._options),attributes:e})},ld.prototype.createOutlineGeometryInstance=function(t){var e=this._entity,i=e.isAvailable(t),a=D.default.getValueOrDefault(this._outlineColorProperty,t,b.default.BLACK,nd),r=this._distanceDisplayConditionProperty.getValue(t);return new ct.a({id:e,geometry:new rd(this._options),attributes:{show:new gt.a(i&&e.isShowing&&this._showProperty.getValue(t)&&this._showOutlineProperty.getValue(t)),color:st.a.fromColor(a),distanceDisplayCondition:ft.fromDistanceDisplayCondition(r)}})},ld.prototype._isHidden=function(t,e){return!Object(l.default)(e.positions)||St.prototype._isHidden.call(this,t,e)},ld.prototype._getIsClosed=function(t){return!1},ld.prototype._isDynamic=function(t,e){return!(e.positions.isConstant&&D.default.isConstant(e.minimumHeights)&&D.default.isConstant(e.maximumHeights)&&D.default.isConstant(e.outlineWidth)&&D.default.isConstant(e.granularity))},ld.prototype._setStaticOptions=function(t,e){var i=e.minimumHeights,a=e.maximumHeights,r=e.granularity,n=this._materialProperty instanceof yt.default,o=this._options;o.vertexFormat=n?rt.a.VERTEX_FORMAT:at.MaterialSupport.TEXTURED.vertexFormat,o.positions=e.positions.getValue(pt.default.MINIMUM_VALUE,o.positions),o.minimumHeights=Object(l.default)(i)?i.getValue(pt.default.MINIMUM_VALUE,o.minimumHeights):void 0,o.maximumHeights=Object(l.default)(a)?a.getValue(pt.default.MINIMUM_VALUE,o.maximumHeights):void 0,o.granularity=Object(l.default)(r)?r.getValue(pt.default.MINIMUM_VALUE):void 0},ld.DynamicGeometryUpdater=sd,Object(l.default)(Object.create)&&(sd.prototype=Object.create(wt.prototype),sd.prototype.constructor=sd),sd.prototype._isHidden=function(t,e,i){return!Object(l.default)(this._options.positions)||wt.prototype._isHidden.call(this,t,e,i)},sd.prototype._setOptions=function(t,e,i){var a=this._options;a.positions=D.default.getValueOrUndefined(e.positions,i,a.positions),a.minimumHeights=D.default.getValueOrUndefined(e.minimumHeights,i,a.minimumHeights),a.maximumHeights=D.default.getValueOrUndefined(e.maximumHeights,i,a.maximumHeights),a.granularity=D.default.getValueOrUndefined(e.granularity,i)};var ud=[],dd=[Qt,Ua,pa,qr,ln,In,hl,xl,bs,ld];function fd(t,e){this.entity=t,this.scene=e;var i=new Array(dd.length),a=new J.default;function r(t){a.raiseEvent(t)}for(var n=new d.default,o=0;o<i.length;o++){var l=new dd[o](t,e);n.add(l.geometryChanged,r),i[o]=l}this.updaters=i,this.geometryChanged=a,this.eventHelper=n,this._removeEntitySubscription=t.definitionChanged.addEventListener(fd.prototype._onEntityPropertyChanged,this)}function cd(t,e,i,a){i=Object(o.default)(i,t.primitives),a=Object(o.default)(a,t.groundPrimitives),this._scene=t,this._primitives=i,this._groundPrimitives=a,this._entityCollection=void 0,this._addedObjects=new g.default,this._removedObjects=new g.default,this._changedObjects=new g.default;var r=nt.a.NUMBER_OF_SHADOW_MODES;this._outlineBatches=new Array(2*r),this._closedColorBatches=new Array(2*r),this._closedMaterialBatches=new Array(2*r),this._openColorBatches=new Array(2*r),this._openMaterialBatches=new Array(2*r);var n,l=Et.default.supportsMaterialsforEntitiesOnTerrain(t);for(this._supportsMaterialsforEntitiesOnTerrain=l,n=0;n<r;++n)this._outlineBatches[n]=new Iu(i,t,n,!1),this._outlineBatches[r+n]=new Iu(i,t,n,!0),this._closedColorBatches[n]=new Vs(i,rt.a,void 0,!0,n,!0),this._closedColorBatches[r+n]=new Vs(i,rt.a,void 0,!0,n,!1),this._closedMaterialBatches[n]=new Bs(i,at,void 0,!0,n,!0),this._closedMaterialBatches[r+n]=new Bs(i,at,void 0,!0,n,!1),this._openColorBatches[n]=new Vs(i,rt.a,void 0,!1,n,!0),this._openColorBatches[r+n]=new Vs(i,rt.a,void 0,!1,n,!1),this._openMaterialBatches[n]=new Bs(i,at,void 0,!1,n,!0),this._openMaterialBatches[r+n]=new Bs(i,at,void 0,!1,n,!1);var s=K.a.NUMBER_OF_CLASSIFICATION_TYPES,u=new Array(s),d=[];if(l)for(n=0;n<s;++n)d.push(new Au(a,n,at)),u[n]=new Au(a,n,rt.a);else for(n=0;n<s;++n)u[n]=new Xs(a,n);this._groundColorBatches=u,this._groundMaterialBatches=d,this._dynamicBatch=new Ha(i,a),this._batches=this._outlineBatches.concat(this._closedColorBatches,this._closedMaterialBatches,this._openColorBatches,this._openMaterialBatches,this._groundColorBatches,this._groundMaterialBatches,this._dynamicBatch),this._subscriptions=new g.default,this._updaterSets=new g.default,this._entityCollection=e,e.collectionChanged.addEventListener(cd.prototype._onCollectionChanged,this),this._onCollectionChanged(e,e.values,ud)}fd.prototype._onEntityPropertyChanged=function(t,e,i,a){for(var r=this.updaters,n=0;n<r.length;n++)r[n]._onEntityPropertyChanged(t,e,i,a)},fd.prototype.forEach=function(t){for(var e=this.updaters,i=0;i<e.length;i++)t(e[i])},fd.prototype.destroy=function(){this.eventHelper.removeAll();for(var t=this.updaters,e=0;e<t.length;e++)t[e].destroy();this._removeEntitySubscription(),Object(u.default)(this)},cd.prototype.update=function(t){var e,i,a,r,n=this._addedObjects,o=n.values,l=this._removedObjects,s=l.values,u=this._changedObjects,d=u.values,f=this;for(e=d.length-1;e>-1;e--)a=(i=d[e]).id,(r=this._updaterSets.get(a)).entity===i?r.forEach(function(e){f._removeUpdater(e),f._insertUpdaterIntoBatch(t,e)}):(s.push(i),o.push(i));for(e=s.length-1;e>-1;e--)a=(i=s[e]).id,(r=this._updaterSets.get(a)).forEach(this._removeUpdater.bind(this)),r.destroy(),this._updaterSets.remove(a),this._subscriptions.get(a)(),this._subscriptions.remove(a);for(e=o.length-1;e>-1;e--)a=(i=o[e]).id,r=new fd(i,this._scene),this._updaterSets.set(a,r),r.forEach(function(e){f._insertUpdaterIntoBatch(t,e)}),this._subscriptions.set(a,r.geometryChanged.addEventListener(cd._onGeometryChanged,this));n.removeAll(),l.removeAll(),u.removeAll();var c=!0,h=this._batches,p=h.length;for(e=0;e<p;e++)c=h[e].update(t)&&c;return c};var hd=[],pd=new r.default;cd.prototype.getBoundingSphere=function(t,e){for(var i=hd,a=pd,n=0,o=j.default.DONE,l=this._batches,s=l.length,u=t.id,d=this._updaterSets.get(u).updaters,f=0;f<d.length;f++)for(var c=d[f],h=0;h<s;h++){if((o=l[h].getBoundingSphere(c,a))===j.default.PENDING)return j.default.PENDING;o===j.default.DONE&&(i[n]=r.default.clone(a,i[n]),n++)}return 0===n?j.default.FAILED:(i.length=n,r.default.fromBoundingSpheres(i,e),j.default.DONE)},cd.prototype.isDestroyed=function(){return!1},cd.prototype.destroy=function(){var t;this._entityCollection.collectionChanged.removeEventListener(cd.prototype._onCollectionChanged,this),this._addedObjects.removeAll(),this._removedObjects.removeAll();var e=this._batches,i=e.length;for(t=0;t<i;t++)e[t].removeAllPrimitives();var a=this._subscriptions.values;for(i=a.length,t=0;t<i;t++)a[t]();this._subscriptions.removeAll();var r=this._updaterSets.values;for(i=r.length,t=0;t<i;t++)r[t].destroy();return this._updaterSets.removeAll(),Object(u.default)(this)},cd.prototype._removeUpdater=function(t){for(var e=this._batches,i=e.length,a=0;a<i;a++)e[a].remove(t)},cd.prototype._insertUpdaterIntoBatch=function(t,e){if(e.isDynamic)this._dynamicBatch.add(t,e);else{var i;(e.outlineEnabled||e.fillEnabled)&&(i=e.shadowsProperty.getValue(t));var a=nt.a.NUMBER_OF_SHADOW_MODES;if(e.outlineEnabled&&(Object(l.default)(e.terrainOffsetProperty)?this._outlineBatches[a+i].add(t,e):this._outlineBatches[i].add(t,e)),e.fillEnabled)if(e.onTerrain){var r=e.classificationTypeProperty.getValue(t);e.fillMaterialProperty instanceof yt.default?this._groundColorBatches[r].add(t,e):this._groundMaterialBatches[r].add(t,e)}else e.isClosed?e.fillMaterialProperty instanceof yt.default?Object(l.default)(e.terrainOffsetProperty)?this._closedColorBatches[a+i].add(t,e):this._closedColorBatches[i].add(t,e):Object(l.default)(e.terrainOffsetProperty)?this._closedMaterialBatches[a+i].add(t,e):this._closedMaterialBatches[i].add(t,e):e.fillMaterialProperty instanceof yt.default?Object(l.default)(e.terrainOffsetProperty)?this._openColorBatches[a+i].add(t,e):this._openColorBatches[i].add(t,e):Object(l.default)(e.terrainOffsetProperty)?this._openMaterialBatches[a+i].add(t,e):this._openMaterialBatches[i].add(t,e)}},cd._onGeometryChanged=function(t){var e=this._removedObjects,i=this._changedObjects,a=t.entity,r=a.id;Object(l.default)(e.get(r))||Object(l.default)(i.get(r))||i.set(r,a)},cd.prototype._onCollectionChanged=function(t,e,i){var a,r,n,o=this._addedObjects,l=this._removedObjects,s=this._changedObjects;for(a=i.length-1;a>-1;a--)r=(n=i[a]).id,o.remove(r)||(l.set(r,n),s.remove(r));for(a=e.length-1;a>-1;a--)r=(n=e[a]).id,l.remove(r)?s.set(r,n):o.set(r,n)};var md=cd,gd=i(185),yd=gd.a.FILL,vd=b.default.WHITE,_d=b.default.BLACK,bd=new b.default(.165,.165,.165,.8),Od=new v.default(7,5),wd=v.default.ZERO,Ad=_.default.ZERO,Pd=P.default.NONE,Ed=E.default.CENTER,Cd=C.default.CENTER,jd=new _.default,Dd=new b.default,xd=new b.default,Td=new b.default,Id=new v.default,Md=new _.default,Vd=new v.default,Nd=new A.a,Sd=new A.a,Ld=new A.a,Fd=new w.a;function Ud(t){this.entity=t,this.label=void 0,this.index=void 0}function Rd(t,e){e.collectionChanged.addEventListener(Rd.prototype._onCollectionChanged,this),this._cluster=t,this._entityCollection=e,this._items=new g.default,this._onCollectionChanged(e,e.values,[],[])}function Hd(t,e,i){Object(l.default)(t)&&(t.label=void 0,i.removeLabel(e))}Rd.prototype.update=function(t){for(var e=this._items.values,i=this._cluster,a=0,r=e.length;a<r;a++){var n,o,s=e[a],u=s.entity,d=u._label,f=s.label,c=u.isShowing&&u.isAvailable(t)&&D.default.getValueOrDefault(d._show,t,!0);if(c&&(o=D.default.getValueOrUndefined(u._position,t,jd),n=D.default.getValueOrUndefined(d._text,t),c=Object(l.default)(o)&&Object(l.default)(n)),c){D.default.isConstant(u._position)||(i._clusterDirty=!0);var h=!1,p=D.default.getValueOrDefault(d._heightReference,t,Pd);Object(l.default)(f)||((f=i.getLabel(u)).id=u,s.label=f,h=_.default.equals(f.position,o)&&f.heightReference===p),f.show=!0,f.position=o,f.text=n,f.scale=D.default.getValueOrDefault(d._scale,t,1),f.font=D.default.getValueOrDefault(d._font,t,"30px sans-serif"),f.style=D.default.getValueOrDefault(d._style,t,yd),f.fillColor=D.default.getValueOrDefault(d._fillColor,t,vd,Dd),f.outlineColor=D.default.getValueOrDefault(d._outlineColor,t,_d,xd),f.outlineWidth=D.default.getValueOrDefault(d._outlineWidth,t,1),f.showBackground=D.default.getValueOrDefault(d._showBackground,t,!1),f.backgroundColor=D.default.getValueOrDefault(d._backgroundColor,t,bd,Td),f.backgroundPadding=D.default.getValueOrDefault(d._backgroundPadding,t,Od,Id),f.pixelOffset=D.default.getValueOrDefault(d._pixelOffset,t,wd,Vd),f.eyeOffset=D.default.getValueOrDefault(d._eyeOffset,t,Ad,Md),f.heightReference=p,f.horizontalOrigin=D.default.getValueOrDefault(d._horizontalOrigin,t,Ed),f.verticalOrigin=D.default.getValueOrDefault(d._verticalOrigin,t,Cd),f.translucencyByDistance=D.default.getValueOrUndefined(d._translucencyByDistance,t,Nd),f.pixelOffsetScaleByDistance=D.default.getValueOrUndefined(d._pixelOffsetScaleByDistance,t,Sd),f.scaleByDistance=D.default.getValueOrUndefined(d._scaleByDistance,t,Ld),f.distanceDisplayCondition=D.default.getValueOrUndefined(d._distanceDisplayCondition,t,Fd),f.disableDepthTestDistance=D.default.getValueOrUndefined(d._disableDepthTestDistance,t),h&&f._updateClamping()}else Hd(s,u,i)}return!0},Rd.prototype.getBoundingSphere=function(t,e){var i=this._items.get(t.id);if(!Object(l.default)(i)||!Object(l.default)(i.label))return j.default.FAILED;var a=i.label;return e.center=_.default.clone(Object(o.default)(a._clampedPosition,a.position),e.center),e.radius=0,j.default.DONE},Rd.prototype.isDestroyed=function(){return!1},Rd.prototype.destroy=function(){this._entityCollection.collectionChanged.removeEventListener(Rd.prototype._onCollectionChanged,this);for(var t=this._entityCollection.values,e=0;e<t.length;e++)this._cluster.removeLabel(t[e]);return Object(u.default)(this)},Rd.prototype._onCollectionChanged=function(t,e,i,a){var r,n,o=this._items,s=this._cluster;for(r=e.length-1;r>-1;r--)n=e[r],Object(l.default)(n._label)&&Object(l.default)(n._position)&&o.set(n.id,new Ud(n));for(r=a.length-1;r>-1;r--)n=a[r],Object(l.default)(n._label)&&Object(l.default)(n._position)?o.contains(n.id)||o.set(n.id,new Ud(n)):(Hd(o.get(n.id),n,s),o.remove(n.id));for(r=i.length-1;r>-1;r--)n=i[r],Hd(o.get(n.id),n,s),o.remove(n.id)};var Bd=Rd,Gd=i(107),kd=i(31),zd=i(400),Wd=i(343),Yd=i(276),qd=nt.a.ENABLED,Xd=P.default.NONE,Zd=b.default.RED,Jd=b.default.WHITE,Kd=zd.a.HIGHLIGHT,Qd=new v.default(1,1),$d=Gd.a.Y,tf=new oe.default,ef=new oe.default;function af(t,e){e.collectionChanged.addEventListener(af.prototype._onCollectionChanged,this),this._scene=t,this._primitives=t.primitives,this._entityCollection=e,this._modelHash={},this._entitiesToVisualize=new g.default,this._onCollectionChanged(e,e.values,[],[])}function rf(t,e,i,a){var r=i[e.id];Object(l.default)(r)&&(a.removeAndDestroy(r.modelPrimitive),delete i[e.id])}function nf(t,e){var i=e[t.id];Object(l.default)(i)&&(i.nodeTransformationsScratch={},i.articulationsScratch={})}function of(t,e,i){t.readyPromise.otherwise(function(t){console.error(t),i[e.id].loadFail=!0})}af.prototype.update=function(t){for(var e=this._entitiesToVisualize.values,i=this._modelHash,a=this._primitives,r=0,n=e.length;r<n;r++){var o,s,u=e[r],d=u._model,f=i[u.id],c=u.isShowing&&u.isAvailable(t)&&D.default.getValueOrDefault(d._show,t,!0);if(c&&(s=u.computeModelMatrix(t,tf),o=kd.default.createIfNeeded(D.default.getValueOrUndefined(d._uri,t)),c=Object(l.default)(s)&&Object(l.default)(o)),c){var h=Object(l.default)(f)?f.modelPrimitive:void 0;if(Object(l.default)(h)&&o.url===f.url||(Object(l.default)(h)&&(a.removeAndDestroy(h),delete i[u.id]),(h=Wd.a.fromGltf({url:o,incrementallyLoadTextures:D.default.getValueOrDefault(d._incrementallyLoadTextures,t,!0),scene:this._scene})).id=u,a.add(h),f={modelPrimitive:h,url:o.url,animationsRunning:!1,nodeTransformationsScratch:{},articulationsScratch:{},loadFail:!1},i[u.id]=f,of(h,u,i)),h.show=!0,h.scale=D.default.getValueOrDefault(d._scale,t,1),h.minimumPixelSize=D.default.getValueOrDefault(d._minimumPixelSize,t,0),h.maximumScale=D.default.getValueOrUndefined(d._maximumScale,t),h.modelMatrix=oe.default.clone(s,h.modelMatrix),h.shadows=D.default.getValueOrDefault(d._shadows,t,qd),h.heightReference=D.default.getValueOrDefault(d._heightReference,t,Xd),h.distanceDisplayCondition=D.default.getValueOrUndefined(d._distanceDisplayCondition,t),h.silhouetteColor=D.default.getValueOrDefault(d._silhouetteColor,t,Zd,h._silhouetteColor),h.silhouetteSize=D.default.getValueOrDefault(d._silhouetteSize,t,0),h.color=D.default.getValueOrDefault(d._color,t,Jd,h._color),h.colorBlendMode=D.default.getValueOrDefault(d._colorBlendMode,t,Kd),h.colorBlendAmount=D.default.getValueOrDefault(d._colorBlendAmount,t,.5),h.clippingPlanes=D.default.getValueOrUndefined(d._clippingPlanes,t),h.clampAnimations=D.default.getValueOrDefault(d._clampAnimations,t,!0),h.imageBasedLightingFactor=D.default.getValueOrDefault(d._imageBasedLightingFactor,t,Qd),h.lightColor=D.default.getValueOrUndefined(d._lightColor,t),h._upAxis=D.default.getValueOrDefault(d._upAxis,t,$d),h._forwardAxis=D.default.getValueOrUndefined(d._forwardAxis,t),h.ready){var p=D.default.getValueOrDefault(d._runAnimations,t,!0);f.animationsRunning!==p&&(p?h.activeAnimations.addAll({loop:Yd.a.REPEAT}):h.activeAnimations.removeAll(),f.animationsRunning=p);var m=D.default.getValueOrUndefined(d._nodeTransformations,t,f.nodeTransformationsScratch);if(Object(l.default)(m))for(var g=Object.keys(m),y=0,v=g.length;y<v;++y){var _=g[y],b=m[_];if(Object(l.default)(b)){var O=h.getNode(_);if(Object(l.default)(O)){var w=oe.default.fromTranslationRotationScale(b,ef);O.matrix=oe.default.multiply(O.originalMatrix,w,w)}}}var A=!1,P=D.default.getValueOrUndefined(d._articulations,t,f.articulationsScratch);if(Object(l.default)(P))for(var E=Object.keys(P),C=0,j=E.length;C<j;++C){var x=E[C],T=P[x];Object(l.default)(T)&&(A=!0,h.setArticulationStage(x,T))}A&&h.applyArticulations()}}else Object(l.default)(f)&&(f.modelPrimitive.show=!1)}return!0},af.prototype.isDestroyed=function(){return!1},af.prototype.destroy=function(){this._entityCollection.collectionChanged.removeEventListener(af.prototype._onCollectionChanged,this);for(var t=this._entitiesToVisualize.values,e=this._modelHash,i=this._primitives,a=t.length-1;a>-1;a--)rf(this,t[a],e,i);return Object(u.default)(this)},af.prototype.getBoundingSphere=function(t,e){var i=this._modelHash[t.id];if(!Object(l.default)(i)||i.loadFail)return j.default.FAILED;var a=i.modelPrimitive;if(!Object(l.default)(a)||!a.show)return j.default.FAILED;if(!a.ready)return j.default.PENDING;if(a.heightReference===P.default.NONE)r.default.transform(a.boundingSphere,a.modelMatrix,e);else{if(!Object(l.default)(a._clampedModelMatrix)||a._heightChanged)return j.default.PENDING;r.default.transform(a.boundingSphere,a._clampedModelMatrix,e)}return j.default.DONE},af.prototype._onCollectionChanged=function(t,e,i,a){var r,n,o=this._entitiesToVisualize,s=this._modelHash,u=this._primitives;for(r=e.length-1;r>-1;r--)n=e[r],Object(l.default)(n._model)&&Object(l.default)(n._position)&&o.set(n.id,n);for(r=a.length-1;r>-1;r--)n=a[r],Object(l.default)(n._model)&&Object(l.default)(n._position)?(nf(n,s),o.set(n.id,n)):(rf(this,n,s,u),o.remove(n.id));for(r=i.length-1;r>-1;r--)rf(this,n=i[r],s,u),o.remove(n.id)};var lf=af,sf=i(18),uf=i(184),df=i(84),ff=i(529),cf=i(1594),hf=i(316),pf=i(1595),mf=i(704),gf=i(1596),yf=i(705),vf=new df.default,_f=new df.default,bf=new df.default;function Of(t){this.entity=t,this.polyline=void 0,this.index=void 0,this.updater=void 0}function wf(t,e,i,a,r,n,o,s){for(;t instanceof pf.a;)t=t.resolvedProperty;t instanceof mf.default?o=function(t,e,i,a,r,n,o,s,u){var d,f=s;d=t.getValueInReferenceFrame(e,n,u[f]),Object(l.default)(d)&&(u[f++]=d);for(var c,h,p,m=!Object(l.default)(r)||sf.default.lessThanOrEquals(r,e)||sf.default.greaterThanOrEquals(r,i),g=0,y=a.length,v=a[g],_=i,b=!1;g<y;){if(!m&&sf.default.greaterThanOrEquals(v,r)&&(d=t.getValueInReferenceFrame(r,n,u[f]),Object(l.default)(d)&&(u[f++]=d),m=!0),sf.default.greaterThan(v,e)&&sf.default.lessThan(v,_)&&!v.equals(r)&&(d=t.getValueInReferenceFrame(v,n,u[f]),Object(l.default)(d)&&(u[f++]=d)),g<y-1){if(o>0&&!b){var O=a[g+1],w=sf.default.secondsDifference(O,v);(b=w>o)&&(c=Math.ceil(w/o),h=0,p=w/Math.max(c,2),c=Math.max(c-1,1))}if(b&&h<c){v=sf.default.addSeconds(v,p,new sf.default),h++;continue}}b=!1,v=a[++g]}return d=t.getValueInReferenceFrame(i,n,u[f]),Object(l.default)(d)&&(u[f++]=d),f}(t,e,i,t._property._times,a,r,n,o,s):o=t instanceof cf.a?function(t,e,i,a,r,n,o,l){_f.start=e,_f.stop=i;for(var s=o,u=t.intervals,d=0;d<u.length;d++){var f=u.get(d);if(!df.default.intersect(f,_f,vf).isEmpty){var c=f.start,h=f.stop,p=e;sf.default.greaterThan(c,p)&&(p=c);var m=i;sf.default.lessThan(h,m)&&(m=h),s=wf(f.data,p,m,a,r,n,s,l)}}return s}(t,e,i,a,r,n,o,s):t instanceof yf.default?function(t,e,i,a,r,n,o,s){bf.start=e,bf.stop=i;for(var u=o,d=t.intervals,f=0;f<d.length;f++){var c=d.get(f);if(!df.default.intersect(c,bf,vf).isEmpty){var h=c.start;c.isStartIncluded||(h=c.isStopIncluded?c.stop:sf.default.addSeconds(c.start,sf.default.secondsDifference(c.stop,c.start)/2,new sf.default));var p=t.getValueInReferenceFrame(h,r,s[u]);Object(l.default)(p)&&(s[u]=p,u++)}}return u}(t,e,i,0,r,0,o,s):t instanceof hf.default||t instanceof gf.a&&D.default.isConstant(t)?function(t,e,i,a,r,n,o,s){var u=t.getValueInReferenceFrame(e,r,s[o]);return Object(l.default)(u)&&(s[o++]=u),o}(t,e,0,0,r,0,o,s):function(t,e,i,a,r,n,o,s){for(var u,d=0,f=o,c=e,h=Math.max(n,60),p=!Object(l.default)(a)||sf.default.lessThanOrEquals(a,e)||sf.default.greaterThanOrEquals(a,i);sf.default.lessThan(c,i);)!p&&sf.default.greaterThanOrEquals(c,a)&&(p=!0,u=t.getValueInReferenceFrame(a,r,s[f]),Object(l.default)(u)&&(s[f]=u,f++)),u=t.getValueInReferenceFrame(c,r,s[f]),Object(l.default)(u)&&(s[f]=u,f++),d++,c=sf.default.addSeconds(e,h*d,new sf.default);return u=t.getValueInReferenceFrame(i,r,s[f]),Object(l.default)(u)&&(s[f]=u,f++),f}(t,e,i,a,r,n,o,s);return o}function Af(t,e,i,a,r,n,o){Object(l.default)(o)||(o=[]);var s=wf(t,e,i,a,r,n,0,o);return o.length=s,o}var Pf=new ie.default;function Ef(t,e){this._unusedIndexes=[],this._polylineCollection=new ff.a,this._scene=t,this._referenceFrame=e,t.primitives.add(this._polylineCollection)}function Cf(t,e){e.collectionChanged.addEventListener(Cf.prototype._onCollectionChanged,this),this._scene=t,this._updaters={},this._entityCollection=e,this._items=new g.default,this._onCollectionChanged(e,e.values,[],[])}Ef.prototype.update=function(t){if(this._referenceFrame===uf.a.INERTIAL){var e=se.default.computeIcrfToFixedMatrix(t,Pf);Object(l.default)(e)||(e=se.default.computeTemeToPseudoFixedMatrix(t,Pf)),oe.default.fromRotationTranslation(e,_.default.ZERO,this._polylineCollection.modelMatrix)}},Ef.prototype.updateObject=function(t,e){var i,a,r=e.entity,n=r._path,o=r._position,s=n._show,u=e.polyline,d=r.isShowing&&(!Object(l.default)(s)||s.getValue(t));if(d){var f=D.default.getValueOrUndefined(n._leadTime,t),c=D.default.getValueOrUndefined(n._trailTime,t),h=r._availability,p=Object(l.default)(h),m=Object(l.default)(f),g=Object(l.default)(c);if(d=p||m&&g){if(g&&(i=sf.default.addSeconds(t,-c,new sf.default)),m&&(a=sf.default.addSeconds(t,f,new sf.default)),p){var y=h.start,v=h.stop;g&&!sf.default.greaterThan(y,i)||(i=y),m&&!sf.default.lessThan(v,a)||(a=v)}d=sf.default.lessThan(i,a)}}if(d){if(!Object(l.default)(u)){var _=this._unusedIndexes;if(_.length>0){var b=_.pop();u=this._polylineCollection.get(b),e.index=b}else e.index=this._polylineCollection.length,u=this._polylineCollection.add();u.id=r,e.polyline=u}var O=D.default.getValueOrDefault(n._resolution,t,60);u.show=!0,u.positions=Af(o,i,a,t,this._referenceFrame,O,u.positions.slice()),u.material=bt.getValue(t,n._material,u.material),u.width=D.default.getValueOrDefault(n._width,t,1),u.distanceDisplayCondition=D.default.getValueOrUndefined(n._distanceDisplayCondition,t,u.distanceDisplayCondition)}else Object(l.default)(u)&&(this._unusedIndexes.push(e.index),e.polyline=void 0,u.show=!1,e.index=void 0)},Ef.prototype.removeObject=function(t){var e=t.polyline;Object(l.default)(e)&&(this._unusedIndexes.push(t.index),t.polyline=void 0,e.show=!1,e.id=void 0,t.index=void 0)},Ef.prototype.destroy=function(){return this._scene.primitives.remove(this._polylineCollection),Object(u.default)(this)},Cf.prototype.update=function(t){var e=this._updaters;for(var i in e)e.hasOwnProperty(i)&&e[i].update(t);var a=this._items.values;if(0===a.length&&Object(l.default)(this._updaters)&&Object.keys(this._updaters).length>0){for(var r in e)e.hasOwnProperty(r)&&e[r].destroy();this._updaters={}}for(var n=0,o=a.length;n<o;n++){var s=a[n],u=s.entity._position,d=s.updater,f=uf.a.FIXED;this._scene.mode===Rt.a.SCENE3D&&(f=u.referenceFrame);var c=this._updaters[f];d===c&&Object(l.default)(c)?c.updateObject(t,s):(Object(l.default)(d)&&d.removeObject(s),Object(l.default)(c)||((c=new Ef(this._scene,f)).update(t),this._updaters[f]=c),s.updater=c,Object(l.default)(c)&&c.updateObject(t,s))}return!0},Cf.prototype.isDestroyed=function(){return!1},Cf.prototype.destroy=function(){this._entityCollection.collectionChanged.removeEventListener(Cf.prototype._onCollectionChanged,this);var t=this._updaters;for(var e in t)t.hasOwnProperty(e)&&t[e].destroy();return Object(u.default)(this)},Cf.prototype._onCollectionChanged=function(t,e,i,a){var r,n,o,s=this._items;for(r=e.length-1;r>-1;r--)n=e[r],Object(l.default)(n._path)&&Object(l.default)(n._position)&&s.set(n.id,new Of(n));for(r=a.length-1;r>-1;r--)n=a[r],Object(l.default)(n._path)&&Object(l.default)(n._position)?s.contains(n.id)||s.set(n.id,new Of(n)):(o=s.get(n.id),Object(l.default)(o)&&(Object(l.default)(o.updater)&&o.updater.removeObject(o),s.remove(n.id)));for(r=i.length-1;r>-1;r--)n=i[r],o=s.get(n.id),Object(l.default)(o)&&(Object(l.default)(o.updater)&&o.updater.removeObject(o),s.remove(n.id))},Cf._subSample=Af;var jf=Cf,Df=i(608),xf=b.default.WHITE,Tf=b.default.BLACK,If=new b.default,Mf=new _.default,Vf=new b.default,Nf=new A.a,Sf=new A.a,Lf=new w.a;function Ff(t){this.entity=t,this.pointPrimitive=void 0,this.billboard=void 0,this.color=void 0,this.outlineColor=void 0,this.pixelSize=void 0,this.outlineWidth=void 0}function Uf(t,e){e.collectionChanged.addEventListener(Uf.prototype._onCollectionChanged,this),this._cluster=t,this._entityCollection=e,this._items=new g.default,this._onCollectionChanged(e,e.values,[],[])}function Rf(t,e,i){if(Object(l.default)(t)){var a=t.pointPrimitive;if(Object(l.default)(a))return t.pointPrimitive=void 0,void i.removePoint(e);var r=t.billboard;Object(l.default)(r)&&(t.billboard=void 0,i.removeBillboard(e))}}Uf.prototype.update=function(t){for(var e=this._items.values,i=this._cluster,a=0,r=e.length;a<r;a++){var n,o=e[a],s=o.entity,u=s._point,d=o.pointPrimitive,f=o.billboard,c=D.default.getValueOrDefault(u._heightReference,t,P.default.NONE),h=s.isShowing&&s.isAvailable(t)&&D.default.getValueOrDefault(u._show,t,!0);if(h&&(n=D.default.getValueOrUndefined(s._position,t,Mf),h=Object(l.default)(n)),h){D.default.isConstant(s._position)||(i._clusterDirty=!0);var p=!1,m=!1;if(c===P.default.NONE||Object(l.default)(f)?c!==P.default.NONE||Object(l.default)(d)||(Object(l.default)(f)&&(Rf(o,s,i),f=void 0),(d=i.getPoint(s)).id=s,o.pointPrimitive=d):(Object(l.default)(d)&&(Rf(o,s,i),d=void 0),(f=i.getBillboard(s)).id=s,f.image=void 0,o.billboard=f,p=!0,m=_.default.equals(f.position,n)&&f.heightReference===c),Object(l.default)(d))d.show=!0,d.position=n,d.scaleByDistance=D.default.getValueOrUndefined(u._scaleByDistance,t,Nf),d.translucencyByDistance=D.default.getValueOrUndefined(u._translucencyByDistance,t,Sf),d.color=D.default.getValueOrDefault(u._color,t,xf,If),d.outlineColor=D.default.getValueOrDefault(u._outlineColor,t,Tf,Vf),d.outlineWidth=D.default.getValueOrDefault(u._outlineWidth,t,0),d.pixelSize=D.default.getValueOrDefault(u._pixelSize,t,1),d.distanceDisplayCondition=D.default.getValueOrUndefined(u._distanceDisplayCondition,t,Lf),d.disableDepthTestDistance=D.default.getValueOrDefault(u._disableDepthTestDistance,t,0);else if(Object(l.default)(f)){f.show=!0,f.position=n,f.scaleByDistance=D.default.getValueOrUndefined(u._scaleByDistance,t,Nf),f.translucencyByDistance=D.default.getValueOrUndefined(u._translucencyByDistance,t,Sf),f.distanceDisplayCondition=D.default.getValueOrUndefined(u._distanceDisplayCondition,t,Lf),f.disableDepthTestDistance=D.default.getValueOrDefault(u._disableDepthTestDistance,t,0),f.heightReference=c;var g=D.default.getValueOrDefault(u._color,t,xf,If),y=D.default.getValueOrDefault(u._outlineColor,t,Tf,Vf),v=Math.round(D.default.getValueOrDefault(u._outlineWidth,t,0)),O=Math.max(1,Math.round(D.default.getValueOrDefault(u._pixelSize,t,1)));if(v>0?(f.scale=1,p=p||v!==o.outlineWidth||O!==o.pixelSize||!b.default.equals(g,o.color)||!b.default.equals(y,o.outlineColor)):(f.scale=O/50,O=50,p=p||v!==o.outlineWidth||!b.default.equals(g,o.color)||!b.default.equals(y,o.outlineColor)),p){o.color=b.default.clone(g,o.color),o.outlineColor=b.default.clone(y,o.outlineColor),o.pixelSize=O,o.outlineWidth=v;var w=g.alpha,A=g.toCssColorString(),E=y.toCssColorString(),C=JSON.stringify([A,O,E,v]);f.setImage(C,Object(Df.a)(w,A,E,v,O))}m&&f._updateClamping()}}else Rf(o,s,i)}return!0},Uf.prototype.getBoundingSphere=function(t,e){var i=this._items.get(t.id);if(!Object(l.default)(i)||!Object(l.default)(i.pointPrimitive)&&!Object(l.default)(i.billboard))return j.default.FAILED;if(Object(l.default)(i.pointPrimitive))e.center=_.default.clone(i.pointPrimitive.position,e.center);else{var a=i.billboard;if(!Object(l.default)(a._clampedPosition))return j.default.PENDING;e.center=_.default.clone(a._clampedPosition,e.center)}return e.radius=0,j.default.DONE},Uf.prototype.isDestroyed=function(){return!1},Uf.prototype.destroy=function(){this._entityCollection.collectionChanged.removeEventListener(Uf.prototype._onCollectionChanged,this);for(var t=this._entityCollection.values,e=0;e<t.length;e++)this._cluster.removePoint(t[e]);return Object(u.default)(this)},Uf.prototype._onCollectionChanged=function(t,e,i,a){var r,n,o=this._items,s=this._cluster;for(r=e.length-1;r>-1;r--)n=e[r],Object(l.default)(n._point)&&Object(l.default)(n._position)&&o.set(n.id,new Ff(n));for(r=a.length-1;r>-1;r--)n=a[r],Object(l.default)(n._point)&&Object(l.default)(n._position)?o.contains(n.id)||o.set(n.id,new Ff(n)):(Rf(o.get(n.id),n,s),o.remove(n.id));for(r=i.length-1;r>-1;r--)n=i[r],Rf(o.get(n.id),n,s),o.remove(n.id)};var Hf=Uf,Bf=i(425),Gf=i(522),kf=i(539),zf=i(270),Wf=[];function Yf(t,e,i,a,r){var n,o=Wf;o.length=r;var l=i.red,s=i.green,u=i.blue,d=i.alpha,f=a.red,c=a.green,h=a.blue,p=a.alpha;if(b.default.equals(i,a)){for(n=0;n<r;n++)o[n]=b.default.clone(i);return o}var m=(f-l)/r,g=(c-s)/r,y=(h-u)/r,v=(p-d)/r;for(n=0;n<r;n++)o[n]=new b.default(l+n*m,s+n*g,u+n*y,d+n*v);return o}function qf(t){var e=(t=Object(o.default)(t,o.default.EMPTY_OBJECT)).positions,i=t.colors,a=Object(o.default)(t.width,1),r=Object(o.default)(t.colorsPerVertex,!1);this._positions=e,this._colors=i,this._width=a,this._colorsPerVertex=r,this._vertexFormat=$.default.clone(Object(o.default)(t.vertexFormat,$.default.DEFAULT)),this._arcType=Object(o.default)(t.arcType,Mn.a.GEODESIC),this._granularity=Object(o.default)(t.granularity,Ut.default.RADIANS_PER_DEGREE),this._ellipsoid=mi.default.clone(Object(o.default)(t.ellipsoid,mi.default.WGS84)),this._workerName="createPolylineGeometry";var n=1+e.length*_.default.packedLength;n+=Object(l.default)(i)?1+i.length*b.default.packedLength:1,this.packedLength=n+mi.default.packedLength+$.default.packedLength+4}qf.pack=function(t,e,i){var a;i=Object(o.default)(i,0);var r=t._positions,n=r.length;for(e[i++]=n,a=0;a<n;++a,i+=_.default.packedLength)_.default.pack(r[a],e,i);var s=t._colors;for(n=Object(l.default)(s)?s.length:0,e[i++]=n,a=0;a<n;++a,i+=b.default.packedLength)b.default.pack(s[a],e,i);return mi.default.pack(t._ellipsoid,e,i),i+=mi.default.packedLength,$.default.pack(t._vertexFormat,e,i),i+=$.default.packedLength,e[i++]=t._width,e[i++]=t._colorsPerVertex?1:0,e[i++]=t._arcType,e[i]=t._granularity,e};var Xf=mi.default.clone(mi.default.UNIT_SPHERE),Zf=new $.default,Jf={positions:void 0,colors:void 0,ellipsoid:Xf,vertexFormat:Zf,width:void 0,colorsPerVertex:void 0,arcType:void 0,granularity:void 0};qf.unpack=function(t,e,i){var a;e=Object(o.default)(e,0);var r=t[e++],n=new Array(r);for(a=0;a<r;++a,e+=_.default.packedLength)n[a]=_.default.unpack(t,e);var s=(r=t[e++])>0?new Array(r):void 0;for(a=0;a<r;++a,e+=b.default.packedLength)s[a]=b.default.unpack(t,e);var u=mi.default.unpack(t,e,Xf);e+=mi.default.packedLength;var d=$.default.unpack(t,e,Zf);e+=$.default.packedLength;var f=t[e++],c=1===t[e++],h=t[e++],p=t[e];return Object(l.default)(i)?(i._positions=n,i._colors=s,i._ellipsoid=mi.default.clone(u,i._ellipsoid),i._vertexFormat=$.default.clone(d,i._vertexFormat),i._width=f,i._colorsPerVertex=c,i._arcType=h,i._granularity=p,i):(Jf.positions=n,Jf.colors=s,Jf.width=f,Jf.colorsPerVertex=c,Jf.arcType=h,Jf.granularity=p,new qf(Jf))};var Kf=new _.default,Qf=new _.default,$f=new _.default,tc=new _.default;qf.createGeometry=function(t){var e,i,a,n=t._width,o=t._vertexFormat,s=t._colors,u=t._colorsPerVertex,d=t._arcType,f=t._granularity,c=t._ellipsoid,h=Object(te.a)(t._positions,_.default.equalsEpsilon),p=h.length;if(!(p<2||n<=0)){if(d===Mn.a.GEODESIC||d===Mn.a.RHUMB){var m,g;d===Mn.a.GEODESIC?(m=Ut.default.chordLength(f,c.maximumRadius),g=ae.a.numberOfPoints):(m=f,g=ae.a.numberOfPointsRhumbLine);var y=ae.a.extractHeights(h,c);if(Object(l.default)(s)){var v=1;for(e=0;e<p-1;++e)v+=g(h[e],h[e+1],m);var O=new Array(v),w=0;for(e=0;e<p-1;++e){var A=h[e],P=h[e+1],E=s[e],C=g(A,P,m);if(u&&e<v){var j=Yf(0,0,E,s[e+1],C),D=j.length;for(i=0;i<D;++i)O[w++]=j[i]}else for(i=0;i<C;++i)O[w++]=b.default.clone(E)}O[w]=b.default.clone(s[s.length-1]),s=O,Wf.length=0}h=d===Mn.a.GEODESIC?ae.a.generateCartesianArc({positions:h,minDistance:m,ellipsoid:c,height:y}):ae.a.generateCartesianRhumbArc({positions:h,granularity:m,ellipsoid:c,height:y})}var x,T=4*(p=h.length)-4,I=new Float64Array(3*T),M=new Float64Array(3*T),V=new Float64Array(3*T),N=new Float32Array(2*T),S=o.st?new Float32Array(2*T):void 0,L=Object(l.default)(s)?new Uint8Array(4*T):void 0,F=0,U=0,R=0,H=0;for(i=0;i<p;++i){var B,G;0===i?(x=Kf,_.default.subtract(h[0],h[1],x),_.default.add(h[0],x,x)):x=h[i-1],_.default.clone(x,$f),_.default.clone(h[i],Qf),i===p-1?(x=Kf,_.default.subtract(h[p-1],h[p-2],x),_.default.add(h[p-1],x,x)):x=h[i+1],_.default.clone(x,tc),Object(l.default)(L)&&(B=0===i||u?s[i]:s[i-1],i!==p-1&&(G=s[i]));var k=i===p-1?2:4;for(a=0===i?2:0;a<k;++a){_.default.pack(Qf,I,F),_.default.pack($f,M,F),_.default.pack(tc,V,F),F+=3;var z=a-2<0?-1:1;if(N[U++]=a%2*2-1,N[U++]=z*n,o.st&&(S[R++]=i/(p-1),S[R++]=Math.max(N[U-2],0)),Object(l.default)(L)){var W=a<2?B:G;L[H++]=b.default.floatToByte(W.red),L[H++]=b.default.floatToByte(W.green),L[H++]=b.default.floatToByte(W.blue),L[H++]=b.default.floatToByte(W.alpha)}}}var Y=new vi.a;Y.position=new yi.a({componentDatatype:ut.a.DOUBLE,componentsPerAttribute:3,values:I}),Y.prevPosition=new yi.a({componentDatatype:ut.a.DOUBLE,componentsPerAttribute:3,values:M}),Y.nextPosition=new yi.a({componentDatatype:ut.a.DOUBLE,componentsPerAttribute:3,values:V}),Y.expandAndWidth=new yi.a({componentDatatype:ut.a.FLOAT,componentsPerAttribute:2,values:N}),o.st&&(Y.st=new yi.a({componentDatatype:ut.a.FLOAT,componentsPerAttribute:2,values:S})),Object(l.default)(L)&&(Y.color=new yi.a({componentDatatype:ut.a.UNSIGNED_BYTE,componentsPerAttribute:4,values:L,normalize:!0}));var q=_i.a.createTypedArray(T,6*p-6),X=0,Z=0,J=p-1;for(i=0;i<J;++i)q[Z++]=X,q[Z++]=X+2,q[Z++]=X+1,q[Z++]=X+1,q[Z++]=X+2,q[Z++]=X+3,X+=4;return new gi.a({attributes:Y,indices:q,primitiveType:Oi.a.TRIANGLES,boundingSphere:r.default.fromPoints(h),geometryType:zf.a.POLYLINES})}};var ec=qf,ic=new Pt.a(0),ac={},rc=new b.default,nc=new yt.default(b.default.WHITE),oc=new Pt.a(!0),lc=new Pt.a(nt.a.DISABLED),sc=new Pt.a(new w.a),uc=new Pt.a(K.a.BOTH);function dc(){this.vertexFormat=void 0,this.positions=void 0,this.width=void 0,this.arcType=void 0,this.granularity=void 0}function fc(){this.positions=void 0,this.width=void 0,this.arcType=void 0,this.granularity=void 0}function cc(t,e){this._entity=t,this._scene=e,this._entitySubscription=t.definitionChanged.addEventListener(cc.prototype._onEntityPropertyChanged,this),this._fillEnabled=!1,this._dynamic=!1,this._geometryChanged=new J.default,this._showProperty=void 0,this._materialProperty=void 0,this._shadowsProperty=void 0,this._distanceDisplayConditionProperty=void 0,this._classificationTypeProperty=void 0,this._depthFailMaterialProperty=void 0,this._geometryOptions=new dc,this._groundGeometryOptions=new fc,this._id="polyline-"+t.id,this._clampToGround=!1,this._supportsPolylinesOnTerrain=Et.default.supportsPolylinesOnTerrain(e),this._zIndex=0,this._onEntityPropertyChanged(t,"polyline",t.polyline,void 0)}Object(s.default)(cc.prototype,{id:{get:function(){return this._id}},entity:{get:function(){return this._entity}},fillEnabled:{get:function(){return this._fillEnabled}},hasConstantFill:{get:function(){return!this._fillEnabled||!Object(l.default)(this._entity.availability)&&D.default.isConstant(this._showProperty)}},fillMaterialProperty:{get:function(){return this._materialProperty}},depthFailMaterialProperty:{get:function(){return this._depthFailMaterialProperty}},outlineEnabled:{value:!1},hasConstantOutline:{value:!0},outlineColorProperty:{value:void 0},shadowsProperty:{get:function(){return this._shadowsProperty}},distanceDisplayConditionProperty:{get:function(){return this._distanceDisplayConditionProperty}},classificationTypeProperty:{get:function(){return this._classificationTypeProperty}},isDynamic:{get:function(){return this._dynamic}},isClosed:{value:!1},geometryChanged:{get:function(){return this._geometryChanged}},arcType:{get:function(){return this._arcType}},clampToGround:{get:function(){return this._clampToGround&&this._supportsPolylinesOnTerrain}},zIndex:{get:function(){return this._zIndex}}}),cc.prototype.isOutlineVisible=function(t){return!1},cc.prototype.isFilled=function(t){var e=this._entity,i=this._fillEnabled&&e.isAvailable(t)&&this._showProperty.getValue(t);return Object(o.default)(i,!1)},cc.prototype.createFillGeometryInstance=function(t){var e,i=this._entity,a=i.isAvailable(t),r=new gt.a(a&&i.isShowing&&this._showProperty.getValue(t)),n=this._distanceDisplayConditionProperty.getValue(t),o={show:r,distanceDisplayCondition:ft.fromDistanceDisplayCondition(n)};return this._materialProperty instanceof yt.default&&(Object(l.default)(this._materialProperty.color)&&(this._materialProperty.color.isConstant||a)&&(e=this._materialProperty.color.getValue(t,rc)),Object(l.default)(e)||(e=b.default.WHITE),o.color=st.a.fromColor(e)),this.clampToGround?new ct.a({id:i,geometry:new kf.a(this._groundGeometryOptions),attributes:o}):(Object(l.default)(this._depthFailMaterialProperty)&&this._depthFailMaterialProperty instanceof yt.default&&(Object(l.default)(this._depthFailMaterialProperty.color)&&(this._depthFailMaterialProperty.color.isConstant||a)&&(e=this._depthFailMaterialProperty.color.getValue(t,rc)),Object(l.default)(e)||(e=b.default.WHITE),o.depthFailColor=st.a.fromColor(e)),new ct.a({id:i,geometry:new ec(this._geometryOptions),attributes:o}))},cc.prototype.createOutlineGeometryInstance=function(t){},cc.prototype.isDestroyed=function(){return!1},cc.prototype.destroy=function(){this._entitySubscription(),Object(u.default)(this)},cc.prototype._onEntityPropertyChanged=function(t,e,i,a){if("availability"===e||"polyline"===e){var r=this._entity.polyline;if(Object(l.default)(r)){var n=r.positions,s=r.show;if(Object(l.default)(s)&&s.isConstant&&!s.getValue(pt.default.MINIMUM_VALUE)||!Object(l.default)(n))this._fillEnabled&&(this._fillEnabled=!1,this._geometryChanged.raiseEvent(this));else{var u=r.zIndex,d=Object(o.default)(r.material,nc),f=d instanceof yt.default;this._materialProperty=d,this._depthFailMaterialProperty=r.depthFailMaterial,this._showProperty=Object(o.default)(s,oc),this._shadowsProperty=Object(o.default)(r.shadows,lc),this._distanceDisplayConditionProperty=Object(o.default)(r.distanceDisplayCondition,sc),this._classificationTypeProperty=Object(o.default)(r.classificationType,uc),this._fillEnabled=!0,this._zIndex=Object(o.default)(u,ic);var c=r.width,h=r.arcType,p=r.clampToGround,m=r.granularity;if(n.isConstant&&D.default.isConstant(c)&&D.default.isConstant(h)&&D.default.isConstant(m)&&D.default.isConstant(p)&&D.default.isConstant(u)){var g,y=this._geometryOptions,v=n.getValue(pt.default.MINIMUM_VALUE,y.positions);if(!Object(l.default)(v)||v.length<2)return void(this._fillEnabled&&(this._fillEnabled=!1,this._geometryChanged.raiseEvent(this)));g=f&&(!Object(l.default)(this._depthFailMaterialProperty)||this._depthFailMaterialProperty instanceof yt.default)?Bf.a.VERTEX_FORMAT:Gf.a.VERTEX_FORMAT,y.vertexFormat=g,y.positions=v,y.width=Object(l.default)(c)?c.getValue(pt.default.MINIMUM_VALUE):void 0,y.arcType=Object(l.default)(h)?h.getValue(pt.default.MINIMUM_VALUE):void 0,y.granularity=Object(l.default)(m)?m.getValue(pt.default.MINIMUM_VALUE):void 0;var _=this._groundGeometryOptions;_.positions=v,_.width=y.width,_.arcType=y.arcType,_.granularity=y.granularity,this._clampToGround=!!Object(l.default)(p)&&p.getValue(pt.default.MINIMUM_VALUE),!this._clampToGround&&Object(l.default)(u)&&Object(At.a)("Entity polylines must have clampToGround: true when using zIndex.  zIndex will be ignored."),this._dynamic=!1,this._geometryChanged.raiseEvent(this)}else this._dynamic||(this._dynamic=!0,this._geometryChanged.raiseEvent(this))}}else this._fillEnabled&&(this._fillEnabled=!1,this._geometryChanged.raiseEvent(this))}},cc.prototype.createDynamicUpdater=function(t,e){return new pc(t,e,this)};var hc={positions:void 0,granularity:void 0,height:void 0,ellipsoid:void 0};function pc(t,e,i){this._line=void 0,this._primitives=t,this._groundPrimitives=e,this._groundPolylinePrimitive=void 0,this._material=void 0,this._geometryUpdater=i,this._positions=[]}function mc(t){if(Object(l.default)(t._line))return t._line;var e=t._geometryUpdater._scene.id,i=ac[e],a=t._primitives;!Object(l.default)(i)||i.isDestroyed()?(i=new ff.a,ac[e]=i,a.add(i)):a.contains(i)||a.add(i);var r=i.add();return r.id=t._geometryUpdater._entity,t._line=r,r}pc.prototype.update=function(t){var e=this._geometryUpdater,i=e._entity,a=i.polyline,r=a.positions,n=D.default.getValueOrUndefined(r,t,this._positions);e._clampToGround=D.default.getValueOrDefault(a._clampToGround,t,!1),e._groundGeometryOptions.positions=n,e._groundGeometryOptions.width=D.default.getValueOrDefault(a._width,t,1),e._groundGeometryOptions.arcType=D.default.getValueOrDefault(a._arcType,t,Mn.a.GEODESIC),e._groundGeometryOptions.granularity=D.default.getValueOrDefault(a._granularity,t,9999);var o=this._groundPrimitives;if(Object(l.default)(this._groundPolylinePrimitive)&&(o.remove(this._groundPolylinePrimitive),this._groundPolylinePrimitive=void 0),e.clampToGround){if(!i.isShowing||!i.isAvailable(t)||!D.default.getValueOrDefault(a._show,t,!0))return;if(!Object(l.default)(n)||n.length<2)return;var s,u=e.fillMaterialProperty;if(u instanceof yt.default)s=new Bf.a;else{var d=bt.getValue(t,u,this._material);s=new Gf.a({material:d,translucent:d.isTranslucent()}),this._material=d}return this._groundPolylinePrimitive=o.add(new f.a({geometryInstances:e.createFillGeometryInstance(t),appearance:s,classificationType:e.classificationTypeProperty.getValue(t),asynchronous:!1}),D.default.getValueOrUndefined(e.zIndex,t)),void(Object(l.default)(this._line)&&(this._line.show=!1))}var c=mc(this);if(i.isShowing&&i.isAvailable(t)&&D.default.getValueOrDefault(a._show,t,!0))if(!Object(l.default)(n)||n.length<2)c.show=!1;else{var h=Mn.a.GEODESIC;h=D.default.getValueOrDefault(a._arcType,t,h);var p=e._scene.globe;h!==Mn.a.NONE&&Object(l.default)(p)&&(hc.ellipsoid=p.ellipsoid,hc.positions=n,hc.granularity=D.default.getValueOrUndefined(a._granularity,t),hc.height=ae.a.extractHeights(n,p.ellipsoid),n=h===Mn.a.GEODESIC?ae.a.generateCartesianArc(hc):ae.a.generateCartesianRhumbArc(hc)),c.show=!0,c.positions=n.slice(),c.material=bt.getValue(t,e.fillMaterialProperty,c.material),c.width=D.default.getValueOrDefault(a._width,t,1),c.distanceDisplayCondition=D.default.getValueOrUndefined(a._distanceDisplayCondition,t,c.distanceDisplayCondition)}else c.show=!1},pc.prototype.getBoundingSphere=function(t){if(this._geometryUpdater.clampToGround){var e=this._groundPolylinePrimitive;if(Object(l.default)(e)&&e.show&&e.ready){var i=e.getGeometryInstanceAttributes(this._geometryUpdater._entity);if(Object(l.default)(i)&&Object(l.default)(i.boundingSphere))return r.default.clone(i.boundingSphere,t),j.default.DONE}return Object(l.default)(e)&&!e.ready?j.default.PENDING:j.default.DONE}var a=mc(this);return a.show&&a.positions.length>0?(r.default.fromPoints(a.positions,t),j.default.DONE):j.default.FAILED},pc.prototype.isDestroyed=function(){return!1},pc.prototype.destroy=function(){var t=this._geometryUpdater._scene.id,e=ac[t];Object(l.default)(e)&&(e.remove(this._line),0===e.length&&(this._primitives.removeAndDestroy(e),delete ac[t])),Object(l.default)(this._groundPolylinePrimitive)&&this._groundPrimitives.remove(this._groundPolylinePrimitive),Object(u.default)(this)};var gc=cc,yc=new b.default,vc=new w.a,_c=new w.a;function bc(t,e,i,a,r){var n;n=i instanceof yt.default?Bf.a:Gf.a,this.orderedGroundPrimitives=t,this.classificationType=e,this.appearanceType=n,this.materialProperty=i,this.updaters=new g.default,this.createPrimitive=!0,this.primitive=void 0,this.oldPrimitive=void 0,this.geometry=new g.default,this.material=void 0,this.updatersWithAttributes=new g.default,this.attributes=new g.default,this.invalidated=!1,this.removeMaterialSubscription=i.definitionChanged.addEventListener(bc.prototype.onMaterialChanged,this),this.subscriptions=new g.default,this.showsUpdated=new g.default,this.zIndex=a,this._asynchronous=r}function Oc(t,e,i){this._items=[],this._orderedGroundPrimitives=t,this._classificationType=e,this._asynchronous=Object(o.default)(i,!0)}bc.prototype.onMaterialChanged=function(){this.invalidated=!0},bc.prototype.isMaterial=function(t){var e=this.materialProperty,i=t.fillMaterialProperty;return i===e||i instanceof yt.default&&e instanceof yt.default||Object(l.default)(e)&&e.equals(i)},bc.prototype.add=function(t,e,i){var a=e.id;if(this.updaters.set(a,e),this.geometry.set(a,i),e.hasConstantFill&&e.fillMaterialProperty.isConstant&&D.default.isConstant(e.distanceDisplayConditionProperty)){var r=this;this.subscriptions.set(a,e.entity.definitionChanged.addEventListener(function(t,i,a,n){"isShowing"===i&&r.showsUpdated.set(e.id,e)}))}else this.updatersWithAttributes.set(a,e);this.createPrimitive=!0},bc.prototype.remove=function(t){var e=t.id;if(this.createPrimitive=this.geometry.remove(e)||this.createPrimitive,this.updaters.remove(e)){this.updatersWithAttributes.remove(e);var i=this.subscriptions.get(e);return Object(l.default)(i)&&(i(),this.subscriptions.remove(e)),!0}return!1},bc.prototype.update=function(t){var e,i=!0,a=this.primitive,r=this.orderedGroundPrimitives,n=this.geometry.values;if(this.createPrimitive){if(n.length>0)Object(l.default)(a)&&(Object(l.default)(this.oldPrimitive)?r.remove(a):this.oldPrimitive=a),a=new f.a({show:!1,asynchronous:this._asynchronous,geometryInstances:n,appearance:new this.appearanceType,classificationType:this.classificationType}),this.appearanceType===Gf.a&&(this.material=bt.getValue(t,this.materialProperty,this.material),a.appearance.material=this.material),r.add(a,this.zIndex),i=!1;else{Object(l.default)(a)&&(r.remove(a),a=void 0);var o=this.oldPrimitive;Object(l.default)(o)&&(r.remove(o),this.oldPrimitive=void 0)}this.attributes.removeAll(),this.primitive=a,this.createPrimitive=!1}else if(Object(l.default)(a)&&a.ready){a.show=!0,Object(l.default)(this.oldPrimitive)&&(r.remove(this.oldPrimitive),this.oldPrimitive=void 0),this.appearanceType===Gf.a&&(this.material=bt.getValue(t,this.materialProperty,this.material),this.primitive.appearance.material=this.material);var s=this.updatersWithAttributes.values,u=s.length;for(e=0;e<u;e++){var d=s[e],c=d.entity,h=this.geometry.get(d.id),p=this.attributes.get(h.id.id);if(Object(l.default)(p)||(p=a.getGeometryInstanceAttributes(h.id),this.attributes.set(h.id.id,p)),!d.fillMaterialProperty.isConstant){var m=d.fillMaterialProperty.color,g=D.default.getValueOrDefault(m,t,b.default.WHITE,yc);b.default.equals(p._lastColor,g)||(p._lastColor=b.default.clone(g,p._lastColor),p.color=st.a.toValue(g,p.color))}var y=c.isShowing&&(d.hasConstantFill||d.isFilled(t));y!==(1===p.show[0])&&(p.show=gt.a.toValue(y,p.show));var v=d.distanceDisplayConditionProperty;if(!D.default.isConstant(v)){var _=D.default.getValueOrDefault(v,t,_c,vc);w.a.equals(_,p._lastDistanceDisplayCondition)||(p._lastDistanceDisplayCondition=w.a.clone(_,p._lastDistanceDisplayCondition),p.distanceDisplayCondition=ft.toValue(_,p.distanceDisplayCondition))}}this.updateShows(a)}else Object(l.default)(a)&&!a.ready&&(i=!1);return i},bc.prototype.updateShows=function(t){for(var e=this.showsUpdated.values,i=e.length,a=0;a<i;a++){var r=e[a],n=r.entity,o=this.geometry.get(r.id),s=this.attributes.get(o.id.id);Object(l.default)(s)||(s=t.getGeometryInstanceAttributes(o.id),this.attributes.set(o.id.id,s));var u=n.isShowing;u!==(1===s.show[0])&&(s.show=gt.a.toValue(u,s.show),o.attributes.show.value[0]=s.show[0])}this.showsUpdated.removeAll()},bc.prototype.contains=function(t){return this.updaters.contains(t.id)},bc.prototype.getBoundingSphere=function(t,e){var i=this.primitive;if(!i.ready)return j.default.PENDING;var a=i.getGeometryInstanceAttributes(t.entity);return!Object(l.default)(a)||!Object(l.default)(a.boundingSphere)||Object(l.default)(a.show)&&0===a.show[0]?j.default.FAILED:(a.boundingSphere.clone(e),j.default.DONE)},bc.prototype.destroy=function(){var t=this.primitive,e=this.orderedGroundPrimitives;Object(l.default)(t)&&e.remove(t);var i=this.oldPrimitive;Object(l.default)(i)&&e.remove(i),this.removeMaterialSubscription()},Oc.prototype.add=function(t,e){for(var i=this._items,a=i.length,r=e.createFillGeometryInstance(t),n=D.default.getValueOrDefault(e.zIndex,0),o=0;o<a;++o){var l=i[o];if(l.isMaterial(e)&&l.zIndex===n)return void l.add(t,e,r)}var s=new bc(this._orderedGroundPrimitives,this._classificationType,e.fillMaterialProperty,n,this._asynchronous);s.add(t,e,r),i.push(s)},Oc.prototype.remove=function(t){for(var e=this._items,i=e.length-1;i>=0;i--){var a=e[i];if(a.remove(t)){0===a.updaters.length&&(e.splice(i,1),a.destroy());break}}},Oc.prototype.update=function(t){var e,i=this._items;for(e=i.length-1;e>=0;e--){var a=i[e];if(a.invalidated){i.splice(e,1);for(var r=a.updaters.values,n=r.length,o=0;o<n;o++)this.add(t,r[o]);a.destroy()}}var l=!0;for(e=0;e<i.length;e++)l=i[e].update(t)&&l;return l},Oc.prototype.getBoundingSphere=function(t,e){for(var i=this._items,a=i.length,r=0;r<a;r++){var n=i[r];if(n.contains(t))return n.getBoundingSphere(t,e)}return j.default.FAILED},Oc.prototype.removeAllPrimitives=function(){for(var t=this._items,e=t.length,i=0;i<e;i++)t[i].destroy();this._items.length=0};var wc=Oc,Ac=[];function Pc(t,e){for(var i=t._batches,a=i.length,r=0;r<a;r++)i[r].remove(e)}function Ec(t,e,i){if(i.isDynamic)t._dynamicBatch.add(e,i);else if(i.clampToGround&&i.fillEnabled){var a=i.classificationTypeProperty.getValue(e);t._groundBatches[a].add(e,i)}else{var r;i.fillEnabled&&(r=i.shadowsProperty.getValue(e));var n,o=0;Object(l.default)(i.depthFailMaterialProperty)&&(o=i.depthFailMaterialProperty instanceof yt.default?1:2),Object(l.default)(r)&&(n=r+o*nt.a.NUMBER_OF_SHADOW_MODES),i.fillEnabled&&(i.fillMaterialProperty instanceof yt.default?t._colorBatches[n].add(e,i):t._materialBatches[n].add(e,i))}}function Cc(t,e,i,a){var r;a=Object(o.default)(a,t.groundPrimitives),i=Object(o.default)(i,t.primitives),this._scene=t,this._primitives=i,this._entityCollection=void 0,this._addedObjects=new g.default,this._removedObjects=new g.default,this._changedObjects=new g.default;var n=nt.a.NUMBER_OF_SHADOW_MODES;for(this._colorBatches=new Array(3*n),this._materialBatches=new Array(3*n),r=0;r<n;++r)this._colorBatches[r]=new Vs(i,Bf.a,void 0,!1,r),this._materialBatches[r]=new Bs(i,Gf.a,void 0,!1,r),this._colorBatches[r+n]=new Vs(i,Bf.a,Bf.a,!1,r),this._materialBatches[r+n]=new Bs(i,Gf.a,Bf.a,!1,r),this._colorBatches[r+2*n]=new Vs(i,Bf.a,Gf.a,!1,r),this._materialBatches[r+2*n]=new Bs(i,Gf.a,Gf.a,!1,r);this._dynamicBatch=new Ha(i,a);var l=K.a.NUMBER_OF_CLASSIFICATION_TYPES;for(this._groundBatches=new Array(l),r=0;r<l;++r)this._groundBatches[r]=new wc(a,r);this._batches=this._colorBatches.concat(this._materialBatches,this._dynamicBatch,this._groundBatches),this._subscriptions=new g.default,this._updaters=new g.default,this._entityCollection=e,e.collectionChanged.addEventListener(Cc.prototype._onCollectionChanged,this),this._onCollectionChanged(e,e.values,Ac)}Cc.prototype.update=function(t){var e,i,a,r,n=this._addedObjects,o=n.values,l=this._removedObjects,s=l.values,u=this._changedObjects,d=u.values;for(e=d.length-1;e>-1;e--)a=(i=d[e]).id,(r=this._updaters.get(a)).entity===i?(Pc(this,r),Ec(this,t,r)):(s.push(i),o.push(i));for(e=s.length-1;e>-1;e--)a=(i=s[e]).id,Pc(this,r=this._updaters.get(a)),r.destroy(),this._updaters.remove(a),this._subscriptions.get(a)(),this._subscriptions.remove(a);for(e=o.length-1;e>-1;e--)a=(i=o[e]).id,r=new gc(i,this._scene),this._updaters.set(a,r),Ec(this,t,r),this._subscriptions.set(a,r.geometryChanged.addEventListener(Cc._onGeometryChanged,this));n.removeAll(),l.removeAll(),u.removeAll();var f=!0,c=this._batches,h=c.length;for(e=0;e<h;e++)f=c[e].update(t)&&f;return f};var jc=[],Dc=new r.default;Cc.prototype.getBoundingSphere=function(t,e){for(var i=jc,a=Dc,n=0,o=j.default.DONE,l=this._batches,s=l.length,u=this._updaters.get(t.id),d=0;d<s;d++){if((o=l[d].getBoundingSphere(u,a))===j.default.PENDING)return j.default.PENDING;o===j.default.DONE&&(i[n]=r.default.clone(a,i[n]),n++)}return 0===n?j.default.FAILED:(i.length=n,r.default.fromBoundingSpheres(i,e),j.default.DONE)},Cc.prototype.isDestroyed=function(){return!1},Cc.prototype.destroy=function(){var t;this._entityCollection.collectionChanged.removeEventListener(Cc.prototype._onCollectionChanged,this),this._addedObjects.removeAll(),this._removedObjects.removeAll();var e=this._batches,i=e.length;for(t=0;t<i;t++)e[t].removeAllPrimitives();var a=this._subscriptions.values;for(i=a.length,t=0;t<i;t++)a[t]();return this._subscriptions.removeAll(),Object(u.default)(this)},Cc._onGeometryChanged=function(t){var e=this._removedObjects,i=this._changedObjects,a=t.entity,r=a.id;Object(l.default)(e.get(r))||Object(l.default)(i.get(r))||i.set(r,a)},Cc.prototype._onCollectionChanged=function(t,e,i){var a,r,n,o=this._addedObjects,l=this._removedObjects,s=this._changedObjects;for(a=i.length-1;a>-1;a--)r=(n=i[a]).id,o.remove(r)||(l.set(r,n),s.remove(r));for(a=e.length-1;a>-1;a--)r=(n=e[a]).id,l.remove(r)?s.set(r,n):o.set(r,n)};var xc=Cc;function Tc(t){this._displayID=Object(n.default)(),c.a.initializeTerrainHeights(),f.a.initializeTerrainHeights();var e=t.scene,i=t.dataSourceCollection;this._eventHelper=new d.default,this._eventHelper.add(i.dataSourceAdded,this._onDataSourceAdded,this),this._eventHelper.add(i.dataSourceRemoved,this._onDataSourceRemoved,this),this._eventHelper.add(i.dataSourceMoved,this._onDataSourceMoved,this),this._eventHelper.add(e.postRender,this._postRender,this),this._dataSourceCollection=i,this._scene=e,this._visualizersCallback=Object(o.default)(t.visualizersCallback,Tc.defaultVisualizersCallback);var a=!1,r=new h.a,l=new h.a;i.length>0&&(e.primitives.add(r),e.groundPrimitives.add(l),a=!0),this._primitives=r,this._groundPrimitives=l;for(var s=0,u=i.length;s<u;s++)this._onDataSourceAdded(i,i.get(s));var p,m,g=new Z.default;if(this._onDataSourceAdded(void 0,g),this._defaultDataSource=g,!a){var y=this,v=function(){e.primitives.add(r),e.groundPrimitives.add(l),p(),m(),y._removeDefaultDataSourceListener=void 0,y._removeDataSourceCollectionListener=void 0};p=g.entities.collectionChanged.addEventListener(v),m=i.dataSourceAdded.addEventListener(v)}this._removeDefaultDataSourceListener=p,this._removeDataSourceCollectionListener=m,this._ready=!1}Tc.defaultVisualizersCallback=function(t,e,i){var a=i.entities;return[new X(e,a),new md(t,a,i._primitives,i._groundPrimitives),new Bd(e,a),new lf(t,a),new Hf(e,a),new jf(t,a),new xc(t,a,i._primitives,i._groundPrimitives)]},Object(s.default)(Tc.prototype,{scene:{get:function(){return this._scene}},dataSources:{get:function(){return this._dataSourceCollection}},defaultDataSource:{get:function(){return this._defaultDataSource}},ready:{get:function(){return this._ready}}}),Tc.prototype.isDestroyed=function(){return!1},Tc.prototype.destroy=function(){this._eventHelper.removeAll();for(var t=this._dataSourceCollection,e=0,i=t.length;e<i;++e)this._onDataSourceRemoved(this._dataSourceCollection,t.get(e));return this._onDataSourceRemoved(void 0,this._defaultDataSource),Object(l.default)(this._removeDefaultDataSourceListener)?(this._removeDefaultDataSourceListener(),this._removeDataSourceCollectionListener()):(this._scene.primitives.remove(this._primitives),this._scene.groundPrimitives.remove(this._groundPrimitives)),Object(u.default)(this)},Tc.prototype.update=function(t){if(!a.a.initialized)return this._ready=!1,!1;var e,i,r,n,o=!0,s=this._dataSourceCollection,u=s.length;for(e=0;e<u;e++){var d=s.get(e);for(Object(l.default)(d.update)&&(o=d.update(t)&&o),n=(r=d._visualizersByDisplayID[this._displayID]).length,i=0;i<n;i++)o=r[i].update(t)&&o}for(n=(r=this._defaultDataSource._visualizersByDisplayID[this._displayID]).length,i=0;i<n;i++)o=r[i].update(t)&&o;return this._ready=o,o},Tc.prototype._postRender=function(){for(var t=this._scene.frameState,e=this._dataSourceCollection,i=e.length,a=0;a<i;a++){var r=e.get(a),n=r.credit;Object(l.default)(n)&&t.creditDisplay.addCredit(n);var o=r._resourceCredits;if(Object(l.default)(o))for(var s=o.length,u=0;u<s;u++)t.creditDisplay.addCredit(o[u])}};var Ic=[],Mc=new r.default;Tc.prototype.getBoundingSphere=function(t,e,i){if(!this._ready)return j.default.PENDING;var a,n,o=this._defaultDataSource;if(!o.entities.contains(t)){o=void 0;var s=this._dataSourceCollection;for(n=s.length,a=0;a<n;a++){var u=s.get(a);if(u.entities.contains(t)){o=u;break}}}if(!Object(l.default)(o))return j.default.FAILED;var d=Ic,f=Mc,c=0,h=j.default.DONE,p=o._visualizers,m=p.length;for(a=0;a<m;a++){var g=p[a];if(Object(l.default)(g.getBoundingSphere)){if(h=p[a].getBoundingSphere(t,f),!e&&h===j.default.PENDING)return j.default.PENDING;h===j.default.DONE&&(d[c]=r.default.clone(f,d[c]),c++)}}return 0===c?j.default.FAILED:(d.length=c,r.default.fromBoundingSpheres(d,i),j.default.DONE)},Tc.prototype._onDataSourceAdded=function(t,e){var i=this._scene,a=this._primitives,r=this._groundPrimitives,n=a.add(new h.a),o=r.add(new m);e._primitives=n,e._groundPrimitives=o;var l=e.clustering;l._initialize(i),n.add(l);var s=this._visualizersCallback(i,l,e);e._visualizersByDisplayID=e._visualizersByDisplayID||{},e._visualizersByDisplayID[this._displayID]=s,e._visualizers=e._visualizers||[],e._visualizers=e._visualizers.concat(s)},Tc.prototype._onDataSourceRemoved=function(t,e){var i=this._primitives,a=this._groundPrimitives,r=e._primitives,n=e._groundPrimitives,o=e.clustering;r.remove(o);var s=e._visualizersByDisplayID[this._displayID];if(Object(l.default)(s)){for(var u=s.length,d=0;d<u;d++){var f=s[d];f.destroy();var c=e._visualizers.indexOf(f);e._visualizers.splice(c,1)}delete e._visualizersByDisplayID[this._displayID],i.remove(r),a.remove(n)}},Tc.prototype._onDataSourceMoved=function(t,e,i){var a=this._primitives,r=this._groundPrimitives,n=t._primitives,o=t._groundPrimitives;e===i+1?(a.raise(n),r.raise(o)):e===i-1?(a.lower(n),r.lower(o)):0===e?(a.lowerToBottom(n),r.lowerToBottom(o),a.raise(n),r.raise(o)):(a.raiseToTop(n),r.raiseToTop(o))};e.default=Tc}}]);
//# sourceMappingURL=1.TerriaJS-specs.js.map